{"version":3,"sources":["../src/constants.ts","../src/shared.ts","../src/utils.ts","../../../node_modules/.pnpm/klona@2.0.6/node_modules/klona/json/index.mjs","../src/asset.ts","../src/audio-codecs.ts","../src/image-formats.ts","../src/novely.ts","../src/store.ts","../../deepmerge/src/utils.ts","../../deepmerge/src/index.ts","../src/translation.ts","../src/custom-action.ts","../src/storage.ts","../src/browser.ts","../src/preloading.ts","../src/extend-actions.ts","../src/translations.ts"],"sourcesContent":["import type { TypewriterSpeed } from './types';\n\nconst SKIPPED_DURING_RESTORE = new Set(['dialog', 'say', 'choice', 'input', 'vibrate', 'text'] as const);\n\nconst BLOCK_EXIT_STATEMENTS = new Set(['choice:exit', 'condition:exit', 'block:exit'] as const);\n\nconst BLOCK_STATEMENTS = new Set(['choice', 'condition', 'block'] as const);\n\nconst AUDIO_ACTIONS = new Set([\n  'playMusic',\n  'stopMusic',\n  'playSound',\n  'stopSound',\n  'voice',\n  'stopVoice'\n] as const);\n\nconst EMPTY_SET = new Set<any>();\n\nconst DEFAULT_TYPEWRITER_SPEED: TypewriterSpeed = 'Medium';\n\nconst HOWLER_SUPPORTED_FILE_FORMATS = new Set([\n  \"mp3\",\n  \"mpeg\",\n  \"opus\",\n  \"ogg\",\n  \"oga\",\n  \"wav\",\n  \"aac\",\n  \"caf\",\n  \"m4a\",\n  \"m4b\",\n  \"mp4\",\n  \"weba\",\n  \"webm\",\n  \"dolby\",\n  \"flac\"\n] as const);\n\nconst SUPPORTED_IMAGE_FILE_FORMATS = new Set([\n  \"apng\",\n  \"avif\",\n  \"gif\",\n  \"jpg\",\n  \"jpeg\",\n  \"jfif\",\n  \"pjpeg\",\n  \"pjp\",\n  \"png\",\n  \"svg\",\n  \"webp\",\n  \"bmp\",\n] as const);\n\n/**\n * @internal\n */\nconst MAIN_CONTEXT_KEY = '$MAIN';\n\nexport {\n  SKIPPED_DURING_RESTORE,\n  EMPTY_SET,\n  DEFAULT_TYPEWRITER_SPEED,\n  BLOCK_EXIT_STATEMENTS,\n  BLOCK_STATEMENTS,\n  MAIN_CONTEXT_KEY,\n  AUDIO_ACTIONS,\n  HOWLER_SUPPORTED_FILE_FORMATS,\n  SUPPORTED_IMAGE_FILE_FORMATS\n};\n","import type { StackHolder } from './types';\nimport type { CustomActionHolder } from './custom-action';\n\n/**\n * @internal\n */\nconst STACK_MAP = new Map<string, StackHolder>();\n\n/**\n * @internal\n */\nconst CUSTOM_ACTION_MAP = new Map<string, CustomActionHolder>()\n\nconst PRELOADED_ASSETS = new Set<string>();\nconst ASSETS_TO_PRELOAD = new Set<string>();\n\nexport { PRELOADED_ASSETS, ASSETS_TO_PRELOAD, STACK_MAP, CUSTOM_ACTION_MAP }\n","import type { DefaultActionProxy, CustomHandler, Story, ValidAction, GetActionParameters } from './action';\nimport type { Character } from './character';\nimport type { Thenable, Path, PathItem, Save, UseStackFunctionReturnType, StackHolder, Lang, NovelyAsset, CharactersData } from './types';\nimport type { Context, Renderer } from './renderer';\nimport { BLOCK_STATEMENTS, BLOCK_EXIT_STATEMENTS, SKIPPED_DURING_RESTORE, AUDIO_ACTIONS, HOWLER_SUPPORTED_FILE_FORMATS, SUPPORTED_IMAGE_FILE_FORMATS } from './constants';\nimport { STACK_MAP } from './shared';\nimport { DEV } from 'esm-env';\nimport { klona } from 'klona/json';\nimport { default as memoize } from 'micro-memoize';\nimport { isAsset } from './asset';\n\ntype MatchActionParams = {\n\tdata: Record<string, unknown>\n\tctx: Context;\n\n\tpush: () => void;\n\tforward: () => void;\n}\n\ntype MatchActionMap = {\n\t[Key in keyof DefaultActionProxy]: (params: MatchActionParams, data: Parameters<DefaultActionProxy[Key]>) => void;\n};\n\ntype MatchActionMapComplete = Omit<MatchActionMap, 'custom'> & {\n\tcustom: (params: MatchActionParams, value: [handler: CustomHandler]) => Thenable<void>;\n};\n\ntype MatchActionParameters = {\n\t/**\n\t * Name of context or context\n\t */\n\tctx: string | Context;\n\t/**\n\t * Data from the save\n\t */\n\tdata: Record<string, unknown>;\n}\n\ntype MatchActionOptions = {\n\tpush: (ctx: Context) => void;\n\tforward: (ctx: Context) => void;\n\n\tgetContext: (name: string) => Context;\n\n\tonBeforeActionCall: (payload: { action: keyof MatchActionMapComplete, props: Parameters<DefaultActionProxy[keyof MatchActionMapComplete]>; ctx: Context }) => void;\n}\n\nconst matchAction = <M extends MatchActionMapComplete>({ getContext, onBeforeActionCall, push, forward }: MatchActionOptions, values: M) => {\n\treturn (action: keyof MatchActionMapComplete, props: any, { ctx, data }: MatchActionParameters) => {\n\t\tconst context = typeof ctx === 'string' ? getContext(ctx) : ctx;\n\n\t\t/**\n\t\t * We ignore `say` action because it calls `dialog` action\n\t\t */\n\t\tif (action !== 'say') {\n\t\t\tonBeforeActionCall({\n\t\t\t\taction,\n\t\t\t\tprops,\n\t\t\t\tctx: context\n\t\t\t})\n\t\t}\n\n\t\treturn values[action]({\n\t\t\tctx: context,\n\t\t\tdata,\n\n\t\t\tpush() {\n\t\t\t\tif (context.meta.preview) return;\n\n\t\t\t\tpush(context)\n\t\t\t},\n\t\t\tforward() {\n\t\t\t\tif (context.meta.preview) return;\n\n\t\t\t\tforward(context)\n\t\t\t}\n\t\t}, props);\n\t};\n};\n\nconst isNumber = (val: unknown): val is number => {\n\treturn typeof val === 'number';\n};\n\nconst isNull = (val: unknown): val is null => {\n\treturn val === null;\n};\n\nconst isString = (val: unknown): val is string => {\n\treturn typeof val === 'string';\n};\n\nconst isFunction = (val: unknown): val is (...parameters: any[]) => any => {\n\treturn typeof val === 'function';\n};\n\nconst isPromise = (val: unknown): val is Promise<any> => {\n\treturn Boolean(val) && (typeof val === 'object' || isFunction(val)) && isFunction((val as any).then);\n};\n\nconst isEmpty = (val: unknown): val is Record<PropertyKey, never> => {\n\treturn typeof val === 'object' && !isNull(val) && Object.keys(val).length === 0;\n};\n\nconst isCSSImage = (str: string) => {\n\tconst startsWith = String.prototype.startsWith.bind(str);\n\n\treturn startsWith('http') || startsWith('/') || startsWith('.') || startsWith('data');\n};\n\nconst str = String;\n\nconst isUserRequiredAction = ([action, ...meta]: ValidAction) => {\n\treturn Boolean(action === 'custom' && meta[0] && (meta[0] as unknown as CustomHandler).requireUserAction);\n};\n\nconst getLanguage = (languages: string[]) => {\n\tlet { language } = navigator;\n\n\tif (languages.includes(language)) {\n\t\treturn language;\n\t} else if (languages.includes((language = language.slice(0, 2)))) {\n\t\treturn language;\n\t} else if ((language = languages.find((value) => navigator.languages.includes(value))!)) {\n\t\treturn language;\n\t}\n\n\t/**\n\t * We'v checked the `en-GB` format, `en` format, and maybe any second languages, but there were no matches\n\t */\n\treturn languages[0];\n};\n\n/**\n * @copyright Techlead LLC\n * @see https://learn.javascript.ru/task/throttle\n */\nconst throttle = <Fn extends (...args: any[]) => any>(fn: Fn, ms: number) => {\n\tlet throttled = false,\n\t\tsavedArgs: any,\n\t\tsavedThis: any;\n\n\tfunction wrapper(this: any, ...args: any[]) {\n\t\tif (throttled) {\n\t\t\tsavedArgs = args;\n\t\t\t/* eslint-disable @typescript-eslint/no-this-alias */\n\t\t\tsavedThis = this;\n\t\t\treturn;\n\t\t}\n\n\t\tfn.apply(this, args as unknown as any[]);\n\n\t\tthrottled = true;\n\n\t\tsetTimeout(() => {\n\t\t\tthrottled = false;\n\n\t\t\tif (savedArgs) {\n\t\t\t\twrapper.apply(savedThis, savedArgs);\n\t\t\t\tsavedArgs = savedThis = null;\n\t\t\t}\n\t\t}, ms);\n\t}\n\n\treturn wrapper as unknown as (...args: Parameters<Fn>) => void;\n};\n\nconst findLastIndex = <T>(array: T[], fn: (this: T[], item: T, index: number, array: T[]) => boolean) => {\n\tfor (let i = array.length - 1; i >= 0; i--) {\n\t\tif (fn.call(array, array[i], i, array)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\n\treturn -1;\n};\n\n/**\n * Using this because `Array.prototype.findLast` has not enough support\n * @see https://caniuse.com/?search=findLast\n */\nconst findLast = <T>(array: T[], fn: (this: T[], item: T, index: number, array: T[]) => boolean) => {\n\treturn array[findLastIndex(array, fn)];\n}\n\ntype ControlledPromise<T> = Promise<\n\t| {\n\t\t\tvalue: T;\n\t\t\tcancelled: false;\n\t  }\n\t| {\n\t\t\tvalue: null;\n\t\t\tcancelled: true;\n\t  }\n>;\n\ntype ControlledPromiseObj<T> = {\n\tresolve: (value: T | PromiseLike<T>) => void;\n\treject: (reason?: any) => void;\n\n\tpromise: ControlledPromise<T>;\n\n\tcancel: () => void;\n};\n\nconst createControlledPromise = <T = void>() => {\n\tconst object = {\n\t\tresolve: null,\n\t\treject: null,\n\n\t\tpromise: null,\n\n\t\tcancel: null,\n\t} as unknown as ControlledPromiseObj<T>;\n\n\tconst init = () => {\n\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\tobject.reject = reject;\n\t\t\tobject.resolve = (value) => {\n\t\t\t\tresolve({ cancelled: false, value });\n\t\t\t};\n\n\t\t\tobject.cancel = () => {\n\t\t\t\tresolve({ cancelled: true, value: null });\n\t\t\t\tinit();\n\t\t\t};\n\t\t});\n\n\t\tobject.promise = promise as ControlledPromise<T>;\n\t};\n\n\treturn init(), object;\n};\n\nconst findLastPathItemBeforeItemOfType = (path: Path, name: PathItem[0]) => {\n\tconst index = findLastIndex(path, ([_name, _value], i, array) => {\n\t\tconst next = array[i + 1];\n\n\t\treturn isNull(_name) && isNumber(_value) && next != null && next[0] === name;\n\t});\n\n\treturn path[index] as undefined | [null, number];\n};\n\nconst isBlockStatement = (statement: unknown): statement is 'choice' | 'condition' | 'block' => {\n\treturn BLOCK_STATEMENTS.has(statement as any);\n};\n\nconst isBlockExitStatement = (\n\tstatement: unknown,\n): statement is 'choice:exit' | 'condition:exit' | 'block:exit' => {\n\treturn BLOCK_EXIT_STATEMENTS.has(statement as any);\n};\n\nconst isSkippedDuringRestore = (item: unknown): item is 'vibrate' | 'dialog' | 'input' | 'choice' | 'text' => {\n\treturn SKIPPED_DURING_RESTORE.has(item as any);\n};\n\nconst isAudioAction = (action: unknown): action is   'playMusic' | 'stopMusic' | 'playSound' | 'stopSound' | 'voice' | 'stopVoice' => {\n\treturn AUDIO_ACTIONS.has(action as any);\n}\n\nconst noop = () => {};\n\nconst isAction = (element: unknown,): element is Exclude<ValidAction, ValidAction[]> => {\n\treturn Array.isArray(element) && isString(element[0]);\n};\n\n/**\n * Transforms `(ValidAction | ValidAction[])[]` to `ValidAction[]`\n */\nconst flattenStory = (story: Story) => {\n\tconst entries = Object.entries(story).map(([name, items]) => {\n\t\tconst flat = (item: (ValidAction | ValidAction[])[]): ValidAction[] => {\n\t\t\treturn item.flatMap((data) => {\n\t\t\t\tconst type = data[0];\n\n\t\t\t\t/**\n\t\t\t\t * This is not just an action like `['name', ...arguments]`, but an array of actions\n\t\t\t\t */\n\t\t\t\tif (Array.isArray(type)) return flat(data as ValidAction[]);\n\n\t\t\t\treturn [data as ValidAction];\n\t\t\t});\n\t\t};\n\n\t\treturn [name, flat(items)];\n\t});\n\n\treturn Object.fromEntries(entries);\n};\n\n/**\n * A wrapper on `fn` to make it run only once!\n * @param fn Function that needed to run no more than one time\n */\nconst once = (fn: () => void) => {\n\tlet ran = false;\n\n\treturn () => {\n\t\tif (ran) return;\n\n\t\tran = true;\n\t\tfn();\n\t};\n};\n\nconst isExitImpossible = (path: Path) => {\n\tconst blockStatements = path.filter(([item]) => isBlockStatement(item));\n\tconst blockExitStatements = path.filter(([item]) => isBlockExitStatement(item));\n\n\t/**\n\t * There were no blocks nor exits from blocks\n\t */\n\tif (blockStatements.length === 0 && blockExitStatements.length === 0) {\n\t\treturn true;\n\t}\n\n\t/**\n\t * There is block that can be exited\n\t */\n\tif (blockStatements.length > blockExitStatements.length) {\n\t\treturn false;\n\t}\n\n\treturn !blockExitStatements.every(([name], i) => name && name.startsWith(blockStatements[i][0]!))\n}\n\nconst getOppositeAction = (action: 'showCharacter' | 'playSound' | 'playMusic' | 'voice' | any) => {\n\tconst MAP = {\n\t\t'showCharacter': 'hideCharacter',\n\t\t'playSound': 'stopSound',\n\t\t'playMusic': 'stopMusic',\n\t\t'voice': 'stopVoice'\n\t} as const;\n\n\treturn MAP[action as keyof typeof MAP];\n}\n\n/**\n * @param story A story object\n * @param path A path by that actions will be gathered\n * @param filter true — actions that should be skipped would not be returned\n */\nconst getActionsFromPath = (story: Story, path: Path, filter: boolean) => {\n\t/**\n\t * Current item in the story\n\t */\n\tlet current: any = story;\n\t/**\n\t * Previous `current` value\n\t */\n\tlet precurrent: any;\n\t/**\n\t * Should we ignore some actions\n\t */\n\tlet ignoreNestedBefore: null | PathItem[0] = null;\n\t/**\n\t * Current item of type `[null, int]`\n\t */\n\tlet index = 0;\n\t/**\n\t * Skipped action that should be preserved\n\t */\n\tlet skipPreserve: Exclude<ValidAction, ValidAction[]> | undefined = undefined;\n\t/**\n\t * Actions that are either considered user action or skipped during restore process\n\t */\n\tconst skip = new Set<Exclude<ValidAction, ValidAction[]>>()\n\n\t/**\n\t * Cound of items of type `[null, int]`\n\t */\n\tconst max = path.reduce((acc, [type, val]) => {\n\t\tif (isNull(type) && isNumber(val)) {\n\t\t\treturn acc + 1;\n\t\t}\n\n\t\treturn acc;\n\t}, 0);\n\n\tconst queue = [] as Exclude<ValidAction, ValidAction[]>[];\n\tconst blocks = [];\n\n\tfor (const [type, val] of path) {\n\t\tif (type === 'jump') {\n\t\t\tprecurrent = story;\n\t\t\tcurrent = current[val];\n\t\t} else if (type === null) {\n\t\t\tprecurrent = current;\n\n\t\t\tif (isNumber(val)) {\n\t\t\t\tindex++;\n\n\t\t\t\tlet startIndex = 0;\n\n\t\t\t\tif (ignoreNestedBefore) {\n\t\t\t\t\tconst prev = findLastPathItemBeforeItemOfType(path.slice(0, index), ignoreNestedBefore)\n\n\t\t\t\t\tif (prev) {\n\t\t\t\t\t\tstartIndex = prev[1];\n\t\t\t\t\t\tignoreNestedBefore = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Запустим все экшены которые идут в `[null, int]` от `0` до `int`\n\t\t\t\t * Почему-то потребовалось изменить `<` на `<=`, чтобы последний action попадал сюда\n\t\t\t\t */\n\t\t\t\tfor (let i = startIndex; i <= val; i++) {\n\t\t\t\t\tconst item = current[i];\n\n\t\t\t\t\t/**\n\t\t\t\t\t * In case of broken save at least not throw\n\t\t\t\t\t * But is should not happen\n\t\t\t\t\t */\n\t\t\t\t\tif (!isAction(item)) continue;\n\n\t\t\t\t\tconst [action] = item;\n\n\t\t\t\t\tconst last = index === max && i === val;\n\t\t\t\t\tconst shouldSkip = isSkippedDuringRestore(action) || isUserRequiredAction(item);\n\n\t\t\t\t\tif (shouldSkip) {\n\t\t\t\t\t\tskip.add(item);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shouldSkip && last) {\n\t\t\t\t\t\tskipPreserve = item;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (filter && shouldSkip && !last) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tqueue.push(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcurrent = current[val];\n\t\t} else if (type === 'choice') {\n\t\t\tblocks.push(precurrent);\n\t\t\tcurrent = current[val + 1][1];\n\t\t} else if (type === 'condition') {\n\t\t\tblocks.push(precurrent);\n\t\t\tcurrent = current[2][val];\n\t\t} else if (type === 'block') {\n\t\t\tblocks.push(precurrent);\n\t\t\tcurrent = story[val];\n\t\t} else if (type === 'block:exit' || type === 'choice:exit' || type === 'condition:exit') {\n\t\t\tcurrent = blocks.pop();\n\t\t\tignoreNestedBefore = type.slice(0, -5) as PathItem[0]\n\t\t}\n\t}\n\n\treturn {\n\t\tqueue,\n\t\tskip,\n\t\tskipPreserve\n\t};\n}\n\ntype QueueProcessorOptions = {\n\tskip: Set<Exclude<ValidAction, ValidAction[]>>;\n\tskipPreserve?: Exclude<ValidAction, ValidAction[]> | undefined\n}\n\nconst createQueueProcessor = (queue: Exclude<ValidAction, ValidAction[]>[], options: QueueProcessorOptions) => {\n\tconst processedQueue: Exclude<ValidAction, ValidAction[]>[] = [];\n\n\tconst keep = new Set();\n\tconst characters = new Set();\n\tconst audio = {\n\t\tmusic: new Set(),\n\t\tsound: new Set()\n\t};\n\n\t/**\n\t * Get the next actions array.\n\t */\n\tconst next = (i: number) => queue.slice(i + 1);\n\n\tfor (const [i, item] of queue.entries()) {\n\t\tconst [action, ...params] = item;\n\n\t\tif (options.skip.has(item) && item !== options.skipPreserve) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tkeep.add(action);\n\n\t\tif (action === 'function' || action === 'custom') {\n\t\t\tif (action === 'custom') {\n\t\t\t\tconst fn = params[0] as CustomHandler;\n\n\t\t\t\tif ('callOnlyLatest' in fn && fn.callOnlyLatest) {\n\t\t\t\t\t/**\n\t\t\t\t\t * We'll calculate it is `latest` or not\n\t\t\t\t\t */\n\t\t\t\t\tconst notLatest = next(i).some(([, func]) => {\n\t\t\t\t\t\tif (!isFunction(func)) return false;\n\n\t\t\t\t\t\tconst c0 = func as CustomHandler;\n\t\t\t\t\t\tconst c1 = fn;\n\n\t\t\t\t\t\t// Also check for `undefined` so if two id's were undefined it would not be true\n\t\t\t\t\t\tconst isIdenticalID = Boolean(c0.id && c1.id && c0.id === c1.id);\n\t\t\t\t\t\tconst isIdenticalByReference = c0 === c1;\n\n\t\t\t\t\t\treturn isIdenticalID || isIdenticalByReference || str(c0) === str(c1);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (notLatest) continue;\n\t\t\t\t} else if ('skipOnRestore' in fn && fn.skipOnRestore) {\n\t\t\t\t\tif (fn.skipOnRestore(() => next(i))) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tprocessedQueue.push(item);\n\t\t} else if (action === 'showCharacter' || action === 'playSound' || action === 'playMusic' || action === 'voice') {\n\t\t\tconst closing = getOppositeAction(action);\n\n\t\t\tconst skip = next(i).some(([_action, target]) => {\n\t\t\t\tif (target !== params[0] && action !== 'voice') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst musicGonnaBePaused = action === 'playMusic' && _action === 'pauseMusic';\n\t\t\t\tconst soundGonnaBePaused = action === 'playSound' && _action === 'pauseSound';\n\n\t\t\t\t/**\n\t\t\t\t * It either will be closed OR same action will be ran again\n\t\t\t\t */\n\t\t\t\treturn musicGonnaBePaused || soundGonnaBePaused || _action === closing || _action === action;\n\t\t\t});\n\n\t\t\tif (skip) continue;\n\n\t\t\t/**\n\t\t\t * Actually, we do not need check above to add there things to keep because if something was hidden already we could not keep it visible\n\t\t\t */\n\t\t\tif (action === 'showCharacter') {\n\t\t\t\tcharacters.add(params[0])\n\t\t\t} else if (action === 'playMusic') {\n\t\t\t\taudio.music.add(unwrapAsset(params[0] as NovelyAsset))\n\t\t\t} else if (action === 'playSound') {\n\t\t\t\taudio.sound.add(unwrapAsset(params[0] as NovelyAsset))\n\t\t\t}\n\n\t\t\tprocessedQueue.push(item);\n\t\t} else if (action === 'showBackground' || action === 'preload') {\n\t\t\tconst skip = next(i).some(([_action]) => action === _action);\n\n\t\t\tif (skip) continue;\n\n\t\t\tprocessedQueue.push(item);\n\t\t} else if (action === 'animateCharacter') {\n\t\t\tconst skip = next(i).some(([_action, character], j, array) => {\n\t\t\t\t/**\n\t\t\t\t * Same character will be animated again. Ignore.\n\t\t\t\t */\n\t\t\t\tif (action === _action && character === params[0]) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tconst next = array.slice(j);\n\n\t\t\t\tconst characterWillAnimate = next.some(([__action, __character]) => action === __action);\n\t\t\t\tconst hasBlockingActions = next.some((item) => options.skip.has(item))\n\n\t\t\t\t/**\n\t\t\t\t * This is not a best check.\n\t\t\t\t *\n\t\t\t\t * @todo: make two animations for two different characters animate when not separeted by \"blocking actions\"\n\t\t\t\t */\n\t\t\t\treturn characterWillAnimate && hasBlockingActions\n\t\t\t});\n\n\t\t\tif (skip) continue;\n\n\t\t\tprocessedQueue.push(item);\n\t\t} else {\n\t\t\tprocessedQueue.push(item);\n\t\t}\n\t}\n\n\tconst run = async (match: (item: Exclude<ValidAction, ValidAction[]>) => Thenable<void>) => {\n\t\tfor await (const item of processedQueue) {\n\t\t\tconst result = match(item);\n\n\t\t\tif (isPromise(result)) {\n\t\t\t\tawait result;\n\t\t\t}\n\t\t}\n\n\t\tprocessedQueue.length = 0;\n\t}\n\n\treturn {\n\t\trun,\n\t\tkeep: {\n\t\t\tkeep,\n\t\t\tcharacters,\n\t\t\taudio\n\t\t}\n\t}\n}\n\nconst getStack = (ctx: Context) => {\n\tconst { id } = ctx;\n\tconst cached = STACK_MAP.get(id);\n\n\tif (cached) return cached;\n\n\tconst stack = [] as unknown as StackHolder;\n\n\tSTACK_MAP.set(id, stack);\n\n\treturn stack;\n}\n\nconst createUseStackFunction = (renderer: Renderer) => {\n\tconst useStack = (context: Context | string): UseStackFunctionReturnType => {\n\t\tconst ctx = typeof context === 'string' ? renderer.getContext(context) : context;\n\t\tconst stack = getStack(ctx);\n\n\t\treturn {\n\t\t\tget previous() {\n\t\t\t\treturn stack.previous;\n\t\t\t},\n\t\t\tget value() {\n\t\t\t\treturn stack.at(-1)!;\n\t\t\t},\n\t\t\tset value(value) {\n\t\t\t\tstack[stack.length - 1] = value;\n\t\t\t},\n\n\t\t\tback() {\n\t\t\t\tif (stack.length > 1) {\n\t\t\t\t\tstack.previous = stack.pop();\n\t\t\t\t\tctx.meta.goingBack = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\tpush(value: Save) {\n\t\t\t\tstack.push(value);\n\t\t\t},\n\t\t\tclear() {\n\t\t\t\tstack.previous = undefined;\n\n\t\t\t\tstack.length = 0;\n\t\t\t\tstack.length = 1;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn useStack;\n}\n\nconst mapSet = <T, K>(set: Set<T>, fn: (value: T, index: number, array: T[]) => K): K[] => {\n\treturn [...set].map(fn);\n}\n\nconst isImageAsset = (asset: unknown): asset is string => {\n\treturn isString(asset) && isCSSImage(asset)\n}\n\nconst getUrlFileExtension = (address: string) => {\n\ttry {\n\t\tconst { pathname } = new URL(address, location.href);\n\n\t\t/**\n\t\t * By using pathname we remove search params from URL, but some things are still preserved\n\t\t *\n\t\t * Imagine pathname like `image.png!private:1230`\n\t\t * Yes, very unlikely to happen, but it is possible\n\t\t */\n\t\treturn pathname.split('.').at(-1)!.split('!')[0].split(':')[0];\n\t} catch (error) {\n\t\tif (DEV) {\n\t\t\tconsole.error(new Error(`Could not construct URL \"${address}\".`, { cause: error }))\n\t\t}\n\n\t\treturn ''\n\t}\n}\n\nconst fetchContentType = async (request: typeof fetch, url: string) => {\n\ttry {\n\t\tconst response = await request(url, {\n\t\t\tmethod: 'HEAD'\n\t\t});\n\n\t\treturn response.headers.get('Content-Type') || '';\n\t} catch (error) {\n\t\tif (DEV) {\n\t\t\tconsole.error(new Error(`Failed to fetch file at \"${url}\"`, { cause: error }))\n\t\t}\n\n\t\treturn '';\n\t}\n}\n\nconst getResourseType = memoize(\n\tasync (request: typeof fetch, url: string) => {\n\t\t/**\n\t\t * If url is not http we should not check\n\t\t *\n\t\t * startsWith('http') || startsWith('/') || startsWith('.') || startsWith('data')\n\t\t */\n\t\tif (!isCSSImage(url)) {\n\t\t\treturn 'other'\n\t\t}\n\n\t\tconst extension = getUrlFileExtension(url);\n\n\t\tif (HOWLER_SUPPORTED_FILE_FORMATS.has(extension as any)) {\n\t\t\treturn 'audio'\n\t\t}\n\n\t\tif (SUPPORTED_IMAGE_FILE_FORMATS.has(extension as any)) {\n\t\t\treturn 'image'\n\t\t}\n\n\t\t/**\n\t\t * If checks above didn't worked we will fetch content type\n\t\t * This might not work because of CORS\n\t\t */\n\t\tconst contentType = await fetchContentType(request, url);\n\n\t\tif (contentType.includes('audio')) {\n\t\t\treturn 'audio'\n\t\t}\n\n\t\tif (contentType.includes('image')) {\n\t\t\treturn 'image'\n\t\t}\n\n\t\treturn 'other'\n\t},\n\t{\n\t\tisPromise: true\n\t}\n);\n\n/**\n * Capitalizes the string\n * @param str String without emojis or complex graphemes\n */\nconst capitalize = (str: string) => {\n\treturn str[0].toUpperCase() + str.slice(1);\n};\n\nconst getIntlLanguageDisplayName = memoize((lang: Lang) => {\n\t/**\n\t * When using Intl fails we just return language key.\n\t */\n\ttry {\n\t\tconst intl = new Intl.DisplayNames([lang], {\n\t\t\ttype: 'language',\n\t\t});\n\n\t\treturn intl.of(lang) || lang;\n\t} catch {\n\t\treturn lang;\n\t}\n})\n\nconst createReferFunction = (story: Story) => {\n\tconst refer = (path: Path) => {\n\t\tlet current: any = story;\n\t\tlet precurrent: any = story;\n\n\t\tconst blocks: any[] = [];\n\n\t\tfor (const [type, val] of path) {\n\t\t\tif (type === 'jump') {\n\t\t\t\tprecurrent = story;\n\t\t\t\tcurrent = current[val];\n\t\t\t} else if (type === null) {\n\t\t\t\tprecurrent = current;\n\t\t\t\tcurrent = current[val];\n\t\t\t} else if (type === 'choice') {\n\t\t\t\tblocks.push(precurrent);\n\t\t\t\tcurrent = current[(val as number) + 1][1];\n\t\t\t} else if (type === 'condition') {\n\t\t\t\tblocks.push(precurrent);\n\t\t\t\tcurrent = current[2][val];\n\t\t\t} else if (type === 'block') {\n\t\t\t\tblocks.push(precurrent);\n\t\t\t\tcurrent = story[val];\n\t\t\t} else if (type === 'block:exit' || type === 'choice:exit' || type === 'condition:exit') {\n\t\t\t\tcurrent = blocks.pop();\n\t\t\t}\n\t\t}\n\n\t\treturn current as Exclude<ValidAction, ValidAction[]>;\n\t};\n\n\treturn refer;\n}\n\ntype ReferFunction = ReturnType<typeof createReferFunction>;\n\ntype ExitPathConfig = {\n\tpath: Path;\n\trefer: ReferFunction;\n\n\tonExitImpossible?: () => void;\n}\n\nconst exitPath = ({ path, refer, onExitImpossible }: ExitPathConfig) => {\n\tconst last = path.at(-1);\n\tconst ignore: ('choice:exit' | 'condition:exit' | 'block:exit')[] = [];\n\n\tlet wasExitImpossible = false;\n\n\t/**\n\t * - should be an array\n\t * - first element is action name\n\t */\n\tif (!isAction(refer(path))) {\n\t\tif (last && isNull(last[0]) && isNumber(last[1])) {\n\t\t\tlast[1]--;\n\t\t} else {\n\t\t\tpath.pop();\n\t\t}\n\t}\n\n\tif (isExitImpossible(path)) {\n\t\tconst referred = refer(path);\n\n\t\tif (isAction(referred) && isSkippedDuringRestore(referred[0])) {\n\t\t\tonExitImpossible?.();\n\t\t}\n\n\t\twasExitImpossible = true;\n\n\t\treturn {\n\t\t\texitImpossible: wasExitImpossible\n\t\t}\n\t}\n\n\tfor (let i = path.length - 1; i > 0; i--) {\n\t\tconst [name] = path[i];\n\n\t\t/**\n\t\t * Remember already exited paths\n\t\t */\n\t\tif (isBlockExitStatement(name)) {\n\t\t\tignore.push(name);\n\t\t}\n\n\t\t/**\n\t\t * Ignore everything that we do not need there\n\t\t */\n\t\tif (!isBlockStatement(name)) continue;\n\n\t\t/**\n\t\t * When we found an already exited path we remove it from the list\n\t\t */\n\t\tif (ignore.at(-1)?.startsWith(name)) {\n\t\t\tignore.pop();\n\t\t\tcontinue;\n\t\t}\n\n\t\t/**\n\t\t * Exit from the path\n\t\t */\n\t\tpath.push([`${name}:exit`]);\n\n\t\tconst prev = findLastPathItemBeforeItemOfType(path.slice(0, i + 1), name);\n\n\t\t/**\n\t\t * When possible also go to the next action (or exit from one layer above)\n\t\t */\n\t\tif (prev) path.push([null, prev[1] + 1]);\n\n\t\t/**\n\t\t * If we added an `[null, int]` but it points not to action, then\n\t\t *\n\t\t * - remove that item\n\t\t * - close another block\n\t\t */\n\t\tif (!isAction(refer(path))) {\n\t\t\tpath.pop();\n\t\t\tcontinue;\n\t\t}\n\n\t\tbreak;\n\t}\n\n\treturn {\n\t\texitImpossible: wasExitImpossible\n\t}\n}\n\nconst nextPath = (path: Path) => {\n\t/**\n\t * Last path element\n\t */\n\tconst last = path.at(-1);\n\n\tif (last && (isNull(last[0]) || last[0] === 'jump') && isNumber(last[1])) {\n\t\tlast[1]++;\n\t} else {\n\t\tpath.push([null, 0]);\n\t}\n\n\treturn path;\n}\n\n/**\n * Is custom and requires user action or skipped during restoring\n */\nconst isBlockingAction = (action: Exclude<ValidAction, ValidAction[]>) => {\n\treturn isUserRequiredAction(action) || (isSkippedDuringRestore(action[0]) && action[0] !== 'vibrate')\n}\n\ntype CollectActionsBeforeBlockingActionOptions = {\n\tpath: Path;\n\trefer: ReferFunction;\n}\n\nconst collectActionsBeforeBlockingAction = ({ path, refer }: CollectActionsBeforeBlockingActionOptions) => {\n\tconst collection: Exclude<ValidAction, ValidAction[]>[] = []\n\n\tlet action = refer(path);\n\n\twhile (true) {\n\t\tif (action == undefined) {\n\t\t\tconst { exitImpossible } = exitPath({\n\t\t\t\tpath,\n\t\t\t\trefer,\n\t\t\t})\n\n\t\t\tif (exitImpossible) {\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tif (!action) {\n\t\t\tbreak;\n\t\t}\n\n\t\tif (isBlockingAction(action)) {\n\t\t\tconst [name, ...props] = action;\n\n\t\t\tif (name === 'choice') {\n\t\t\t\tconst choiceProps = props as unknown as GetActionParameters<'Choice'>;\n\n\t\t\t\tfor (let i = 0; i < choiceProps.length; i++) {\n\t\t\t\t\tconst branchContent = choiceProps[i];\n\n\t\t\t\t\t/**\n\t\t\t\t\t * This is a title\n\t\t\t\t\t */\n\t\t\t\t\tif (!Array.isArray(branchContent)) continue;\n\n\t\t\t\t\tconst virtualPath = klona(path)\n\n\t\t\t\t\tvirtualPath.push(['choice', i], [null, 0])\n\n\t\t\t\t\tconst innerActions = collectActionsBeforeBlockingAction({\n\t\t\t\t\t\tpath: virtualPath,\n\t\t\t\t\t\trefer\n\t\t\t\t\t});\n\n\t\t\t\t\tcollection.push(...innerActions);\n\t\t\t\t}\n\t\t\t} else if (name === 'condition') {\n\t\t\t\tconst conditionProps = props as unknown as GetActionParameters<'Condition'>;\n\t\t\t\tconst conditions = Object.keys(conditionProps[1]);\n\n\t\t\t\tfor (const condition of conditions) {\n\t\t\t\t\tconst virtualPath = klona(path)\n\n\t\t\t\t\tvirtualPath.push(['condition', condition], [null, 0])\n\n\t\t\t\t\tconst innerActions = collectActionsBeforeBlockingAction({\n\t\t\t\t\t\tpath: virtualPath,\n\t\t\t\t\t\trefer\n\t\t\t\t\t});\n\n\t\t\t\t\tcollection.push(...innerActions);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\t\t}\n\n\t\tcollection.push(action)\n\n\t\t/**\n\t\t * These special actions requires path change\n\t\t */\n\t\tif (action[0] === 'jump') {\n\t\t\tpath = [['jump', action[1]], [null, 0]]\n\t\t} else if (action[0] == 'block') {\n\t\t\tpath.push(['block', action[1]], [null, 0])\n\t\t} else {\n\t\t\tnextPath(path);\n\t\t}\n\n\t\taction = refer(path);\n\t}\n\n\treturn collection;\n}\n\nconst unwrapAsset = (asset: string | NovelyAsset) => {\n\treturn isAsset(asset) ? asset.source : asset;\n}\n\nconst handleAudioAsset = (asset: string | NovelyAsset) => {\n\tif (DEV && isAsset(asset) && asset.type !== 'audio') {\n\t\tthrow new Error('Attempt to use non-audio asset in audio action', { cause: asset });\n\t}\n\n\treturn unwrapAsset(asset);\n}\n\nconst handleImageAsset = (asset: string | NovelyAsset) => {\n\tif (DEV && isAsset(asset) && asset.type !== 'image') {\n\t\tthrow new Error('Attempt to use non-image asset in action that requires image assets', { cause: asset });\n\t}\n\n\treturn unwrapAsset(asset);\n}\n\nconst getCharactersData = <Characters extends Record<string, Character<Lang>>>(characters: Characters) => {\n\tconst entries = Object.entries(characters);\n\tconst mapped = entries.map(([key, value]) => [key, { name: value.name, emotions: Object.keys(value.emotions) }]);\n\n\treturn Object.fromEntries(mapped) as CharactersData<Characters>;\n}\n\nconst toArray = <T>(target: T | T[]) => {\n\treturn Array.isArray(target) ? target : [target]\n}\n\nexport {\n\tmatchAction,\n\tisNumber,\n\tisNull,\n\tisString,\n\tisPromise,\n\tisEmpty,\n\tisCSSImage,\n\tstr,\n\tisUserRequiredAction,\n\tgetLanguage,\n\tthrottle,\n\tisFunction,\n\tfindLastIndex,\n\tfindLast,\n\tcreateControlledPromise,\n\tfindLastPathItemBeforeItemOfType,\n\tisBlockStatement,\n\tisBlockExitStatement,\n\tisSkippedDuringRestore,\n\tnoop,\n\tisAction,\n\tisAudioAction,\n\tflattenStory,\n\tonce,\n\tisExitImpossible,\n\tgetOppositeAction,\n\tgetActionsFromPath,\n\tcreateQueueProcessor,\n\tgetStack,\n\tcreateUseStackFunction,\n\tmapSet,\n\tisImageAsset,\n\tgetUrlFileExtension,\n\tgetResourseType,\n\tcapitalize,\n\tgetIntlLanguageDisplayName,\n\tcreateReferFunction,\n\texitPath,\n\tcollectActionsBeforeBlockingAction,\n\tnextPath,\n\tisBlockingAction,\n\thandleAudioAsset,\n\thandleImageAsset,\n\tgetCharactersData,\n\ttoArray\n};\n\nexport type { MatchActionOptions, ControlledPromise, MatchActionMapComplete }\n","export function klona(val) {\n\tvar k, out, tmp;\n\n\tif (Array.isArray(val)) {\n\t\tout = Array(k=val.length);\n\t\twhile (k--) out[k] = (tmp=val[k]) && typeof tmp === 'object' ? klona(tmp) : tmp;\n\t\treturn out;\n\t}\n\n\tif (Object.prototype.toString.call(val) === '[object Object]') {\n\t\tout = {}; // null\n\t\tfor (k in val) {\n\t\t\tif (k === '__proto__') {\n\t\t\t\tObject.defineProperty(out, k, {\n\t\t\t\t\tvalue: klona(val[k]),\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\twritable: true,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tout[k] = (tmp=val[k]) && typeof tmp === 'object' ? klona(tmp) : tmp;\n\t\t\t}\n\t\t}\n\t\treturn out;\n\t}\n\n\treturn val;\n}\n","import type { NovelyAsset } from './types';\nimport { DEV } from 'esm-env';\nimport { getUrlFileExtension } from './utils';\nimport { supportsMap as audioSupport } from './audio-codecs';\nimport { supportsMap as imageSupport } from './image-formats';\nimport { HOWLER_SUPPORTED_FILE_FORMATS, SUPPORTED_IMAGE_FILE_FORMATS } from './constants';\nimport { default as memoize } from 'micro-memoize';\n\n/**\n * Function to get assets type. All assets must be of the same type. Only works with supported types.\n */\nconst getType = memoize((extensions: string[]) => {\n  if (extensions.every((extension) => HOWLER_SUPPORTED_FILE_FORMATS.has(extension as any))) {\n    return 'audio';\n  }\n\n  if (extensions.every((extension) => SUPPORTED_IMAGE_FILE_FORMATS.has(extension as any))) {\n    return 'image';\n  }\n\n  throw extensions;\n})\n\nconst SUPPORT_MAPS = {\n  'image': imageSupport,\n  'audio': audioSupport\n} as const;\n\n/**\n * Memoizes and returns an asset selection object based on provided file variants.\n * The selected asset depends on the client's support for various formats.\n *\n * @param {...string} variants - A variable number of strings, each representing a potential asset file URL.\n * @returns {NovelyAsset} An object representing the selected asset with `source` and `type` properties.\n *\n * @throws {Error} If in DEV mode and no arguments are provided.\n * @example\n * ```\n * import { asset } from 'novely';\n *\n * // Passed first have higher priority\n * const classroom = asset(\n *   'classroom.avif',\n *   'classroom.webp',\n *   'classroom.jpeg'\n * );\n *\n * setTimeout(() => {\n *   console.log(classroom.source);\n * }, 100);\n * ```\n */\nconst asset = memoize((...variants: string[]): NovelyAsset => {\n  if (DEV && variants.length === 0) {\n    throw new Error(`Attempt to use \"asset\" function without arguments`)\n  }\n\n  const map: Record<string, string> = {};\n  const extensions: string[] = [];\n\n  for (const v of variants) {\n    const e = getUrlFileExtension(v);\n\n    map[e] = v;\n    extensions.push(e);\n  }\n\n  const type = getType(extensions);\n\n  const getSource = memoize(() => {\n    const support = SUPPORT_MAPS[type];\n\n    for (const extension of extensions) {\n      if (extension in support) {\n        if (support[extension as keyof typeof support]) {\n          return map[extension];\n        }\n\n      } else {\n        return map[extension];\n      }\n    }\n\n    if (DEV) {\n      throw new Error(`No matching asset was found for ${variants.map(v => `\"${v}\"`).join(', ')}`)\n    }\n\n    return '';\n  });\n\n  return {\n    get source() {\n      return getSource();\n    },\n    get type() {\n      return type;\n    },\n  }\n})\n\nconst isAsset = (suspect: unknown): suspect is NovelyAsset => {\n  return suspect !== null && typeof suspect === 'object' && 'source' in suspect && 'type' in suspect;\n}\n\nexport { isAsset, asset }\n","/**\n * This code is adapted from the Howler.js source code.\n * Howler.js: https://github.com/goldfire/howler.js\n */\n\n/**\n * I guess some browsers will return \"no\". So it's better to be safe\n */\nconst cut = (str: CanPlayTypeResult | \"no\") => str.replace(/^no$/, '');\n\nconst audio = new Audio();\n\nconst canPlay = (type: string) => !!cut(audio.canPlayType(type));\nconst canPlayMultiple = (...types: string[]) => types.some(type => canPlay(type));\n\nconst supportsMap = {\n  mp3: canPlayMultiple('audio/mpeg;', 'audio/mp3;'),\n  mpeg: canPlay('audio/mpeg;'),\n  opus: canPlay('audio/ogg; codecs=\"opus\"'),\n  ogg: canPlay('audio/ogg; codecs=\"vorbis\"'),\n  oga: canPlay('audio/ogg; codecs=\"vorbis\"'),\n  wav: canPlayMultiple('audio/wav; codecs=\"1\"', 'audio/wav;'),\n  aac: canPlay('audio/aac;'),\n  caf: canPlay('audio/x-caf;'),\n  m4a: canPlayMultiple('audio/x-m4a;', 'audio/m4a;', 'audio/aac;'),\n  m4b: canPlayMultiple('audio/x-m4b;', 'audio/m4b;', 'audio/aac;'),\n  mp4: canPlayMultiple('audio/x-mp4;', 'audio/mp4;', 'audio/aac;'),\n  weba: canPlay('audio/webm; codecs=\"vorbis\"'),\n  webm: canPlay('audio/webm; codecs=\"vorbis\"'),\n  dolby: canPlay('audio/mp4; codecs=\"ec-3\"'),\n  flac: canPlayMultiple('audio/x-flac;', 'audio/flac;')\n};\n\nexport { supportsMap }\n","const avif = \"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=\";\nconst jxl  = \"data:image/jxl;base64,/woIAAAMABKIAgC4AF3lEgAAFSqjjBu8nOv58kOHxbSN6wxttW1hSaLIODZJJ3BIEkkaoCUzGM6qJAE=\";\nconst webp = \"data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA\";\n\nconst supportsFormat = (source: string) => {\n  const { promise, resolve } = Promise.withResolvers<boolean>();\n\n  const img = Object.assign(document.createElement('img'), {\n    src: source\n  })\n\n  img.onload = img.onerror = () => {\n    resolve(img.height === 2);\n  }\n\n  return promise;\n}\n\nconst supportsMap = {\n  avif: false,\n  jxl: false,\n  webp: false\n}\n\nconst formatsMap = {\n  avif,\n  jxl,\n  webp\n} as const;\n\nconst loadImageFormatsSupport = async () => {\n  const promises = [];\n\n  for (const [format, source] of Object.entries(formatsMap)) {\n    const promise = supportsFormat(source).then(supported => {\n      supportsMap[format as keyof typeof supportsMap] = supported;\n    });\n\n    promises.push(promise);\n  }\n\n  await Promise.all(promises);\n};\n\nloadImageFormatsSupport();\n\nexport { supportsMap }\n","import type { Character } from './character';\nimport type {\n\tActionProxy,\n\tStory,\n\tValidAction,\n\tTextContent,\n\tCustomHandler,\n} from './action';\nimport type {\n\tSave,\n\tState,\n\tData,\n\tStorageData,\n\tCoreData,\n\tNovelyInit,\n\tStateFunction,\n\tLang,\n\tTypeEssentials\n} from './types';\nimport type { Stored } from './store';\nimport type { Context, RendererInitPreviewReturn } from './renderer';\nimport type { BaseTranslationStrings } from './translations';\nimport type { ControlledPromise, MatchActionOptions } from './utils';\nimport {\n\tmatchAction,\n\tisEmpty,\n\tgetLanguage as defaultGetLanguage,\n\tthrottle,\n\tisFunction,\n\tcreateControlledPromise,\n\tisAction,\n\tnoop,\n\tflattenStory,\n\tgetActionsFromPath,\n\tcreateUseStackFunction,\n\tcreateQueueProcessor,\n\tisAudioAction,\n\tisString,\n\tgetResourseType,\n\tcapitalize,\n\tgetIntlLanguageDisplayName,\n\tcreateReferFunction,\n\texitPath,\n\tnextPath,\n\tisPromise,\n\tisBlockingAction,\n\tcollectActionsBeforeBlockingAction,\n\thandleAudioAsset,\n\tgetCharactersData,\n\thandleImageAsset,\n\ttoArray\n} from './utils';\nimport { dequal } from 'dequal/lite';\nimport { store } from './store';\nimport { deepmerge } from '@novely/deepmerge';\nimport { klona } from 'klona/json';\nimport { EMPTY_SET, DEFAULT_TYPEWRITER_SPEED, MAIN_CONTEXT_KEY } from './constants';\nimport { replace as replaceTranslation, flattenAllowedContent } from './translation';\nimport { handleCustomAction, getCustomActionHolder } from './custom-action'\nimport { localStorageStorage } from './storage';\nimport { setupBrowserVisibilityChangeListeners } from './browser';\nimport pLimit from 'p-limit';\n\nimport { DEV } from 'esm-env';\nimport { STACK_MAP, PRELOADED_ASSETS, ASSETS_TO_PRELOAD } from './shared';\nimport { enqueueAssetForPreloading, handleAssetsPreloading, huntAssets } from './preloading';\nimport { isAsset } from './asset';\n\nconst novely = <\n\t$Language extends string,\n\t$Characters extends Record<string, Character<$Language>>,\n\t$State extends State,\n\t$Data extends Data,\n\t$Actions extends Record<string, (...args: any[]) => ValidAction>\n>({\n\tcharacters,\n\tcharacterAssetSizes = {},\n\tdefaultEmotions = {},\n\tstorage = localStorageStorage({ key: 'novely-game-storage' }),\n\tstorageDelay = Promise.resolve(),\n\trenderer: createRenderer,\n\tinitialScreen = 'mainmenu',\n\ttranslation,\n\tstate: defaultState = {} as $State,\n\tdata: defaultData = {} as $Data,\n\tautosaves = true,\n\tmigrations = [],\n\tthrottleTimeout = 799,\n\tgetLanguage = defaultGetLanguage,\n\toverrideLanguage = false,\n\taskBeforeExit = true,\n\tpreloadAssets = 'lazy',\n\tparallelAssetsDownloadLimit = 15,\n\tfetch: request = fetch,\n\tsaveOnUnload = true,\n\tstartKey = 'start'\n}: NovelyInit<$Language, $Characters, $State, $Data, $Actions>) => {\n\t// Local type declaration to not repeat code\n\t/**\n\t * All action functions\n\t */\n\ttype Actions = $Actions & ActionProxy<$Characters, $Language, $State>;\n\n\tconst languages = Object.keys(translation) as $Language[];\n\n\tconst limitScript = pLimit(1);\n\tconst limitAssetsDownload = pLimit(parallelAssetsDownloadLimit);\n\n\tconst story: Story = {};\n\n\tconst times = new Set<number>();\n\n\tconst dataLoaded = createControlledPromise();\n\n\tlet initialScreenWasShown = false;\n\tlet destroyed = false;\n\n\t/**\n\t * Saves timestamps created in this session\n\t */\n\tconst intime = (value: number) => {\n\t\treturn times.add(value), value;\n\t};\n\n\tconst scriptBase = async (part: Story) => {\n\t\t/**\n\t\t * In case script was called after destroy\n\t\t */\n\t\tif (destroyed) return;\n\n\t\tObject.assign(story, flattenStory(part));\n\n\t\tlet loadingIsShown = false;\n\n\t\t/**\n\t\t * This is the first `script` call, likely data did not loaded yet\n\t\t */\n\t\tif (!initialScreenWasShown) {\n\t\t\trenderer.ui.showLoading();\n\t\t\tloadingIsShown = true;\n\t\t}\n\n\t\tif (preloadAssets === 'blocking' && ASSETS_TO_PRELOAD.size > 0) {\n\t\t\t/**\n\t\t\t * Likely updating this will not break anything, but just to be sure nothing breaks\n\t\t\t * We want to avoid flashes, and who knows how some renderer will use it\n\t\t\t */\n\t\t\tif (!loadingIsShown) {\n\t\t\t\trenderer.ui.showLoading();\n\t\t\t}\n\n\t\t\tawait handleAssetsPreloading({\n\t\t\t\t...renderer.misc,\n\t\t\t\tlimiter: limitAssetsDownload,\n\t\t\t\trequest,\n\t\t\t});\n\t\t}\n\n\t\tawait dataLoaded.promise;\n\n\t\trenderer.ui.hideLoading()\n\n\t\tif (!initialScreenWasShown) {\n\t\t\tinitialScreenWasShown = true;\n\n\t\t\tif (initialScreen === 'game') {\n\t\t\t\trestore(undefined);\n\t\t\t} else {\n\t\t\t\trenderer.ui.showScreen(initialScreen);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Setup your story here\n\t *\n\t * Call more than once to merge different story parts\n\t *\n\t * @example\n\t *\n\t * ```js\n\t * engine.script({\n\t *  start: [action.jump('another-part')]\n\t * })\n\t *\n\t * engine.script({\n\t *  'another-part': []\n\t * })\n\t * ```\n\t */\n\tconst script = (part: Story) => {\n\t\treturn limitScript(() => scriptBase(part));\n\t}\n\n\tconst action = new Proxy({} as Actions, {\n\t\tget<Action extends keyof Actions & string>(_: unknown, action: Action) {\n\t\t\tif (action in renderer.actions) {\n\t\t\t\treturn renderer.actions[action];\n\t\t\t}\n\n\t\t\treturn (...props: Parameters<Actions[Action]>) => {\n\t\t\t\tif (preloadAssets === 'blocking') {\n\t\t\t\t\t// @ts-expect-error\n\t\t\t\t\thuntAssets({ characters, action, props, handle: enqueueAssetForPreloading })\n\t\t\t\t}\n\n\t\t\t\treturn [action, ...props] as ValidAction;\n\t\t\t};\n\t\t},\n\t});\n\n\tconst getDefaultSave = (state = {}) => {\n\t\treturn [\n\t\t\t[\n\t\t\t\t['jump', startKey],\n\t\t\t\t[null, 0],\n\t\t\t],\n\t\t\tstate,\n\t\t\t[intime(Date.now()), 'auto'],\n\t\t] as Save;\n\t};\n\n\t/**\n\t * Calls `getLanguage`, passes needed arguments\n\t * @returns language\n\t */\n\tconst getLanguageWithoutParameters = () => {\n\t\tconst language = getLanguage(languages, defaultGetLanguage);\n\n\t\t/**\n\t\t * This is valid language\n\t\t */\n\t\tif (languages.includes(language as $Language)) {\n\t\t\treturn language as $Language;\n\t\t}\n\n\t\tif (DEV) {\n\t\t\tthrow new Error(`Attempt to use unsupported language \"${language}\". Supported languages: ${languages.join(', ')}.`)\n\t\t}\n\n\t\tthrow 0;\n\t};\n\n\t/**\n\t * 1) Novely rendered using the `initialData`, but you can't start new game or `load` an empty one - this is scary, imagine losing your progress\n\t * 2) Actual stored data is loaded, language and etc is changed\n\t */\n\tconst initialData: StorageData<$Language, $Data> = {\n\t\tsaves: [],\n\t\tdata: klona(defaultData),\n\t\tmeta: [getLanguageWithoutParameters(), DEFAULT_TYPEWRITER_SPEED, 1, 1, 1],\n\t};\n\n\tconst storageData = store(initialData);\n\tconst coreData = store<CoreData>({\n\t\tdataLoaded: false\n\t});\n\n\tconst onDataLoadedPromise = ({ cancelled }: Awaited<ControlledPromise<void>>) => {\n\t\t/**\n\t\t * Promise cancelled? Re-subscribe\n\t\t */\n\t\tif (cancelled) {\n\t\t\tdataLoaded.promise.then(onDataLoadedPromise);\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * When promise is resolved data is marked loaded\n\t\t */\n\t\tcoreData.update((data) => {\n\t\t\tdata.dataLoaded = true;\n\n\t\t\treturn data;\n\t\t})\n\t};\n\n\tdataLoaded.promise.then(onDataLoadedPromise);\n\n\tconst onStorageDataChange = (value: StorageData) => {\n\t\tif (coreData.get().dataLoaded) storage.set(value);\n\t};\n\n\tconst throttledOnStorageDataChange = throttle(onStorageDataChange, throttleTimeout);\n\tconst throttledEmergencyOnStorageDataChange = throttle(() => {\n\t\tif (saveOnUnload === true || saveOnUnload === 'prod' && !DEV) {\n\t\t\tonStorageDataChange(storageData.get());\n\t\t}\n\t}, 10);\n\n\tstorageData.subscribe(throttledOnStorageDataChange);\n\n\tconst getStoredData = async () => {\n\t\tlet stored = await storage.get();\n\n\t\tfor (const migration of migrations) {\n\t\t\tstored = migration(stored) as StorageData;\n\n\t\t\tif (DEV && !stored) {\n\t\t\t\tthrow new Error('Migrations should return a value.')\n\t\t\t}\n\t\t}\n\n\t\tif (overrideLanguage || !stored.meta[0]) {\n\t\t\tstored.meta[0] = getLanguageWithoutParameters();\n\t\t}\n\n\t\t/**\n\t\t * Default `localStorageStorage` returns empty array\n\t\t */\n\t\tstored.meta[1] ||= DEFAULT_TYPEWRITER_SPEED;\n\n\t\t/**\n\t\t * Sound Volumes\n\t\t */\n\t\tstored.meta[2] ??= 1;\n\t\tstored.meta[3] ??= 1;\n\t\tstored.meta[4] ??= 1;\n\n\t\t/**\n\t\t * When data is empty replace it with `defaultData`\n\t\t * It also might be empty (default to empty)\n\t\t */\n\t\tif (isEmpty(stored.data)) {\n\t\t\tstored.data = defaultData as Data;\n\t\t}\n\n\t\t/**\n\t\t * Now the next store updates will entail saving via storage.set\n\t\t */\n\t\tdataLoaded.resolve();\n\n\t\tstorageData.set(stored as StorageData<$Language, $Data>);\n\t};\n\n\t/**\n\t * By default this is resolved immediately, but also can be delayed.\n\t * I.e. storage has not loaded yet\n\t */\n\tstorageDelay.then(getStoredData);\n\n\tconst initial = getDefaultSave(klona(defaultState));\n\n\tconst unsubscribeFromBrowserVisibilityChange = setupBrowserVisibilityChangeListeners({\n\t\tonChange: throttledEmergencyOnStorageDataChange\n\t})\n\n\tconst save = (type: Save[2][1]) => {\n\t\tif (!coreData.get().dataLoaded) return;\n\n\t\t/**\n\t\t * When autosaves diabled just return\n\t\t */\n\t\tif (!autosaves && type === 'auto') return;\n\n\t\t/**\n\t\t * Saves only possible in main context, so there is no reason for context to be used here\n\t\t */\n\t\tconst stack = useStack(MAIN_CONTEXT_KEY);\n\t\tconst current = klona(stack.value);\n\n\t\tstorageData.update((prev) => {\n\t\t\tconst replace = () => {\n\t\t\t\tprev.saves[prev.saves.length - 1] = current;\n\n\t\t\t\treturn prev;\n\t\t\t}\n\n\t\t\tconst add = () => {\n\t\t\t\tprev.saves.push(current);\n\n\t\t\t\treturn prev;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Get latest\n\t\t\t */\n\t\t\tconst last = prev.saves.at(-1);\n\n\t\t\t/**\n\t\t\t * We cannot compare anything here, thus just reutrn\n\t\t\t */\n\t\t\tif (!last) return add();\n\n\t\t\t/**\n\t\t\t * Update type and time information\n\t\t\t */\n\t\t\tcurrent[2][0] = intime(Date.now());\n\t\t\tcurrent[2][1] = type;\n\n\t\t\tconst isIdentical = (dequal(last[0], current[0]) && dequal(last[1], current[1]));\n\t\t\tconst isLastMadeInCurrentSession = times.has(last[2][0]);\n\n\t\t\t/**\n\t\t\t * Even in override is false, we will replace auto save with maual, because they are the same thing basically\n\t\t\t */\n\t\t\tif (isLastMadeInCurrentSession && last[2][1] === 'auto' && type === 'manual') {\n\t\t\t\treturn replace();\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Player has made a manual save, novely decided to make an auto save\n\t\t\t * But it is identical to previously created manual save so completely not wanted\n\t\t\t */\n\t\t\tif (last[2][1] === 'manual' && type === 'auto' && isIdentical) {\n\t\t\t\treturn prev;\n\t\t\t}\n\n\t\t\tif (isLastMadeInCurrentSession && last[2][1] === 'auto' && type === 'auto') {\n\t\t\t\treturn replace();\n\t\t\t}\n\n\t\t\treturn add();\n\t\t});\n\t};\n\n\tconst newGame = () => {\n\t\tif (!coreData.get().dataLoaded) return;\n\n\t\tconst save = getDefaultSave(klona(defaultState));\n\n\t\t/**\n\t\t * Initial save is automatic, and should be ignored when autosaves is turned off\n\t\t */\n\t\tif (autosaves) {\n\t\t\tstorageData.update((prev) => {\n\t\t\t\treturn prev.saves.push(save), prev;\n\t\t\t});\n\t\t}\n\n\t\tconst context = renderer.getContext(MAIN_CONTEXT_KEY);\n\t\tconst stack = useStack(context);\n\n\t\tstack.value = save;\n\t\tcontext.meta.restoring = context.meta.goingBack = false;\n\n\t\trenderer.ui.showScreen('game');\n\n\t\trender(context);\n\t};\n\n\t/**\n\t * Set's the save and restores onto it\n\t */\n\tconst set = (save: Save, ctx?: Context) => {\n\t\tconst stack = useStack(ctx || MAIN_CONTEXT_KEY);\n\n\t\tstack.value = save;\n\n\t\treturn restore(save);\n\t};\n\n\tlet interacted = 0;\n\n\t/**\n\t * Restore save or if none is passed then look for latest save, if there is no saves will create a new save\n\t */\n\tconst restore = async (save: Save | undefined) => {\n\t\tif (isEmpty(story)) {\n\t\t\tif (DEV) {\n\t\t\t\tthrow new Error('Story is empty. You should call an `enine.script` function [https://novely.pages.dev/guide/story.html]')\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!coreData.get().dataLoaded) return;\n\n\t\tlet latest = save || storageData.get().saves.at(-1);\n\n\t\t/**\n\t\t * When there is no save, make a new save\n\t\t */\n\t\tif (!latest) {\n\t\t\tlatest = klona(initial)\n\n\t\t\tstorageData.update((prev) => {\n\t\t\t\t/**\n\t\t\t\t * `latest` will be not undefined because this callback called immediately and variable is not changed\n\t\t\t\t */\n\t\t\t\tprev.saves.push(latest!);\n\n\t\t\t\treturn prev\n\t\t\t})\n\t\t}\n\n\t\tconst context = renderer.getContext(MAIN_CONTEXT_KEY);\n\t\tconst stack = useStack(context);\n\n\t\tcontext.meta.restoring = true;\n\n\t\tconst previous = stack.previous;\n\n\t\tconst [path] = stack.value = latest;\n\n\t\trenderer.ui.showScreen('game');\n\n\t\tconst { queue, skip, skipPreserve } = getActionsFromPath(story, path, false);\n\t\tconst { run, keep: { keep, characters, audio } } = createQueueProcessor(queue, {\n\t\t\tskip,\n\t\t\tskipPreserve\n\t\t});\n\n\t\tif (previous) {\n\t\t\tconst { queue: prevQueue } = getActionsFromPath(story, previous[0], false);\n\n\t\t\tfor (let i = prevQueue.length - 1; i > queue.length - 1; i--) {\n\t\t\t\tconst element = prevQueue[i];\n\n\t\t\t\t/**\n\t\t\t\t * Just in case 🤷\n\t\t\t\t */\n\t\t\t\tif (!isAction(element)) {\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\n\t\t\t\tconst [action, fn] = element;\n\n\t\t\t\t/**\n\t\t\t\t * Imagine array of actions like\n\t\t\t\t *\n\t\t\t\t * [\n\t\t\t\t *  ['dialog', ...props]\n\t\t\t\t *  ['showBackground', ...props]\n\t\t\t\t *  ['custom', function]\n\t\t\t\t * ]\n\t\t\t\t *\n\t\t\t\t * When player goes back array changes to\n\t\t\t\t *\n\t\t\t\t * [\n\t\t\t\t *  ['dialog', ...props]\n\t\t\t\t * ]\n\t\t\t\t *\n\t\t\t\t * We catch these custom actions that are gone and\n\t\t\t\t * call their clear methods so there is no side effects\n\t\t\t\t * from future in the past\n\t\t\t\t */\n\t\t\t\tif (action === 'custom') {\n\t\t\t\t\tgetCustomActionHolder(context, fn).cleanup();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (context.meta.goingBack) {\n\t\t\t/**\n\t\t\t * Context is cleared at exit, so it is dirty only when goingBack\n\t\t\t */\n\t\t\tmatch('clear', [keep, characters, audio], {\n\t\t\t\tctx: context,\n\t\t\t\tdata: latest[1]\n\t\t\t});\n\t\t}\n\n\t\tconst lastQueueItem = queue.at(-1)\n\t\tconst lastQueueItemRequiresUserAction = lastQueueItem && isBlockingAction(lastQueueItem)\n\n\t\tawait run((item) => {\n\t\t\tif (!latest) return;\n\n\t\t\t/**\n\t\t\t * Skip because last item will be ran again by `render(context)` call\n\t\t\t */\n\t\t\tif (lastQueueItem === item && lastQueueItemRequiresUserAction) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst [action, ...props] = item;\n\n\t\t\treturn match(action, props, {\n\t\t\t\tctx: context,\n\t\t\t\tdata: latest[1]\n\t\t\t});\n\t\t});\n\n\t\tif (!context.meta.goingBack) {\n\t\t\t/**\n\t\t\t * When not goingBack setting restoring to false is required to go forward\n\t\t\t * Because when restoring action do not call the resolve function which goes to next action but are controlled\n\t\t\t */\n\t\t\tcontext.meta.restoring = false;\n\t\t}\n\n\t\trender(context);\n\n\t\tcontext.meta.restoring = context.meta.goingBack = false;\n\t};\n\n\tconst refer = createReferFunction(story);\n\n\t/**\n\t * @param force Force exit\n\t */\n\tconst exit = (force = false, saving = true) => {\n\t\t/**\n\t\t * Exit only possible in main context\n\t\t */\n\t\tconst ctx = renderer.getContext(MAIN_CONTEXT_KEY);\n\n\t\tconst stack = useStack(ctx);\n\t\tconst current = stack.value;\n\n\t\tconst isSaved = () => {\n\t\t\tconst { saves } = storageData.get();\n\t\t\tconst [currentPath, currentData] = stack.value;\n\n\t\t\treturn saves.some(([path, data, [date, type]]) => type === 'manual' && times.has(date) && dequal(path, currentPath) && dequal(data, currentData))\n\t\t}\n\n\t\tif (interacted > 1 && !force && askBeforeExit && !isSaved()) {\n\t\t\trenderer.ui.showExitPrompt();\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * Imagine list of actions like\n\t\t *\n\t\t * [\n\t\t *  ['input', ...args]\n\t\t *  ['dialog', ...args]\n\t\t * ]\n\t\t *\n\t\t * When you have done with input, you will go to the dialog\n\t\t * And at that moment you exit the game\n\t\t *\n\t\t * What happens? Input was \"enmemoried\", but dialog not. So when you will open saves, you'll see input action.\n\t\t * We cannot \"enmemory\" dialog when it's just started, because goingBack is going to last enmemoried item, which will be that dialog, so impossible to go back.\n\t\t *\n\t\t * What we do is enmemory on exit.\n\t\t */\n\t\tif (interacted > 0 && saving) {\n\t\t\tsave('auto');\n\t\t}\n\n\t\tstack.clear();\n\t\tctx.clear(EMPTY_SET, EMPTY_SET, { music: EMPTY_SET, sounds: EMPTY_SET }, noop);\n\t\trenderer.ui.showScreen('mainmenu');\n\t\tctx.audio.destroy();\n\n\t\tconst [time, type] = current[2];\n\n\t\t/**\n\t\t * This is auto save and belongs to the current session\n\t\t * Player did not interacted or did it once, so this is probably not-needed save\n\t\t */\n\t\tif (type === 'auto' && interacted <= 1 && times.has(time)) {\n\t\t\tstorageData.update((prev) => {\n\t\t\t\tprev.saves = prev.saves.filter((save) => save !== current);\n\n\t\t\t\treturn prev;\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Reset interactive value\n\t\t */\n\t\tinteractivity(false);\n\t\t/**\n\t\t * Reset session times\n\t\t */\n\t\ttimes.clear();\n\t};\n\n\tconst back = async () => {\n\t\t/**\n\t\t * Back also happens in main context only\n\t\t */\n\t\tconst stack = useStack(MAIN_CONTEXT_KEY);\n\n\t\tconst valueBeforeBack = stack.value;\n\n\t\tstack.back();\n\n\t\t/**\n\t\t * There was only one item in the stack so there is no `stack.previous`, also `ctx.meta.goingBack` did not changed\n\t\t */\n\t\tif (dequal(valueBeforeBack, stack.value) && !stack.previous) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait restore(stack.value);\n\t};\n\n\tconst t = (key: BaseTranslationStrings, lang: string | $Language) => {\n\t\treturn translation[lang as $Language].internal[key];\n\t};\n\n\t/**\n\t * Execute save in context named `name`\n\t * @param save Save\n\t * @param name Context name\n\t */\n\tconst preview = async (save: Save, name: string): Promise<RendererInitPreviewReturn> => {\n\t\tif (isEmpty(story)) {\n\t\t\treturn Promise.resolve({\n\t\t\t\tassets: [],\n\t\t\t})\n\t\t}\n\n\t\tconst [path, data] = save;\n\n\t\tconst { queue } = getActionsFromPath(story, path, true);\n\t\tconst ctx = renderer.getContext(name);\n\n\t\t/**\n\t\t * Enter restoring mode in action\n\t\t */\n\t\tctx.meta.restoring = true;\n\t\tctx.meta.preview = true;\n\n\t\tconst processor = createQueueProcessor(queue, {\n\t\t\tskip: EMPTY_SET,\n\t\t});\n\n\t\tuseStack(ctx).push(klona(save));\n\n\t\tconst assets: string[] = [];\n\n\t\tawait processor.run(([action, ...props]) => {\n\t\t\tif (isAudioAction(action)) return;\n\t\t\tif (action === 'vibrate') return;\n\t\t\tif (action === 'end') return;\n\n\t\t\t// @ts-expect-error\n\t\t\thuntAssets({ characters, action, props, handle: assets.push.bind(assets) })\n\n\t\t\treturn match(action, props, {\n\t\t\t\tctx,\n\t\t\t\tdata,\n\t\t\t});\n\t\t});\n\n\t\treturn {\n\t\t\tassets,\n\t\t}\n\t}\n\n\tconst removeContext = (name: string) => {\n\t\tSTACK_MAP.delete(name);\n\t}\n\n\tconst getStateAtCtx = (context: string | Context) => {\n\t\treturn useStack(context).value[1];\n\t}\n\n\tconst getStateFunction = (context: string | Context) => {\n\t\tconst stack = useStack(context);\n\n\t\tconst state = ((value) => {\n\t\t\tconst _state = getStateAtCtx(context);\n\n\t\t\tif (!value) {\n\t\t\t\treturn _state;\n\t\t\t}\n\n\t\t\tconst prev = _state;\n\t\t\tconst val = isFunction(value) ? value(prev) : deepmerge(prev, value);\n\n\t\t\tstack.value[1] = val;\n\n\t\t\treturn undefined;\n\t\t}) as StateFunction<State>;\n\n\t\treturn state;\n\t}\n\n\tconst getLanguageDisplayName = (lang: Lang) => {\n\t\tconst language = translation[lang as $Language];\n\n\t\tif (DEV && !language) {\n\t\t\tthrow new Error(`Attempt to use unsupported language \"${language}\". Supported languages: ${languages.join(', ')}.`)\n\t\t}\n\n\t\treturn capitalize(language.nameOverride || getIntlLanguageDisplayName(lang));\n\t}\n\n\tconst clearCustomAction = (ctx: Context, fn: CustomHandler) => {\n\t\tgetCustomActionHolder(ctx, fn).cleanup();\n\t}\n\n\tconst getResourseTypeForRenderer = (url: string) => {\n\t\treturn getResourseType(request, url);\n\t}\n\n\tconst getCharacterColor = (c: keyof $Characters) => {\n\t\treturn c in characters ? characters[c].color : '#000000'\n\t}\n\n\tconst getCharacterAssets = (character: string, emotion: string) => {\n\t\treturn toArray(characters[character].emotions[emotion]).map(handleImageAsset);\n\t}\n\n\tconst renderer = createRenderer({\n\t\tmainContextKey: MAIN_CONTEXT_KEY,\n\n\t\tcharacters: getCharactersData(characters),\n\t\tcharacterAssetSizes,\n\t\tset,\n\t\trestore,\n\t\tsave,\n\t\tnewGame,\n\t\texit,\n\t\tback,\n\t\tt,\n\t\tpreview,\n\t\tremoveContext,\n\t\tgetStateFunction,\n\t\tclearCustomAction,\n\t\tlanguages,\n\t\tstorageData: storageData as unknown as Stored<StorageData<string, Data>>,\n\t\tcoreData,\n\n\t\tgetLanguageDisplayName,\n\t\tgetCharacterColor,\n\t\tgetCharacterAssets,\n\n\t\tgetResourseType: getResourseTypeForRenderer\n\t});\n\n\tconst useStack = createUseStackFunction(renderer);\n\n\t/**\n\t * Initiate\n\t */\n\tuseStack(MAIN_CONTEXT_KEY).push(initial);\n\n\tconst UIInstance = renderer.ui.start();\n\n\tconst enmemory = (ctx: Context) => {\n\t\tif (ctx.meta.restoring) return;\n\n\t\tconst stack = useStack(ctx);\n\n\t\tconst current = klona(stack.value);\n\n\t\tcurrent[2][1] = 'auto';\n\n\t\tstack.push(current);\n\n\t\tsave('auto');\n\t};\n\n\tconst next = (ctx: Context) => {\n\t\tconst stack = useStack(ctx);\n\t\tconst path = stack.value[0];\n\n\t\tnextPath(path);\n\t};\n\n\tconst matchActionOptions: MatchActionOptions = {\n\t\tgetContext: renderer.getContext,\n\t\tpush(ctx) {\n\t\t\tif (ctx.meta.restoring) return;\n\n\t\t\tnext(ctx);\n\t\t\trender(ctx);\n\t\t},\n\t\tforward(ctx) {\n\t\t\tif (!ctx.meta.preview) enmemory(ctx);\n\n\t\t\tmatchActionOptions.push(ctx);\n\n\t\t\tif (!ctx.meta.preview) interactivity(true);\n\t\t},\n\t\tonBeforeActionCall({ action, props, ctx }) {\n\t\t\tif (preloadAssets !== 'automatic') return;\n\t\t\tif (ctx.meta.preview || ctx.meta.restoring) return;\n\t\t\tif (!isBlockingAction([action, ...props] as unknown as Exclude<ValidAction, ValidAction[]>)) return;\n\n\t\t\ttry {\n\t\t\t\tconst collection = collectActionsBeforeBlockingAction({\n\t\t\t\t\tpath: nextPath(klona(useStack(ctx).value[0])),\n\t\t\t\t\trefer\n\t\t\t\t})\n\n\t\t\t\tfor (const [action, ...props] of collection) {\n\t\t\t\t\t// @ts-expect-error\n\t\t\t\t\thuntAssets({ characters, action, props, handle: enqueueAssetForPreloading })\n\t\t\t\t}\n\n\t\t\t\thandleAssetsPreloading({\n\t\t\t\t\t...renderer.misc,\n\t\t\t\t\trequest,\n\t\t\t\t\tlimiter: limitAssetsDownload,\n\t\t\t\t})\n\t\t\t} catch (cause) {\n\t\t\t\tconsole.error(cause);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst match = matchAction(matchActionOptions, {\n\t\twait({ ctx, push }, [time]) {\n\t\t\tif (ctx.meta.restoring) return;\n\n\t\t\tsetTimeout(push, isFunction(time) ? time(getStateAtCtx(ctx)) : time);\n\t\t},\n\t\tshowBackground({ ctx, push }, [background]) {\n\t\t\tif (isString(background) || isAsset(background)) {\n\t\t\t\tctx.background({\n\t\t\t\t\t'all': handleImageAsset(background)\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tctx.background(Object.fromEntries(Object.entries(background).map(([media, asset]) => [media, handleImageAsset(asset as string)])))\n\t\t\t}\n\n\t\t\tpush();\n\t\t},\n\t\tplayMusic({ ctx, push }, [source]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'music').play(true)\n\t\t\tpush();\n\t\t},\n\t\tpauseMusic({ ctx, push }, [source]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'music').pause()\n\t\t\tpush();\n\t\t},\n\t\tstopMusic({ ctx, push }, [source]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'music').stop()\n\t\t\tpush();\n\t\t},\n\t\tplaySound({ ctx, push }, [source, loop]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'sound').play(loop || false)\n\t\t\tpush();\n\t\t},\n\t\tpauseSound({ ctx, push }, [source]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'sound').pause()\n\t\t\tpush();\n\t\t},\n\t\tstopSound({ ctx, push }, [source]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'sound').stop()\n\t\t\tpush();\n\t\t},\n\t\tvoice({ ctx, push }, [source]) {\n\t\t\tconst [lang] = storageData.get().meta;\n\n\t\t\tconst audioSource = isString(source) ? source : isAsset(source) ? source : source[lang];\n\n\t\t\t/**\n\t\t\t * We allow ignoring voice because it is okay to not have voiceover for certain languages\n\t\t\t */\n\t\t\tif (!audioSource) {\n\t\t\t\tpush();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tctx.audio.voice(handleAudioAsset(audioSource));\n\t\t\tpush();\n\t\t},\n\t\tstopVoice({ ctx, push }) {\n\t\t\tctx.audio.voiceStop();\n\t\t\tpush();\n\t\t},\n\t\tshowCharacter({ ctx, push }, [character, emotion, className, style]) {\n\t\t\temotion ??= defaultEmotions[character];\n\n\t\t\tif (DEV && !emotion) {\n\t\t\t\tthrow new Error(`Attemp to show character \"${character}\" without emotion provided.`)\n\t\t\t}\n\n\t\t\tif (!emotion) return;\n\n\t\t\tif (DEV && !characters[character].emotions[emotion]) {\n\t\t\t\tthrow new Error(`Attempt to show character \"${character}\" with unknown emotion \"${emotion}\"`)\n\t\t\t}\n\n\t\t\tconst handle = ctx.character(character);\n\n\t\t\thandle.append(className, style, ctx.meta.restoring);\n\t\t\thandle.emotion(emotion, true);\n\n\t\t\tpush();\n\t\t},\n\t\thideCharacter({ ctx, push }, [character, className, style, duration]) {\n\t\t\tctx.character(character).remove(className, style, duration, ctx.meta.restoring).then(push)\n\t\t},\n\t\tdialog({ ctx, data, forward }, [character, content, emotion]) {\n\t\t\t/**\n\t\t\t * Person name\n\t\t\t */\n\t\t\tconst name = (() => {\n\t\t\t\tconst c = character;\n\t\t\t\tconst cs = characters;\n\t\t\t\tconst [lang] = storageData.get().meta;\n\n\t\t\t\tif (c && c in cs) {\n\t\t\t\t\tconst block = cs[c].name;\n\n\t\t\t\t\tif (typeof block === 'string') {\n\t\t\t\t\t\treturn block;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (lang in block) {\n\t\t\t\t\t\treturn block[lang as $Language];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn c || '';\n\t\t\t})();\n\n\t\t\tctx.clearBlockingActions('dialog');\n\n\t\t\tctx.dialog(\n\t\t\t\ttemplateReplace(content, data),\n\t\t\t\ttemplateReplace(name, data),\n\t\t\t\tcharacter,\n\t\t\t\temotion,\n\t\t\t\tforward\n\t\t\t);\n\t\t},\n\t\tsay({ ctx, data }, [character, content]) {\n\t\t\tif (DEV && !characters[character]) {\n\t\t\t\tthrow new Error(`Attempt to call Say action with unknown character \"${character}\"`);\n\t\t\t}\n\n\t\t\tmatch('dialog', [character, content], {\n\t\t\t\tctx,\n\t\t\t\tdata\n\t\t\t});\n\t\t},\n\t\tfunction({ ctx, push }, [fn]) {\n\t\t\tconst { restoring, goingBack, preview } = ctx.meta;\n\n\t\t\tconst result = fn({\n\t\t\t\tlang: storageData.get().meta[0],\n\t\t\t\tgoingBack,\n\t\t\t\trestoring,\n\t\t\t\tpreview,\n\t\t\t\tstate: getStateFunction(ctx)\n\t\t\t});\n\n\t\t\tif (!ctx.meta.restoring) {\n\t\t\t\tresult ? result.then(push) : push();\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tchoice({ ctx, data }, [question, ...choices]) {\n\t\t\tconst isWithoutQuestion = Array.isArray(question);\n\n\t\t\tif (isWithoutQuestion) {\n\t\t\t\t/**\n\t\t\t\t * Первый элемент может быть как строкой, так и элементов выбора\n\t\t\t\t */\n\t\t\t\tchoices.unshift(question as unknown as [TextContent<$Language, State>, ValidAction[], () => boolean]);\n\t\t\t\t/**\n\t\t\t\t * Значит, текст не требуется\n\t\t\t\t */\n\t\t\t\tquestion = '';\n\t\t\t}\n\n\t\t\tconst transformedChoices = choices.map(([content, action, visible]) => {\n\t\t\t\tconst shown = !visible || visible({\n\t\t\t\t\tlang: storageData.get().meta[0],\n\t\t\t\t\tstate: getStateAtCtx(ctx)\n\t\t\t\t});\n\n\t\t\t\tif (DEV && action.length === 0 && !shown) {\n\t\t\t\t\tconsole.warn(`Choice children should not be empty, either add content there or make item not selectable`)\n\t\t\t\t}\n\n\t\t\t\treturn [templateReplace(content, data),  shown] as [string, boolean];\n\t\t\t});\n\n\t\t\tif (DEV && transformedChoices.length === 0) {\n\t\t\t\tthrow new Error(`Running choice without variants to choose from, look at how to use Choice action properly [https://novely.pages.dev/guide/actions/choice#usage]`)\n\t\t\t}\n\n\t\t\tctx.clearBlockingActions('choice');\n\n\t\t\tctx.choices(templateReplace(question, data), transformedChoices, (selected) => {\n\t\t\t\tif (!ctx.meta.preview) {\n\t\t\t\t\tenmemory(ctx);\n\t\t\t\t}\n\n\t\t\t\tconst stack = useStack(ctx);\n\n\t\t\t\t/**\n\t\t\t\t * If there is a question, then `index` should be shifted by `1`\n\t\t\t\t */\n\t\t\t\tconst offset = isWithoutQuestion ? 0 : 1;\n\n\t\t\t\tif (DEV && !transformedChoices[selected]) {\n\t\t\t\t\tthrow new Error('Choice children is empty, either add content there or make item not selectable')\n\t\t\t\t}\n\n\t\t\t\t// todo: calculate offset dynamically\n\t\t\t\t// maybe even use object\n\t\t\t\t// action.choice({\n\t\t\t\t//   label: { ru: 'фцв', en: 'awd' },\n\t\t\t\t//   choices: [\n\t\t\t\t//     { label: 'Something', children: [], active: (state) => state.something > 15 }\n\t\t\t  //   ]\n\t\t\t  // })\n\n\t\t\t\tstack.value[0].push(['choice', selected + offset], [null, 0]);\n\t\t\t\trender(ctx);\n\t\t\t\tinteractivity(true);\n\t\t\t});\n\t\t},\n\t\tjump({ ctx, data }, [scene]) {\n\t\t\tif (DEV && !story[scene]) {\n\t\t\t\tthrow new Error(`Attempt to jump to unknown scene \"${scene}\"`)\n\t\t\t}\n\n\t\t\tif (DEV && story[scene].length === 0) {\n\t\t\t\tthrow new Error(`Attempt to jump to empty scene \"${scene}\"`)\n\t\t\t}\n\n\t\t\tconst stack = useStack(ctx);\n\n\t\t\t/**\n\t\t\t * `-1` index is used here because `clear` will run `next` that will increase index to `0`\n\t\t\t */\n\t\t\tstack.value[0] = [\n\t\t\t\t['jump', scene],\n\t\t\t\t[null, -1],\n\t\t\t];\n\n\t\t\tmatch('clear', [], {\n\t\t\t\tctx,\n\t\t\t\tdata,\n\t\t\t});\n\t\t},\n\t\tclear({ ctx, push }, [keep, characters, audio]) {\n\t\t\t/**\n\t\t\t * Remove vibration\n\t\t\t */\n\t\t\tctx.vibrate(0);\n\n\t\t\t/**\n\t\t\t * Call the actual `clear`\n\t\t\t */\n\t\t\tctx.clear(\n\t\t\t\tkeep || EMPTY_SET,\n\t\t\t\tcharacters || EMPTY_SET,\n\t\t\t\taudio || { music: EMPTY_SET, sounds: EMPTY_SET },\n\t\t\t\tpush\n\t\t\t);\n\t\t},\n\t\tcondition({ ctx }, [condition, variants]) {\n\t\t\tif (DEV && Object.values(variants).length === 0) {\n\t\t\t\tthrow new Error(`Attempt to use Condition action with empty variants object`)\n\t\t\t}\n\n\t\t\tif (!ctx.meta.restoring) {\n\t\t\t\tconst val = String(condition(getStateAtCtx(ctx)));\n\n\t\t\t\tif (DEV && !variants[val]) {\n\t\t\t\t\tthrow new Error(`Attempt to go to unknown variant \"${val}\"`)\n\t\t\t\t}\n\n\t\t\t\tif (DEV && variants[val].length === 0) {\n\t\t\t\t\tthrow new Error(`Attempt to go to empty variant \"${val}\"`)\n\t\t\t\t}\n\n\t\t\t\tconst stack = useStack(MAIN_CONTEXT_KEY);\n\n\t\t\t\tstack.value[0].push(['condition', val], [null, 0]);\n\n\t\t\t\trender(ctx);\n\t\t\t}\n\t\t},\n\t\tend({ ctx }) {\n\t\t\tif (ctx.meta.preview) return;\n\n\t\t\texit(true, false);\n\t\t},\n\t\tinput({ ctx, data, forward }, [question, onInput, setup]) {\n\t\t\tctx.clearBlockingActions('input');\n\n\t\t\tctx.input(\n\t\t\t\ttemplateReplace(question, data),\n\t\t\t\tonInput,\n\t\t\t\tsetup || noop,\n\t\t\t\tforward\n\t\t\t);\n\t\t},\n\t\tcustom({ ctx, push }, [fn]) {\n\t\t\tif (fn.requireUserAction) {\n\t\t\t\tctx.clearBlockingActions(undefined)\n\t\t\t}\n\n\t\t\tconst state = getStateFunction(ctx);\n\t\t\tconst lang = storageData.get().meta[0]\n\n\t\t\tconst result = handleCustomAction(ctx, fn, {\n\t\t\t\t...ctx.custom(fn),\n\t\t\t\tstate,\n\t\t\t\tlang,\n\t\t\t})\n\n\t\t\tconst next = () => {\n\t\t\t\tif (fn.requireUserAction && !ctx.meta.preview) {\n\t\t\t\t\tenmemory(ctx);\n\t\t\t\t\tinteractivity(true);\n\t\t\t\t}\n\n\t\t\t\tpush();\n\t\t\t}\n\n\t\t\tif (!ctx.meta.restoring) {\n\t\t\t\tif (isPromise(result)) {\n\t\t\t\t\tresult.then(next)\n\t\t\t\t} else {\n\t\t\t\t\tnext()\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tvibrate({ ctx, push }, pattern) {\n\t\t\tctx.vibrate(pattern);\n\t\t\tpush();\n\t\t},\n\t\tnext({ push }) {\n\t\t\tpush();\n\t\t},\n\t\tanimateCharacter({ ctx, push }, [character, className]) {\n\t\t\tconst classes = className.split(' ');\n\n\t\t\tif (DEV && classes.length === 0) {\n\t\t\t\tthrow new Error('Attempt to use AnimateCharacter without classes. Classes should be provided [https://novely.pages.dev/guide/actions/animateCharacter.html]')\n\t\t\t}\n\n\t\t\tif (ctx.meta.preview) return;\n\n\t\t\tctx.character(character).animate(classes);\n\n\t\t\tpush();\n\t\t},\n\t\ttext({ ctx, data, forward }, text) {\n\t\t\tconst string = text.map((content) => templateReplace(content, data)).join(' ');\n\n\t\t\tif (DEV && string.length === 0) {\n\t\t\t\tthrow new Error(`Action Text was called with empty string or array`)\n\t\t\t}\n\n\t\t\tctx.clearBlockingActions('text');\n\n\t\t\tctx.text(string, forward);\n\t\t},\n\t\texit({ ctx, data }) {\n\t\t\tif (ctx.meta.restoring) return;\n\n\t\t\tconst { exitImpossible } = exitPath({\n\t\t\t\tpath: useStack(ctx).value[0],\n\t\t\t\trefer: refer,\n\t\t\t\tonExitImpossible: () => {\n\t\t\t\t\tmatch('end', [], {\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\tdata,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (exitImpossible) {\n\t\t\t\tctx.clearBlockingActions(undefined);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trender(ctx);\n\t\t},\n\t\tpreload({ ctx, push }, [source]) {\n\t\t\tif (DEV && preloadAssets !== 'lazy') {\n\t\t\t\tconsole.error(`You do not need a preload action becase \"preloadAssets\" strategy was set to \"${preloadAssets}\"`)\n\t\t\t}\n\n\t\t\tif (!ctx.meta.goingBack && !ctx.meta.restoring && !PRELOADED_ASSETS.has(source)) {\n\t\t\t\t/**\n\t\t\t\t * Add to preloaded before it was loaded to prevent save image downloading multiple times\n\t\t\t\t */\n\t\t\t\tPRELOADED_ASSETS.add(renderer.misc.preloadImage(source));\n\t\t\t}\n\n\t\t\tpush();\n\t\t},\n\t\tblock({ ctx }, [scene]) {\n\t\t\tif (DEV && !story[scene]) {\n\t\t\t\tthrow new Error(`Attempt to call Block action with unknown scene \"${scene}\"`)\n\t\t\t}\n\n\t\t\tif (DEV && story[scene].length === 0) {\n\t\t\t\tthrow new Error(`Attempt to call Block action with empty scene \"${scene}\"`)\n\t\t\t}\n\n\t\t\tif (!ctx.meta.restoring) {\n\t\t\t\tconst stack = useStack(ctx);\n\n\t\t\t\tstack.value[0].push(['block', scene], [null, 0]);\n\n\t\t\t\trender(ctx);\n\t\t\t}\n\t\t},\n\t});\n\n\tconst render = (ctx: Context) => {\n\t\tconst stack = useStack(ctx);\n\t\tconst referred = refer(stack.value[0]);\n\n\t\tif (isAction(referred)) {\n\t\t\tconst [action, ...props] = referred;\n\n\t\t\tmatch(action, props, {\n\t\t\t\tctx,\n\t\t\t\tdata: stack.value[1]\n\t\t\t});\n\t\t} else if (Object.values(story).some((branch) => branch === referred)) {\n\t\t\t/**\n\t\t\t * Developer might not write the end action on their own, so we will catch situation when there are no other options than end the game.\n\t\t\t *\n\t\t\t * There are three options right now.\n\t\t\t * - We've got to the action — gonna render it\n\t\t\t * - We've got `undefined`. This means we are tried to go forward, but story array ended already, so we are gonna run exit\n\t\t\t * - We've got branch of story object. This means we exitied from where it's possible to exit and now we can only end the game\n\t\t\t */\n\t\t\tmatch('end', [], {\n\t\t\t\tctx,\n\t\t\t\tdata: stack.value[1]\n\t\t\t})\n\t\t} else {\n\t\t\tmatch('exit', [], {\n\t\t\t\tctx,\n\t\t\t\tdata: stack.value[1]\n\t\t\t});\n\t\t}\n\t};\n\n\tconst interactivity = (value = false) => {\n\t\tinteracted = value ? interacted + 1 : 0;\n\t};\n\n\t/**\n\t * Basically replaces content inside of {{braces}}.\n\t */\n\tconst templateReplace = (content: TextContent<$Language, Data>, values?: Data) => {\n\t\tconst { data, meta: [lang] } = storageData.get();\n\n\t\t// Object to take values from\n\t\tconst obj = values || data;\n\n\t\t// String\n\t\tconst str = flattenAllowedContent(\n\t\t\t!isFunction(content) && !isString(content) ? content[lang] : content,\n\t\t\tobj\n\t\t);\n\n\t\tconst t = translation[lang];\n\t\tconst pluralRules = (t.plural || t.actions) && new Intl.PluralRules(t.tag || lang);\n\n\t\treturn replaceTranslation(\n\t\t\tstr,\n\t\t\tobj,\n\t\t\tt.plural,\n\t\t\tt.actions,\n\t\t\tpluralRules\n\t\t);\n\t};\n\n\tconst data = ((value) => {\n\t\tconst _data = storageData.get().data;\n\n\t\tif (!value) return _data;\n\n\t\tconst val = isFunction(value) ? value(_data) : deepmerge(_data, value as $Data);\n\n\t\tstorageData.update((prev) => {\n\t\t\tprev.data = val;\n\n\t\t\treturn prev;\n\t\t})\n\n\t\treturn undefined;\n\t}) as StateFunction<$Data>;\n\n\tconst typeEssentials: TypeEssentials<$Language, $State, $Data, $Characters> = {\n\t\tl: null,\n\t\ts: null,\n\t\td: null,\n\t\tc: null\n\t}\n\n\tconst getCurrentStorageData = () => {\n\t\treturn coreData.get().dataLoaded ? klona(storageData.get()) : null;\n\t}\n\n\tconst setStorageData = (data: StorageData<$Language, $Data>) => {\n\t\tif (destroyed) {\n\t\t\tif (DEV) {\n\t\t\t\tthrow new Error(`function \\`setStorageData\\` was called after novely instance was destroyed. Data is not updater nor synced after destroy.`)\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tstorageData.set(data);\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Function to set game script\n\t\t *\n\t\t * @example\n\t\t * ```ts\n\t\t * engine.script({\n\t\t *   start: [\n\t\t *     action.function(() => {})\n\t\t *   ]\n\t\t * })\n\t\t * ```\n\t\t */\n\t\tscript,\n\t\t/**\n\t\t * Get actions\n\t\t *\n\t\t * @example\n\t\t * ```ts\n\t\t * engine.script({\n\t\t *   start: [\n\t\t *     action.function(() => {})\n\t\t *   ]\n\t\t * })\n\t\t * ```\n\t\t */\n\t\taction,\n\t\t/**\n\t\t * @deprecated Will be removed BUT replaced with state passed into actions as a parameter\n\t\t */\n\t\tstate: getStateFunction(MAIN_CONTEXT_KEY),\n\t\t/**\n\t\t * Store data between games\n\t\t *\n\t\t * @example\n\t\t * ```ts\n\t\t * engine.script({\n\t\t *   start: [\n\t\t *     action.function(() => {\n\t\t *       // Paid content should be purchased only once\n\t\t *       // So it will be available in any save\n\t\t *       data({ paid_content_purchased: true })\n\t\t *     })\n\t\t *   ]\n\t\t * })\n\t\t * ```\n\t\t */\n\t\tdata,\n\t\t/**\n\t\t * Used in combination with type utilities\n\t\t *\n\t\t * @example\n\t\t * ```ts\n\t\t * import type { ConditionParams, StateFunction } from '@novely/core';\n     *\n\t\t * const conditionCheck = (state: StateFunction<ConditionParams<typeof engine.typeEssintials>>) => {\n\t\t *   return state.age >= 18;\n\t\t * }\n\t\t * ```\n\t\t */\n\t\ttypeEssentials,\n\t\t/**\n\t\t * Replaces content inside {{braces}} with using global data\n\t\t * @example\n\t\t * ```ts\n\t\t * data({ name: 'Alexei' })\n\t\t *\n\t\t * templateReplace('{{name}} is our hero')\n\t\t * templateReplace({\n\t\t *  en: (data) => 'Hello, ' + data.name\n\t\t * })\n\t\t * ```\n\t\t */\n\t\ttemplateReplace(content: TextContent<$Language, $Data>) {\n\t\t\treturn templateReplace(content as TextContent<$Language, Data>)\n\t\t},\n\t\t/**\n\t\t * Cancel data loading, hide UI, ignore page change events\n\t\t * Data updates still will work in case Novely already was loaded\n\t\t */\n\t\tdestroy() {\n\t\t\tdataLoaded.cancel();\n\n\t\t\tUIInstance.unmount();\n\n\t\t\tunsubscribeFromBrowserVisibilityChange();\n\n\t\t\tdestroyed = true;\n\t\t},\n\t\t/**\n\t\t * Funtion to get current storage data\n\t\t *\n\t\t * @example\n\t\t * ```ts\n\t\t * const currentStorageData = engine.getCurrentStorageData();\n\t\t * ```\n\t\t */\n\t\tgetCurrentStorageData,\n\t\t/**\n\t\t * Function to set storage data. Using this function is not recommended.\n\t\t *\n\t\t * @deprecated\n\t\t * @example\n\t\t * ```ts\n\t\t * const currentStorageData = engine.getCurrentStorageData();\n\t\t *\n\t\t * if (currentStorageData) {\n\t\t *   // update music volume\n\t\t *   currentStorageData.meta[2] = 1;\n\t\t *\n\t\t *   setStorageData(currentStorageData)\n\t\t * }\n\t\t * ```\n\t\t */\n\t\tsetStorageData\n\t};\n};\n\nexport { novely };\n","type Stored<T> = {\n\tsubscribe: (cb: (value: T) => void) => () => void;\n\tupdate: (fn: (prev: T) => T) => void;\n\tset: (val: T) => void;\n\tget: () => T;\n};\n\nconst store = <T>(current: T, subscribers = new Set<(value: T) => void>()): Stored<T> => {\n\tconst subscribe = (cb: (value: T) => void) => {\n\t\tsubscribers.add(cb), cb(current);\n\n\t\treturn () => {\n\t\t\tsubscribers.delete(cb);\n\t\t};\n\t};\n\n\tconst push = (value: T) => {\n\t\tfor (const cb of subscribers) cb(value);\n\t};\n\n\tconst update = (fn: (prev: T) => T) => {\n\t\tpush((current = fn(current)));\n\t};\n\n\tconst set = (val: T) => {\n\t\tupdate(() => val);\n\t}\n\n\tconst get = () => {\n\t\treturn current;\n\t};\n\n\treturn { subscribe, update, set, get } as const;\n};\n\nexport { store };\nexport type { Stored };\n","const { isArray } = Array;\nconst { hasOwnProperty, propertyIsEnumerable, getOwnPropertySymbols } = Object;\n\nconst propertyIsOnObject = <T extends Record<PropertyKey, unknown>, K extends PropertyKey>(\n\tobject: T,\n\tproperty: K,\n): object is T & { [Key in K]: unknown } => {\n\ttry {\n\t\treturn property in object;\n\t} catch {\n\t\treturn false;\n\t}\n};\n\nconst propertyIsUnsafe = (target: Record<PropertyKey, unknown>, key: PropertyKey) => {\n\treturn (\n\t\tpropertyIsOnObject(target, key) && // Properties are safe to merge if they don't exist in the target yet,\n\t\t!(\n\t\t\thasOwnProperty.call(target, key) && // unsafe if they exist up the prototype chain,\n\t\t\tpropertyIsEnumerable.call(target, key)\n\t\t)\n\t); // and also unsafe if they're nonenumerable.\n};\n\nconst getEnumerableOwnPropertySymbols = (target: Record<PropertyKey, unknown>) => {\n\tif (!getOwnPropertySymbols) return [];\n\n\treturn getOwnPropertySymbols(target).filter((symbol) => propertyIsEnumerable.call(target, symbol));\n};\n\nconst keys = <T extends Record<PropertyKey, unknown>>(target: T): (keyof T)[] => {\n\treturn [...Object.keys(target), ...getEnumerableOwnPropertySymbols(target)];\n};\n\nconst isMergeableObject = (value: unknown): value is Record<PropertyKey, unknown> => {\n\treturn (\n\t\t!!value &&\n\t\ttypeof value === 'object' &&\n\t\t!['RegExp', 'Date'].includes(Object.prototype.toString.call(value).slice(8, -1))\n\t);\n};\n\nexport { isArray, propertyIsOnObject, propertyIsUnsafe, getEnumerableOwnPropertySymbols, isMergeableObject, keys };\n","import { isArray, propertyIsOnObject, propertyIsUnsafe, isMergeableObject, keys } from './utils';\n\nconst empty = <T extends Record<PropertyKey, unknown> | unknown[]>(value: T): T => {\n\treturn (isArray(value) ? [] : {}) as T;\n};\n\nconst clone = <T>(value: T): T => {\n\treturn isMergeableObject(value) ? deepmerge(empty(value), value) : value;\n};\n\nconst mergeArray = <T>(target: T[], source: T[]) => {\n\tconst destination = target.slice();\n\n\tsource.forEach((item, index) => {\n\t\tif (typeof destination[index] === 'undefined') {\n\t\t\tdestination[index] = clone(item);\n\t\t} else if (isMergeableObject(item)) {\n\t\t\tdestination[index] = deepmerge(target[index] as any, item as any);\n\t\t} else if (target.indexOf(item) === -1) {\n\t\t\tdestination.push(item);\n\t\t}\n\t});\n\n\treturn destination;\n};\n\nconst mergeObject = <T extends Record<PropertyKey, unknown>>(target: T, source: T): T => {\n\tconst destination: Record<PropertyKey, any> = {};\n\n\tfor (const key of keys(target)) {\n\t\tdestination[key] = clone(target[key]);\n\t}\n\n\tfor (const key of keys(source)) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && isMergeableObject(source[key])) {\n\t\t\tdestination[key] = deepmerge(target[key] as any, source[key] as any);\n\t\t} else {\n\t\t\tdestination[key] = clone(source[key]);\n\t\t}\n\t}\n\n\treturn destination as unknown as T;\n};\n\nconst deepmerge = <T extends Record<PropertyKey, unknown> | unknown[]>(target: T, source: T): T => {\n\tif (isArray(target) && isArray(source)) {\n\t\tconst merged = mergeArray(target, source);\n\n\t\treturn merged as unknown as T;\n\t} else if (!isArray(target) && !isArray(source)) {\n\t\tconst merged = mergeObject(target, source);\n\n\t\treturn merged as unknown as T;\n\t} else {\n\t\treturn clone(source);\n\t}\n};\n\nexport { deepmerge };\n","import type { Data, State } from \"./types\";\n\ntype PluralType = Intl.LDMLPluralRule;\ntype Pluralization = Partial<Record<PluralType, string>>;\ntype AllowedContent = string | ((state: State | Data) => string | string[]) | string[] | (string | ((state: State | Data) => string | string[]))[];\ntype TranslationActions = Partial<Record<string, (str: string) => string>>;\n\nconst RGX = /{{(.*?)}}/g;\n\nconst split = (input: string, delimeters: string[]) => {\n\tconst output: (string | undefined)[] = [];\n\n\tfor (const delimeter of delimeters) {\n\t\tif (!input) break;\n\n\t\tconst [start, end] = input.split(delimeter, 2);\n\n\t\toutput.push(start);\n\t\tinput = end;\n\t}\n\n\toutput.push(input);\n\n\treturn output;\n};\n\n/**\n * Turns any allowed content into string\n * @param c Content\n */\nconst flattenAllowedContent = (c: AllowedContent, state: State | Data): string => {\n\tif (Array.isArray(c)) {\n\t\treturn c.map((item) => flattenAllowedContent(item, state)).join('<br>');\n\t}\n\n\tif (typeof c === 'function') {\n\t\treturn flattenAllowedContent(c(state), state);\n\t}\n\n\treturn c;\n};\n\nconst replace = (\n\tinput: string,\n\tdata: Record<string, unknown>,\n\tpluralization?: Record<string, Pluralization>,\n\tactions?: TranslationActions,\n\tpr?: Intl.PluralRules,\n) => {\n\treturn input.replaceAll(RGX, (x: any, key: string, y: any) => {\n\t\tx = 0;\n\t\ty = data;\n\n\t\tconst [pathstr, plural, action] = split(key.trim(), ['@', '%']);\n\n\t\tif (!pathstr) {\n\t\t\treturn '';\n\t\t}\n\n\t\tconst path = pathstr.split('.');\n\n\t\twhile (y && x < path.length) y = y[path[x++]];\n\n\t\tif (plural && pluralization && y && pr) {\n\t\t\ty = pluralization[plural][pr.select(y)];\n\t\t}\n\n\t\tconst actionHandler = (actions && action) ? actions[action] : void 0;\n\n\t\tif (actionHandler) y = actionHandler(y);\n\n\t\treturn y == null ? '' : y;\n\t});\n};\n\nexport { flattenAllowedContent, replace };\nexport type { AllowedContent, PluralType, Pluralization, TranslationActions };\n","import type { CustomHandler, CustomHandlerGetResult, CustomHandlerFunctionGetFn } from './action'\nimport type { Context, CustomActionHandle } from './renderer';\nimport type { Lang, State, StateFunction } from './types';\nimport { CUSTOM_ACTION_MAP } from './shared'\nimport { noop } from './utils';\n\ntype CustomActionHolder = {\n  /**\n   * Node in which custom action is rendered\n   */\n  node: null | HTMLDivElement;\n  /**\n   * Custom Handler function itself\n   */\n  fn: CustomHandler;\n  /**\n   * Local Data\n   */\n  localData: any;\n  /**\n   * Cleanup function. Provided by custom action.\n   */\n  cleanup: () => void;\n}\n\ntype HandleCustomActionOptions = CustomActionHandle & {\n  /**\n   * State Function\n   */\n  state: StateFunction<State>\n  /**\n   * Current Game Language\n   */\n  lang: Lang\n}\n\nconst createCustomActionNode = (id: string) => {\n  const div = document.createElement('div');\n\n  div.setAttribute('data-id', id);\n\n  return div;\n}\n\nconst getCustomActionHolder = (ctx: Context, fn: CustomHandler) => {\n  const cached = CUSTOM_ACTION_MAP.get(ctx.id + fn.key);\n\n  if (cached) {\n    return cached;\n  }\n\n  const holder = {\n    cleanup: noop,\n    node: null,\n    fn: fn,\n    localData: {}\n  } satisfies CustomActionHolder;\n\n  CUSTOM_ACTION_MAP.set(ctx.id + fn.key, holder);\n\n  return holder;\n}\n\nconst handleCustomAction = (ctx: Context, fn: CustomHandler, { lang, state, setMountElement, setClear, remove: renderersRemove }: HandleCustomActionOptions) => {\n  const holder = getCustomActionHolder(ctx, fn);\n\n  const flags = {\n    ...ctx.meta\n  };\n\n  const getDomNodes = (insert = true): CustomHandlerGetResult<boolean> => {\n    if (holder.node || !insert) {\n      return {\n        element: holder.node,\n        root: ctx.root\n      }\n    }\n\n    holder.node = insert ? createCustomActionNode(fn.key) : null;\n\n    setMountElement(holder.node);\n\n    return {\n      element: holder.node,\n      root: ctx.root\n    }\n  };\n\n  const clear = (func: typeof noop) => {\n    /**\n     * We wrap original cleanup to achieve these goals:\n     *\n     * - when cleaned up function will not be called again\n     * - when cleaned up renderer will get updated element\n     */\n    setClear(holder.cleanup = () => {\n      func();\n\n      holder.node = null;\n      holder.cleanup = noop;\n\n      setMountElement(null);\n      setClear(noop);\n    });\n  }\n\n  const data = (updatedData?: any) => {\n    if (updatedData) {\n      return holder.localData = updatedData;\n    }\n\n    return holder.localData;\n  }\n\n  const remove = () => {\n    holder.cleanup();\n    renderersRemove();\n  }\n\n  return fn({\n    flags,\n\n    lang,\n\n    state,\n    data,\n\n    clear,\n    remove,\n\n    rendererContext: ctx,\n\n    getDomNodes: getDomNodes as CustomHandlerFunctionGetFn\n  });\n}\n\nexport { getCustomActionHolder, handleCustomAction }\nexport type { CustomActionHolder, HandleCustomActionOptions }\n","import type { StorageData } from './types';\n\ninterface LocalStorageStorageSettings {\n\tkey: string;\n}\n\ninterface Storage {\n\tget: () => Promise<StorageData>;\n\tset: (data: StorageData) => Promise<void>;\n}\n\nconst localStorageStorage = (options: LocalStorageStorageSettings): Storage => {\n\treturn {\n\t\tasync get() {\n\t\t\tconst fallback = { saves: [], data: {}, meta: [] };\n\n\t\t\ttry {\n\t\t\t\tconst value = localStorage.getItem(options.key);\n\n\t\t\t\treturn value ? JSON.parse(value) : fallback;\n\t\t\t} catch {\n\t\t\t\treturn fallback;\n\t\t\t}\n\t\t},\n\t\tasync set(data) {\n\t\t\ttry {\n\t\t\t\tlocalStorage.setItem(options.key, JSON.stringify(data));\n\t\t\t} catch {}\n\t\t},\n\t};\n};\n\nexport type { Storage };\nexport { localStorageStorage };\n","import { noop } from \"./utils\";\n\ntype SetupBrowserVisibilityChangeListenersOptions = {\n  onChange: () => void;\n}\n\n/**\n * Browser-only function.\n *\n * Tries to save data when page is switched OR is going to be unloaded\n */\nconst setupBrowserVisibilityChangeListeners = ({ onChange }: SetupBrowserVisibilityChangeListenersOptions) => {\n  if (typeof document === 'undefined') return noop;\n\n\tconst onVisibilityChange = () => {\n\t\tif (document.visibilityState === 'hidden') {\n\t\t\tonChange();\n\t\t}\n\t}\n\n\taddEventListener('visibilitychange', onVisibilityChange);\n\taddEventListener('beforeunload', onChange);\n\n  return () => {\n    removeEventListener('visibilitychange', onVisibilityChange);\n    removeEventListener('beforeunload', onChange);\n  }\n}\n\nexport { setupBrowserVisibilityChangeListeners }\nexport type { SetupBrowserVisibilityChangeListenersOptions }\n","import type { CustomHandler, DefaultActionProxy } from './action';\nimport type { Character } from './character';\nimport { STACK_MAP, PRELOADED_ASSETS, ASSETS_TO_PRELOAD } from './shared';\nimport { getResourseType, mapSet, isImageAsset, isString, isAudioAction, handleImageAsset, toArray, handleAudioAsset } from './utils'\n\n/**\n * Adds asset to `ASSETS_TO_PRELOAD` firstly checking if is was already preloaded\n */\nconst enqueueAssetForPreloading = (asset: string) => {\n  if (!PRELOADED_ASSETS.has(asset)) {\n    ASSETS_TO_PRELOAD.add(asset)\n  }\n}\n\ntype HandleAssetsPreloadingOptions = {\n  request: typeof fetch;\n\n  limiter: (fn: () => void | PromiseLike<void>) => Promise<void>;\n\n  preloadAudioBlocking: (source: string) => Promise<void>;\n  preloadImageBlocking: (source: string) => Promise<void>;\n}\n\n/**\n * Preloads assets\n */\nconst handleAssetsPreloading = async ({ request, limiter, preloadAudioBlocking, preloadImageBlocking }: HandleAssetsPreloadingOptions) => {\n  const list = mapSet(ASSETS_TO_PRELOAD, (asset) => {\n    return limiter(async () => {\n      const type = await getResourseType(request, asset);\n\n      switch (type) {\n        case 'audio': {\n          await preloadAudioBlocking(asset);\n          break;\n        }\n\n        case 'image': {\n          await preloadImageBlocking(asset);\n          break;\n        }\n      }\n\n      ASSETS_TO_PRELOAD.delete(asset);\n      PRELOADED_ASSETS.add(asset);\n    })\n  });\n\n  /**\n   * `allSettled` is used because even if error happens game should run\n   *\n   * Ideally, there could be a notification for player, maybe developer could be also notified\n   * But I don't think it's really needed\n   */\n  await Promise.allSettled(list);\n\n  ASSETS_TO_PRELOAD.clear();\n}\n\ntype HuntAssetsOptions = {\n  /**\n   * Characters object from user config\n   */\n  characters: Record<string, Character>;\n  /**\n   * Action name\n   */\n  action: keyof DefaultActionProxy;\n  /**\n   * Action props\n   */\n  props: Parameters<DefaultActionProxy[keyof DefaultActionProxy]>;\n  /**\n   * Function to handle found asset\n   */\n  handle: (asset: string) => void;\n}\n\nconst huntAssets = ({ characters, action, props, handle }: HuntAssetsOptions) => {\n  if (action === 'showBackground') {\n    /**\n     * There are two types of showBackground currently\n     *\n     * Parameter is a `string`\n     * Parameter is a `Record<'CSS Media', string>`\n     */\n    if (isString(props[0])) {\n      handle(handleAudioAsset(props[0]));\n    }\n\n    // todo: asset\n    if (props[0] && typeof props[0] === 'object') {\n      for (const value of Object.values(props[0])) {\n        if (isImageAsset(value)) {\n          handle(value)\n        }\n      }\n    }\n\n    return;\n  }\n\n  /**\n   * Here \"stop\" action also matches condition, but because `ASSETS_TO_PRELOAD` is a Set, there is no problem\n   */\n  if (isAudioAction(action) && isString(props[0])) {\n    handle(handleAudioAsset(props[0]))\n    return;\n  }\n\n  /**\n   * Load characters\n   */\n  if (action === 'showCharacter' && isString(props[0]) && isString(props[1])) {\n    const images = toArray(characters[props[0]].emotions[props[1]]);\n\n    for (const asset of images) {\n      handle(handleImageAsset(asset));\n    }\n\n    return;\n  }\n\n  /**\n   * Custom action assets\n   */\n  if (action === 'custom' && (props[0] as CustomHandler).assets && (props[0] as CustomHandler).assets!.length > 0) {\n    for (const asset of (props[0] as CustomHandler).assets!) {\n      handle(asset);\n    }\n\n    return;\n  }\n}\n\nexport { enqueueAssetForPreloading, handleAssetsPreloading, huntAssets }\n","import type { ValidAction } from \"./action\";\nimport type { Assign } from \"./types\";\n\n/**\n * Extens core action with custom actions\n * @param base Actions object you will extend, `engine.action`\n * @param extension Actions object you will extend with\n * @example\n * ```ts\n * const action = extendAction(engine.action, {\n *   particles: (options: Parameters<typeof particles>[0]) => {\n *     return ['custom', particles(options)]\n *   }\n * })\n * ```\n */\nconst extendAction = <Part0 extends Record<string, (...args: any[]) => ValidAction> , Part1 extends Record<string, (...args: any[]) => ValidAction>>(base: Part0, extension: Part1): Readonly<Assign<Part0, Part1>> => {\n  return new Proxy({} as Readonly<Assign<Part0, Part1>>, {\n    get(_, key, receiver) {\n      return Reflect.get(key in extension ? extension : base, key, receiver)\n    },\n  })\n}\n\nexport { extendAction }\n","const RU = {\n\tNewGame: 'Новая игра',\n\tHomeScreen: 'Главный экран',\n\tToTheGame: 'К игре',\n\tLanguage: 'Язык',\n\tNoSaves: 'Сохранений нет',\n\tLoadSave: 'Загрузить',\n\tSaves: 'Сохранения',\n\tSettings: 'Настройки',\n\tSumbit: 'Подтвердить',\n\tGoBack: 'Назад',\n\tDoSave: 'Сохранение',\n\tAuto: 'Авто',\n\tStop: 'Стоп',\n\tExit: 'Выход',\n\tAutomatic: 'Автоматическое',\n\tManual: 'Ручное',\n\tRemove: 'Удалить',\n\tLoadASaveFrom: 'Загрузить сохранение от',\n\tDeleteASaveFrom: 'Удалить сохранение от',\n\tTextSpeed: 'Скорость текста',\n\tTextSpeedSlow: 'Медленная',\n\tTextSpeedMedium: 'Средняя',\n\tTextSpeedFast: 'Быстрая',\n\tTextSpeedAuto: 'Автоматическая',\n\tCompleteText: 'Завершить текст',\n\tGoForward: 'Перейти вперёд',\n\tExitDialogWarning: 'Вы уверены, что хотите выйти? Прогресс будет сохранён.',\n\tExitDialogExit: 'Выйти',\n\tExitDialogBack: 'Вернуться в игру',\n\tOpenMenu: 'Открыть меню',\n\tCloseMenu: 'Закрыть меню',\n\tMusicVolume: 'Громкость музыки',\n\tSoundVolume: 'Громкость звуков',\n\tVoiceVolume: 'Громкость речи'\n};\n\ntype BaseTranslationStrings = keyof typeof RU;\n\nconst EN: Record<BaseTranslationStrings, string> = {\n\tNewGame: 'New Game',\n\tHomeScreen: 'Home Screen',\n\tToTheGame: 'To the Game',\n\tLanguage: 'Language',\n\tNoSaves: 'No saves',\n\tLoadSave: 'Load',\n\tSaves: 'Saves',\n\tSettings: 'Settings',\n\tSumbit: 'Submit',\n\tGoBack: 'Go back',\n\tDoSave: 'Save',\n\tAuto: 'Auto',\n\tStop: 'Stop',\n\tExit: 'Exit',\n\tAutomatic: 'Automatic',\n\tManual: 'Manual',\n\tRemove: 'Remove',\n\tLoadASaveFrom: 'Load a save from',\n\tDeleteASaveFrom: 'Delete a save from',\n\tTextSpeed: 'Text Speed',\n\tTextSpeedSlow: 'Slow',\n\tTextSpeedMedium: 'Medium',\n\tTextSpeedFast: 'Fast',\n\tTextSpeedAuto: 'Auto',\n\tCompleteText: 'Complete text',\n\tGoForward: 'Go forward',\n\tExitDialogWarning: 'Are you sure you want to exit? Progress will be saved.',\n\tExitDialogExit: 'Exit',\n\tExitDialogBack: 'Return to game',\n\tOpenMenu: 'Open menu',\n\tCloseMenu: 'Close menu',\n\tMusicVolume: 'Music volume',\n\tSoundVolume: 'Sound volume',\n\tVoiceVolume: 'Voice volume'\n};\n\n/**\n * Translated automatically\n */\nconst KK: Record<BaseTranslationStrings, string> = {\n\tNewGame: 'Жаңа ойын',\n\tHomeScreen: 'Негізгі экран',\n\tToTheGame: 'Ойынға',\n\tLanguage: 'Тіл',\n\tNoSaves: 'Сақтау жоқ',\n\tLoadSave: 'Жүктеу',\n\tSaves: 'Сақтау',\n\tSettings: 'Параметрлер',\n\tSumbit: 'Растау',\n\tGoBack: 'Артқа',\n\tDoSave: 'Сақтау',\n\tAuto: 'Авто',\n\tStop: 'Тоқта',\n\tExit: 'Шығу',\n\tAutomatic: 'Автоматты',\n\tManual: 'Қолмен',\n\tRemove: 'Жою',\n\tLoadASaveFrom: 'Сақтауды жүктеу',\n\tDeleteASaveFrom: 'Сақтауды жою',\n\tTextSpeed: 'Мәтін Жылдамдығы',\n\tTextSpeedSlow: 'Баяу',\n\tTextSpeedMedium: 'Орташа',\n\tTextSpeedFast: 'Жылдам',\n\tTextSpeedAuto: 'Автоматты',\n\tCompleteText: 'Мәтінді аяқтау',\n\tGoForward: 'Алға жылжу',\n\tExitDialogWarning: 'Сіз шыққыңыз келетініне сенімдісіз бе? Прогресс сақталады',\n\tExitDialogExit: 'Шығу',\n\tExitDialogBack: 'Ойынға оралу',\n\tOpenMenu: 'Мәзірді ашыңыз',\n\tCloseMenu: 'Мәзірді жабу',\n\tMusicVolume: 'Музыканың көлемі',\n\tSoundVolume: 'Дыбыстардың көлемі',\n\tVoiceVolume: 'Сөйлеу көлемі'\n};\n\n/**\n * Translated automatically\n */\nconst JP: Record<BaseTranslationStrings, string> = {\n\tNewGame: '「新しいゲーム」',\n\tHomeScreen: 'ホーム画面',\n\tToTheGame: '「ゲームに戻る」',\n\tLanguage: '言語',\n\tNoSaves: 'ノーセーブ',\n\tLoadSave: 'ダウンロード',\n\tSaves: '保存',\n\tSettings: '設定',\n\tSumbit: '確認',\n\tGoBack: '「戻る」',\n\tDoSave: '保存',\n\tAuto: 'オート',\n\tStop: '止まれ',\n\tExit: '出口',\n\tAutomatic: '自動',\n\tManual: 'マニュアル',\n\tRemove: '削除',\n\tLoadASaveFrom: 'ロードセーブから',\n\tDeleteASaveFrom: 'から保存を削除',\n\tTextSpeed: 'テキストスピード',\n\tTextSpeedSlow: '「遅い」',\n\tTextSpeedMedium: 'ミディアム',\n\tTextSpeedFast: '「速い」',\n\tTextSpeedAuto: '自動',\n\tCompleteText: 'テキストを完成させる',\n\tGoForward: '先に行く',\n\tExitDialogWarning: '本当に終了しますか？進行状況は保存されます',\n\tExitDialogExit: '終了',\n\tExitDialogBack: 'ゲームに戻る',\n\tOpenMenu: 'メニューを開く',\n\tCloseMenu: 'メニューを閉じる',\n\tMusicVolume: '音楽のボリューム',\n\tSoundVolume: '音量',\n\tVoiceVolume: 'スピーチの量'\n};\n\nexport { RU, EN, KK, JP };\nexport type { BaseTranslationStrings };\n"],"mappings":"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","names":["DEV","memoize","str","supportsMap","supportsMap","str","audio","next","item","asset","DEV","memoize","str","DEV","asset","getLanguage","action","DEV","data","replace","save","characters","audio","type","props","asset","preview","next","str","t"]}