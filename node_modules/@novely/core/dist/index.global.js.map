{"version":3,"sources":["../src/index.ts","../src/constants.ts","../src/shared.ts","../../../node_modules/.pnpm/esm-env@1.0.0/node_modules/esm-env/prod-ssr.js","../../../node_modules/.pnpm/klona@2.0.6/node_modules/klona/json/index.mjs","../../../node_modules/.pnpm/micro-memoize@4.1.2/node_modules/micro-memoize/src/utils.ts","../../../node_modules/.pnpm/micro-memoize@4.1.2/node_modules/micro-memoize/src/Cache.ts","../../../node_modules/.pnpm/micro-memoize@4.1.2/node_modules/micro-memoize/src/index.ts","../src/audio-codecs.ts","../src/image-formats.ts","../src/asset.ts","../src/utils.ts","../../../node_modules/.pnpm/dequal@2.0.3/node_modules/dequal/lite/index.mjs","../src/store.ts","../../deepmerge/src/utils.ts","../../deepmerge/src/index.ts","../src/translation.ts","../src/custom-action.ts","../src/storage.ts","../src/browser.ts","../../../node_modules/.pnpm/yocto-queue@1.1.1/node_modules/yocto-queue/index.js","../../../node_modules/.pnpm/p-limit@6.1.0/node_modules/p-limit/index.js","../src/preloading.ts","../src/novely.ts","../src/extend-actions.ts","../src/translations.ts"],"sourcesContent":["export type {\n\tValidAction,\n\tStory,\n\tActionProxy,\n\tDefaultActionProxy,\n\tGetActionParameters,\n\tTextContent,\n\tCustomHandler,\n\tCustomHandlerGetResult,\n\tCustomHandlerGetResultDataFunction,\n\tFunctionableValue,\n\tCustomHandlerFunctionGetFn,\n\tCustomHandlerFunctionParameters,\n\tBackgroundImage,\n\tActionInputOnInputMeta,\n\tActionInputSetup,\n\tActionInputSetupCleanup\n} from './action';\nexport type { Emotions, Character } from './character';\nexport type { CharacterHandle, AudioHandle, Renderer, RendererInit, Context, CustomActionHandle, RendererInitPreviewReturn } from './renderer';\nexport type { Storage } from './storage';\nexport type {\n\tThenable,\n\tPath,\n\tStorageData,\n\tStorageMeta,\n\tTypewriterSpeed,\n\tLang,\n\tNovelyScreen,\n\tCoreData,\n\tSave,\n\tNovelyInit,\n\tStackHolder,\n\tStack,\n\tState,\n\tStateFunction,\n\tData,\n\tDeepPartial,\n\tTypeEssentials,\n\tCharacterAssetSizes,\n\tCharactersData\n} from './types';\nexport type { Stored } from './store';\nexport type { BaseTranslationStrings } from './translations';\nexport type { AllowedContent, PluralType, Pluralization, TranslationActions } from './translation';\n\nexport type {\n\tConditionParams,\n\tInputHandler,\n\tFunctionParams,\n\tChoiceParams\n} from './type-utils';\n\nexport { novely } from './novely';\nexport { localStorageStorage } from './storage';\nexport { extendAction } from './extend-actions'\n\nexport { RU, EN, JP, KK } from './translations';\n\nexport { asset } from './asset';\n","import type { TypewriterSpeed } from './types';\n\nconst SKIPPED_DURING_RESTORE = new Set(['dialog', 'say', 'choice', 'input', 'vibrate', 'text'] as const);\n\nconst BLOCK_EXIT_STATEMENTS = new Set(['choice:exit', 'condition:exit', 'block:exit'] as const);\n\nconst BLOCK_STATEMENTS = new Set(['choice', 'condition', 'block'] as const);\n\nconst AUDIO_ACTIONS = new Set([\n  'playMusic',\n  'stopMusic',\n  'playSound',\n  'stopSound',\n  'voice',\n  'stopVoice'\n] as const);\n\nconst EMPTY_SET = new Set<any>();\n\nconst DEFAULT_TYPEWRITER_SPEED: TypewriterSpeed = 'Medium';\n\nconst HOWLER_SUPPORTED_FILE_FORMATS = new Set([\n  \"mp3\",\n  \"mpeg\",\n  \"opus\",\n  \"ogg\",\n  \"oga\",\n  \"wav\",\n  \"aac\",\n  \"caf\",\n  \"m4a\",\n  \"m4b\",\n  \"mp4\",\n  \"weba\",\n  \"webm\",\n  \"dolby\",\n  \"flac\"\n] as const);\n\nconst SUPPORTED_IMAGE_FILE_FORMATS = new Set([\n  \"apng\",\n  \"avif\",\n  \"gif\",\n  \"jpg\",\n  \"jpeg\",\n  \"jfif\",\n  \"pjpeg\",\n  \"pjp\",\n  \"png\",\n  \"svg\",\n  \"webp\",\n  \"bmp\",\n] as const);\n\n/**\n * @internal\n */\nconst MAIN_CONTEXT_KEY = '$MAIN';\n\nexport {\n  SKIPPED_DURING_RESTORE,\n  EMPTY_SET,\n  DEFAULT_TYPEWRITER_SPEED,\n  BLOCK_EXIT_STATEMENTS,\n  BLOCK_STATEMENTS,\n  MAIN_CONTEXT_KEY,\n  AUDIO_ACTIONS,\n  HOWLER_SUPPORTED_FILE_FORMATS,\n  SUPPORTED_IMAGE_FILE_FORMATS\n};\n","import type { StackHolder } from './types';\nimport type { CustomActionHolder } from './custom-action';\n\n/**\n * @internal\n */\nconst STACK_MAP = new Map<string, StackHolder>();\n\n/**\n * @internal\n */\nconst CUSTOM_ACTION_MAP = new Map<string, CustomActionHolder>()\n\nconst PRELOADED_ASSETS = new Set<string>();\nconst ASSETS_TO_PRELOAD = new Set<string>();\n\nexport { PRELOADED_ASSETS, ASSETS_TO_PRELOAD, STACK_MAP, CUSTOM_ACTION_MAP }\n","export const BROWSER = false;\nexport const DEV = false;\n","export function klona(val) {\n\tvar k, out, tmp;\n\n\tif (Array.isArray(val)) {\n\t\tout = Array(k=val.length);\n\t\twhile (k--) out[k] = (tmp=val[k]) && typeof tmp === 'object' ? klona(tmp) : tmp;\n\t\treturn out;\n\t}\n\n\tif (Object.prototype.toString.call(val) === '[object Object]') {\n\t\tout = {}; // null\n\t\tfor (k in val) {\n\t\t\tif (k === '__proto__') {\n\t\t\t\tObject.defineProperty(out, k, {\n\t\t\t\t\tvalue: klona(val[k]),\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\twritable: true,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tout[k] = (tmp=val[k]) && typeof tmp === 'object' ? klona(tmp) : tmp;\n\t\t\t}\n\t\t}\n\t\treturn out;\n\t}\n\n\treturn val;\n}\n",null,null,null,"/**\n * This code is adapted from the Howler.js source code.\n * Howler.js: https://github.com/goldfire/howler.js\n */\n\n/**\n * I guess some browsers will return \"no\". So it's better to be safe\n */\nconst cut = (str: CanPlayTypeResult | \"no\") => str.replace(/^no$/, '');\n\nconst audio = new Audio();\n\nconst canPlay = (type: string) => !!cut(audio.canPlayType(type));\nconst canPlayMultiple = (...types: string[]) => types.some(type => canPlay(type));\n\nconst supportsMap = {\n  mp3: canPlayMultiple('audio/mpeg;', 'audio/mp3;'),\n  mpeg: canPlay('audio/mpeg;'),\n  opus: canPlay('audio/ogg; codecs=\"opus\"'),\n  ogg: canPlay('audio/ogg; codecs=\"vorbis\"'),\n  oga: canPlay('audio/ogg; codecs=\"vorbis\"'),\n  wav: canPlayMultiple('audio/wav; codecs=\"1\"', 'audio/wav;'),\n  aac: canPlay('audio/aac;'),\n  caf: canPlay('audio/x-caf;'),\n  m4a: canPlayMultiple('audio/x-m4a;', 'audio/m4a;', 'audio/aac;'),\n  m4b: canPlayMultiple('audio/x-m4b;', 'audio/m4b;', 'audio/aac;'),\n  mp4: canPlayMultiple('audio/x-mp4;', 'audio/mp4;', 'audio/aac;'),\n  weba: canPlay('audio/webm; codecs=\"vorbis\"'),\n  webm: canPlay('audio/webm; codecs=\"vorbis\"'),\n  dolby: canPlay('audio/mp4; codecs=\"ec-3\"'),\n  flac: canPlayMultiple('audio/x-flac;', 'audio/flac;')\n};\n\nexport { supportsMap }\n","const avif = \"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=\";\nconst jxl  = \"data:image/jxl;base64,/woIAAAMABKIAgC4AF3lEgAAFSqjjBu8nOv58kOHxbSN6wxttW1hSaLIODZJJ3BIEkkaoCUzGM6qJAE=\";\nconst webp = \"data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA\";\n\nconst supportsFormat = (source: string) => {\n  const { promise, resolve } = Promise.withResolvers<boolean>();\n\n  const img = Object.assign(document.createElement('img'), {\n    src: source\n  })\n\n  img.onload = img.onerror = () => {\n    resolve(img.height === 2);\n  }\n\n  return promise;\n}\n\nconst supportsMap = {\n  avif: false,\n  jxl: false,\n  webp: false\n}\n\nconst formatsMap = {\n  avif,\n  jxl,\n  webp\n} as const;\n\nconst loadImageFormatsSupport = async () => {\n  const promises = [];\n\n  for (const [format, source] of Object.entries(formatsMap)) {\n    const promise = supportsFormat(source).then(supported => {\n      supportsMap[format as keyof typeof supportsMap] = supported;\n    });\n\n    promises.push(promise);\n  }\n\n  await Promise.all(promises);\n};\n\nloadImageFormatsSupport();\n\nexport { supportsMap }\n","import type { NovelyAsset } from './types';\nimport { DEV } from 'esm-env';\nimport { getUrlFileExtension } from './utils';\nimport { supportsMap as audioSupport } from './audio-codecs';\nimport { supportsMap as imageSupport } from './image-formats';\nimport { HOWLER_SUPPORTED_FILE_FORMATS, SUPPORTED_IMAGE_FILE_FORMATS } from './constants';\nimport { default as memoize } from 'micro-memoize';\n\n/**\n * Function to get assets type. All assets must be of the same type. Only works with supported types.\n */\nconst getType = memoize((extensions: string[]) => {\n  if (extensions.every((extension) => HOWLER_SUPPORTED_FILE_FORMATS.has(extension as any))) {\n    return 'audio';\n  }\n\n  if (extensions.every((extension) => SUPPORTED_IMAGE_FILE_FORMATS.has(extension as any))) {\n    return 'image';\n  }\n\n  throw extensions;\n})\n\nconst SUPPORT_MAPS = {\n  'image': imageSupport,\n  'audio': audioSupport\n} as const;\n\n/**\n * Memoizes and returns an asset selection object based on provided file variants.\n * The selected asset depends on the client's support for various formats.\n *\n * @param {...string} variants - A variable number of strings, each representing a potential asset file URL.\n * @returns {NovelyAsset} An object representing the selected asset with `source` and `type` properties.\n *\n * @throws {Error} If in DEV mode and no arguments are provided.\n * @example\n * ```\n * import { asset } from 'novely';\n *\n * // Passed first have higher priority\n * const classroom = asset(\n *   'classroom.avif',\n *   'classroom.webp',\n *   'classroom.jpeg'\n * );\n *\n * setTimeout(() => {\n *   console.log(classroom.source);\n * }, 100);\n * ```\n */\nconst asset = memoize((...variants: string[]): NovelyAsset => {\n  if (DEV && variants.length === 0) {\n    throw new Error(`Attempt to use \"asset\" function without arguments`)\n  }\n\n  const map: Record<string, string> = {};\n  const extensions: string[] = [];\n\n  for (const v of variants) {\n    const e = getUrlFileExtension(v);\n\n    map[e] = v;\n    extensions.push(e);\n  }\n\n  const type = getType(extensions);\n\n  const getSource = memoize(() => {\n    const support = SUPPORT_MAPS[type];\n\n    for (const extension of extensions) {\n      if (extension in support) {\n        if (support[extension as keyof typeof support]) {\n          return map[extension];\n        }\n\n      } else {\n        return map[extension];\n      }\n    }\n\n    if (DEV) {\n      throw new Error(`No matching asset was found for ${variants.map(v => `\"${v}\"`).join(', ')}`)\n    }\n\n    return '';\n  });\n\n  return {\n    get source() {\n      return getSource();\n    },\n    get type() {\n      return type;\n    },\n  }\n})\n\nconst isAsset = (suspect: unknown): suspect is NovelyAsset => {\n  return suspect !== null && typeof suspect === 'object' && 'source' in suspect && 'type' in suspect;\n}\n\nexport { isAsset, asset }\n","import type { DefaultActionProxy, CustomHandler, Story, ValidAction, GetActionParameters } from './action';\nimport type { Character } from './character';\nimport type { Thenable, Path, PathItem, Save, UseStackFunctionReturnType, StackHolder, Lang, NovelyAsset, CharactersData } from './types';\nimport type { Context, Renderer } from './renderer';\nimport { BLOCK_STATEMENTS, BLOCK_EXIT_STATEMENTS, SKIPPED_DURING_RESTORE, AUDIO_ACTIONS, HOWLER_SUPPORTED_FILE_FORMATS, SUPPORTED_IMAGE_FILE_FORMATS } from './constants';\nimport { STACK_MAP } from './shared';\nimport { DEV } from 'esm-env';\nimport { klona } from 'klona/json';\nimport { default as memoize } from 'micro-memoize';\nimport { isAsset } from './asset';\n\ntype MatchActionParams = {\n\tdata: Record<string, unknown>\n\tctx: Context;\n\n\tpush: () => void;\n\tforward: () => void;\n}\n\ntype MatchActionMap = {\n\t[Key in keyof DefaultActionProxy]: (params: MatchActionParams, data: Parameters<DefaultActionProxy[Key]>) => void;\n};\n\ntype MatchActionMapComplete = Omit<MatchActionMap, 'custom'> & {\n\tcustom: (params: MatchActionParams, value: [handler: CustomHandler]) => Thenable<void>;\n};\n\ntype MatchActionParameters = {\n\t/**\n\t * Name of context or context\n\t */\n\tctx: string | Context;\n\t/**\n\t * Data from the save\n\t */\n\tdata: Record<string, unknown>;\n}\n\ntype MatchActionOptions = {\n\tpush: (ctx: Context) => void;\n\tforward: (ctx: Context) => void;\n\n\tgetContext: (name: string) => Context;\n\n\tonBeforeActionCall: (payload: { action: keyof MatchActionMapComplete, props: Parameters<DefaultActionProxy[keyof MatchActionMapComplete]>; ctx: Context }) => void;\n}\n\nconst matchAction = <M extends MatchActionMapComplete>({ getContext, onBeforeActionCall, push, forward }: MatchActionOptions, values: M) => {\n\treturn (action: keyof MatchActionMapComplete, props: any, { ctx, data }: MatchActionParameters) => {\n\t\tconst context = typeof ctx === 'string' ? getContext(ctx) : ctx;\n\n\t\t/**\n\t\t * We ignore `say` action because it calls `dialog` action\n\t\t */\n\t\tif (action !== 'say') {\n\t\t\tonBeforeActionCall({\n\t\t\t\taction,\n\t\t\t\tprops,\n\t\t\t\tctx: context\n\t\t\t})\n\t\t}\n\n\t\treturn values[action]({\n\t\t\tctx: context,\n\t\t\tdata,\n\n\t\t\tpush() {\n\t\t\t\tif (context.meta.preview) return;\n\n\t\t\t\tpush(context)\n\t\t\t},\n\t\t\tforward() {\n\t\t\t\tif (context.meta.preview) return;\n\n\t\t\t\tforward(context)\n\t\t\t}\n\t\t}, props);\n\t};\n};\n\nconst isNumber = (val: unknown): val is number => {\n\treturn typeof val === 'number';\n};\n\nconst isNull = (val: unknown): val is null => {\n\treturn val === null;\n};\n\nconst isString = (val: unknown): val is string => {\n\treturn typeof val === 'string';\n};\n\nconst isFunction = (val: unknown): val is (...parameters: any[]) => any => {\n\treturn typeof val === 'function';\n};\n\nconst isPromise = (val: unknown): val is Promise<any> => {\n\treturn Boolean(val) && (typeof val === 'object' || isFunction(val)) && isFunction((val as any).then);\n};\n\nconst isEmpty = (val: unknown): val is Record<PropertyKey, never> => {\n\treturn typeof val === 'object' && !isNull(val) && Object.keys(val).length === 0;\n};\n\nconst isCSSImage = (str: string) => {\n\tconst startsWith = String.prototype.startsWith.bind(str);\n\n\treturn startsWith('http') || startsWith('/') || startsWith('.') || startsWith('data');\n};\n\nconst str = String;\n\nconst isUserRequiredAction = ([action, ...meta]: ValidAction) => {\n\treturn Boolean(action === 'custom' && meta[0] && (meta[0] as unknown as CustomHandler).requireUserAction);\n};\n\nconst getLanguage = (languages: string[]) => {\n\tlet { language } = navigator;\n\n\tif (languages.includes(language)) {\n\t\treturn language;\n\t} else if (languages.includes((language = language.slice(0, 2)))) {\n\t\treturn language;\n\t} else if ((language = languages.find((value) => navigator.languages.includes(value))!)) {\n\t\treturn language;\n\t}\n\n\t/**\n\t * We'v checked the `en-GB` format, `en` format, and maybe any second languages, but there were no matches\n\t */\n\treturn languages[0];\n};\n\n/**\n * @copyright Techlead LLC\n * @see https://learn.javascript.ru/task/throttle\n */\nconst throttle = <Fn extends (...args: any[]) => any>(fn: Fn, ms: number) => {\n\tlet throttled = false,\n\t\tsavedArgs: any,\n\t\tsavedThis: any;\n\n\tfunction wrapper(this: any, ...args: any[]) {\n\t\tif (throttled) {\n\t\t\tsavedArgs = args;\n\t\t\t/* eslint-disable @typescript-eslint/no-this-alias */\n\t\t\tsavedThis = this;\n\t\t\treturn;\n\t\t}\n\n\t\tfn.apply(this, args as unknown as any[]);\n\n\t\tthrottled = true;\n\n\t\tsetTimeout(() => {\n\t\t\tthrottled = false;\n\n\t\t\tif (savedArgs) {\n\t\t\t\twrapper.apply(savedThis, savedArgs);\n\t\t\t\tsavedArgs = savedThis = null;\n\t\t\t}\n\t\t}, ms);\n\t}\n\n\treturn wrapper as unknown as (...args: Parameters<Fn>) => void;\n};\n\nconst findLastIndex = <T>(array: T[], fn: (this: T[], item: T, index: number, array: T[]) => boolean) => {\n\tfor (let i = array.length - 1; i >= 0; i--) {\n\t\tif (fn.call(array, array[i], i, array)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\n\treturn -1;\n};\n\n/**\n * Using this because `Array.prototype.findLast` has not enough support\n * @see https://caniuse.com/?search=findLast\n */\nconst findLast = <T>(array: T[], fn: (this: T[], item: T, index: number, array: T[]) => boolean) => {\n\treturn array[findLastIndex(array, fn)];\n}\n\ntype ControlledPromise<T> = Promise<\n\t| {\n\t\t\tvalue: T;\n\t\t\tcancelled: false;\n\t  }\n\t| {\n\t\t\tvalue: null;\n\t\t\tcancelled: true;\n\t  }\n>;\n\ntype ControlledPromiseObj<T> = {\n\tresolve: (value: T | PromiseLike<T>) => void;\n\treject: (reason?: any) => void;\n\n\tpromise: ControlledPromise<T>;\n\n\tcancel: () => void;\n};\n\nconst createControlledPromise = <T = void>() => {\n\tconst object = {\n\t\tresolve: null,\n\t\treject: null,\n\n\t\tpromise: null,\n\n\t\tcancel: null,\n\t} as unknown as ControlledPromiseObj<T>;\n\n\tconst init = () => {\n\t\tconst promise = new Promise((resolve, reject) => {\n\t\t\tobject.reject = reject;\n\t\t\tobject.resolve = (value) => {\n\t\t\t\tresolve({ cancelled: false, value });\n\t\t\t};\n\n\t\t\tobject.cancel = () => {\n\t\t\t\tresolve({ cancelled: true, value: null });\n\t\t\t\tinit();\n\t\t\t};\n\t\t});\n\n\t\tobject.promise = promise as ControlledPromise<T>;\n\t};\n\n\treturn init(), object;\n};\n\nconst findLastPathItemBeforeItemOfType = (path: Path, name: PathItem[0]) => {\n\tconst index = findLastIndex(path, ([_name, _value], i, array) => {\n\t\tconst next = array[i + 1];\n\n\t\treturn isNull(_name) && isNumber(_value) && next != null && next[0] === name;\n\t});\n\n\treturn path[index] as undefined | [null, number];\n};\n\nconst isBlockStatement = (statement: unknown): statement is 'choice' | 'condition' | 'block' => {\n\treturn BLOCK_STATEMENTS.has(statement as any);\n};\n\nconst isBlockExitStatement = (\n\tstatement: unknown,\n): statement is 'choice:exit' | 'condition:exit' | 'block:exit' => {\n\treturn BLOCK_EXIT_STATEMENTS.has(statement as any);\n};\n\nconst isSkippedDuringRestore = (item: unknown): item is 'vibrate' | 'dialog' | 'input' | 'choice' | 'text' => {\n\treturn SKIPPED_DURING_RESTORE.has(item as any);\n};\n\nconst isAudioAction = (action: unknown): action is   'playMusic' | 'stopMusic' | 'playSound' | 'stopSound' | 'voice' | 'stopVoice' => {\n\treturn AUDIO_ACTIONS.has(action as any);\n}\n\nconst noop = () => {};\n\nconst isAction = (element: unknown,): element is Exclude<ValidAction, ValidAction[]> => {\n\treturn Array.isArray(element) && isString(element[0]);\n};\n\n/**\n * Transforms `(ValidAction | ValidAction[])[]` to `ValidAction[]`\n */\nconst flattenStory = (story: Story) => {\n\tconst entries = Object.entries(story).map(([name, items]) => {\n\t\tconst flat = (item: (ValidAction | ValidAction[])[]): ValidAction[] => {\n\t\t\treturn item.flatMap((data) => {\n\t\t\t\tconst type = data[0];\n\n\t\t\t\t/**\n\t\t\t\t * This is not just an action like `['name', ...arguments]`, but an array of actions\n\t\t\t\t */\n\t\t\t\tif (Array.isArray(type)) return flat(data as ValidAction[]);\n\n\t\t\t\treturn [data as ValidAction];\n\t\t\t});\n\t\t};\n\n\t\treturn [name, flat(items)];\n\t});\n\n\treturn Object.fromEntries(entries);\n};\n\n/**\n * A wrapper on `fn` to make it run only once!\n * @param fn Function that needed to run no more than one time\n */\nconst once = (fn: () => void) => {\n\tlet ran = false;\n\n\treturn () => {\n\t\tif (ran) return;\n\n\t\tran = true;\n\t\tfn();\n\t};\n};\n\nconst isExitImpossible = (path: Path) => {\n\tconst blockStatements = path.filter(([item]) => isBlockStatement(item));\n\tconst blockExitStatements = path.filter(([item]) => isBlockExitStatement(item));\n\n\t/**\n\t * There were no blocks nor exits from blocks\n\t */\n\tif (blockStatements.length === 0 && blockExitStatements.length === 0) {\n\t\treturn true;\n\t}\n\n\t/**\n\t * There is block that can be exited\n\t */\n\tif (blockStatements.length > blockExitStatements.length) {\n\t\treturn false;\n\t}\n\n\treturn !blockExitStatements.every(([name], i) => name && name.startsWith(blockStatements[i][0]!))\n}\n\nconst getOppositeAction = (action: 'showCharacter' | 'playSound' | 'playMusic' | 'voice' | any) => {\n\tconst MAP = {\n\t\t'showCharacter': 'hideCharacter',\n\t\t'playSound': 'stopSound',\n\t\t'playMusic': 'stopMusic',\n\t\t'voice': 'stopVoice'\n\t} as const;\n\n\treturn MAP[action as keyof typeof MAP];\n}\n\n/**\n * @param story A story object\n * @param path A path by that actions will be gathered\n * @param filter true — actions that should be skipped would not be returned\n */\nconst getActionsFromPath = (story: Story, path: Path, filter: boolean) => {\n\t/**\n\t * Current item in the story\n\t */\n\tlet current: any = story;\n\t/**\n\t * Previous `current` value\n\t */\n\tlet precurrent: any;\n\t/**\n\t * Should we ignore some actions\n\t */\n\tlet ignoreNestedBefore: null | PathItem[0] = null;\n\t/**\n\t * Current item of type `[null, int]`\n\t */\n\tlet index = 0;\n\t/**\n\t * Skipped action that should be preserved\n\t */\n\tlet skipPreserve: Exclude<ValidAction, ValidAction[]> | undefined = undefined;\n\t/**\n\t * Actions that are either considered user action or skipped during restore process\n\t */\n\tconst skip = new Set<Exclude<ValidAction, ValidAction[]>>()\n\n\t/**\n\t * Cound of items of type `[null, int]`\n\t */\n\tconst max = path.reduce((acc, [type, val]) => {\n\t\tif (isNull(type) && isNumber(val)) {\n\t\t\treturn acc + 1;\n\t\t}\n\n\t\treturn acc;\n\t}, 0);\n\n\tconst queue = [] as Exclude<ValidAction, ValidAction[]>[];\n\tconst blocks = [];\n\n\tfor (const [type, val] of path) {\n\t\tif (type === 'jump') {\n\t\t\tprecurrent = story;\n\t\t\tcurrent = current[val];\n\t\t} else if (type === null) {\n\t\t\tprecurrent = current;\n\n\t\t\tif (isNumber(val)) {\n\t\t\t\tindex++;\n\n\t\t\t\tlet startIndex = 0;\n\n\t\t\t\tif (ignoreNestedBefore) {\n\t\t\t\t\tconst prev = findLastPathItemBeforeItemOfType(path.slice(0, index), ignoreNestedBefore)\n\n\t\t\t\t\tif (prev) {\n\t\t\t\t\t\tstartIndex = prev[1];\n\t\t\t\t\t\tignoreNestedBefore = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Запустим все экшены которые идут в `[null, int]` от `0` до `int`\n\t\t\t\t * Почему-то потребовалось изменить `<` на `<=`, чтобы последний action попадал сюда\n\t\t\t\t */\n\t\t\t\tfor (let i = startIndex; i <= val; i++) {\n\t\t\t\t\tconst item = current[i];\n\n\t\t\t\t\t/**\n\t\t\t\t\t * In case of broken save at least not throw\n\t\t\t\t\t * But is should not happen\n\t\t\t\t\t */\n\t\t\t\t\tif (!isAction(item)) continue;\n\n\t\t\t\t\tconst [action] = item;\n\n\t\t\t\t\tconst last = index === max && i === val;\n\t\t\t\t\tconst shouldSkip = isSkippedDuringRestore(action) || isUserRequiredAction(item);\n\n\t\t\t\t\tif (shouldSkip) {\n\t\t\t\t\t\tskip.add(item);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shouldSkip && last) {\n\t\t\t\t\t\tskipPreserve = item;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (filter && shouldSkip && !last) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tqueue.push(item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcurrent = current[val];\n\t\t} else if (type === 'choice') {\n\t\t\tblocks.push(precurrent);\n\t\t\tcurrent = current[val + 1][1];\n\t\t} else if (type === 'condition') {\n\t\t\tblocks.push(precurrent);\n\t\t\tcurrent = current[2][val];\n\t\t} else if (type === 'block') {\n\t\t\tblocks.push(precurrent);\n\t\t\tcurrent = story[val];\n\t\t} else if (type === 'block:exit' || type === 'choice:exit' || type === 'condition:exit') {\n\t\t\tcurrent = blocks.pop();\n\t\t\tignoreNestedBefore = type.slice(0, -5) as PathItem[0]\n\t\t}\n\t}\n\n\treturn {\n\t\tqueue,\n\t\tskip,\n\t\tskipPreserve\n\t};\n}\n\ntype QueueProcessorOptions = {\n\tskip: Set<Exclude<ValidAction, ValidAction[]>>;\n\tskipPreserve?: Exclude<ValidAction, ValidAction[]> | undefined\n}\n\nconst createQueueProcessor = (queue: Exclude<ValidAction, ValidAction[]>[], options: QueueProcessorOptions) => {\n\tconst processedQueue: Exclude<ValidAction, ValidAction[]>[] = [];\n\n\tconst keep = new Set();\n\tconst characters = new Set();\n\tconst audio = {\n\t\tmusic: new Set(),\n\t\tsound: new Set()\n\t};\n\n\t/**\n\t * Get the next actions array.\n\t */\n\tconst next = (i: number) => queue.slice(i + 1);\n\n\tfor (const [i, item] of queue.entries()) {\n\t\tconst [action, ...params] = item;\n\n\t\tif (options.skip.has(item) && item !== options.skipPreserve) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tkeep.add(action);\n\n\t\tif (action === 'function' || action === 'custom') {\n\t\t\tif (action === 'custom') {\n\t\t\t\tconst fn = params[0] as CustomHandler;\n\n\t\t\t\tif ('callOnlyLatest' in fn && fn.callOnlyLatest) {\n\t\t\t\t\t/**\n\t\t\t\t\t * We'll calculate it is `latest` or not\n\t\t\t\t\t */\n\t\t\t\t\tconst notLatest = next(i).some(([, func]) => {\n\t\t\t\t\t\tif (!isFunction(func)) return false;\n\n\t\t\t\t\t\tconst c0 = func as CustomHandler;\n\t\t\t\t\t\tconst c1 = fn;\n\n\t\t\t\t\t\t// Also check for `undefined` so if two id's were undefined it would not be true\n\t\t\t\t\t\tconst isIdenticalID = Boolean(c0.id && c1.id && c0.id === c1.id);\n\t\t\t\t\t\tconst isIdenticalByReference = c0 === c1;\n\n\t\t\t\t\t\treturn isIdenticalID || isIdenticalByReference || str(c0) === str(c1);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (notLatest) continue;\n\t\t\t\t} else if ('skipOnRestore' in fn && fn.skipOnRestore) {\n\t\t\t\t\tif (fn.skipOnRestore(() => next(i))) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tprocessedQueue.push(item);\n\t\t} else if (action === 'showCharacter' || action === 'playSound' || action === 'playMusic' || action === 'voice') {\n\t\t\tconst closing = getOppositeAction(action);\n\n\t\t\tconst skip = next(i).some(([_action, target]) => {\n\t\t\t\tif (target !== params[0] && action !== 'voice') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst musicGonnaBePaused = action === 'playMusic' && _action === 'pauseMusic';\n\t\t\t\tconst soundGonnaBePaused = action === 'playSound' && _action === 'pauseSound';\n\n\t\t\t\t/**\n\t\t\t\t * It either will be closed OR same action will be ran again\n\t\t\t\t */\n\t\t\t\treturn musicGonnaBePaused || soundGonnaBePaused || _action === closing || _action === action;\n\t\t\t});\n\n\t\t\tif (skip) continue;\n\n\t\t\t/**\n\t\t\t * Actually, we do not need check above to add there things to keep because if something was hidden already we could not keep it visible\n\t\t\t */\n\t\t\tif (action === 'showCharacter') {\n\t\t\t\tcharacters.add(params[0])\n\t\t\t} else if (action === 'playMusic') {\n\t\t\t\taudio.music.add(unwrapAsset(params[0] as NovelyAsset))\n\t\t\t} else if (action === 'playSound') {\n\t\t\t\taudio.sound.add(unwrapAsset(params[0] as NovelyAsset))\n\t\t\t}\n\n\t\t\tprocessedQueue.push(item);\n\t\t} else if (action === 'showBackground' || action === 'preload') {\n\t\t\tconst skip = next(i).some(([_action]) => action === _action);\n\n\t\t\tif (skip) continue;\n\n\t\t\tprocessedQueue.push(item);\n\t\t} else if (action === 'animateCharacter') {\n\t\t\tconst skip = next(i).some(([_action, character], j, array) => {\n\t\t\t\t/**\n\t\t\t\t * Same character will be animated again. Ignore.\n\t\t\t\t */\n\t\t\t\tif (action === _action && character === params[0]) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tconst next = array.slice(j);\n\n\t\t\t\tconst characterWillAnimate = next.some(([__action, __character]) => action === __action);\n\t\t\t\tconst hasBlockingActions = next.some((item) => options.skip.has(item))\n\n\t\t\t\t/**\n\t\t\t\t * This is not a best check.\n\t\t\t\t *\n\t\t\t\t * @todo: make two animations for two different characters animate when not separeted by \"blocking actions\"\n\t\t\t\t */\n\t\t\t\treturn characterWillAnimate && hasBlockingActions\n\t\t\t});\n\n\t\t\tif (skip) continue;\n\n\t\t\tprocessedQueue.push(item);\n\t\t} else {\n\t\t\tprocessedQueue.push(item);\n\t\t}\n\t}\n\n\tconst run = async (match: (item: Exclude<ValidAction, ValidAction[]>) => Thenable<void>) => {\n\t\tfor await (const item of processedQueue) {\n\t\t\tconst result = match(item);\n\n\t\t\tif (isPromise(result)) {\n\t\t\t\tawait result;\n\t\t\t}\n\t\t}\n\n\t\tprocessedQueue.length = 0;\n\t}\n\n\treturn {\n\t\trun,\n\t\tkeep: {\n\t\t\tkeep,\n\t\t\tcharacters,\n\t\t\taudio\n\t\t}\n\t}\n}\n\nconst getStack = (ctx: Context) => {\n\tconst { id } = ctx;\n\tconst cached = STACK_MAP.get(id);\n\n\tif (cached) return cached;\n\n\tconst stack = [] as unknown as StackHolder;\n\n\tSTACK_MAP.set(id, stack);\n\n\treturn stack;\n}\n\nconst createUseStackFunction = (renderer: Renderer) => {\n\tconst useStack = (context: Context | string): UseStackFunctionReturnType => {\n\t\tconst ctx = typeof context === 'string' ? renderer.getContext(context) : context;\n\t\tconst stack = getStack(ctx);\n\n\t\treturn {\n\t\t\tget previous() {\n\t\t\t\treturn stack.previous;\n\t\t\t},\n\t\t\tget value() {\n\t\t\t\treturn stack.at(-1)!;\n\t\t\t},\n\t\t\tset value(value) {\n\t\t\t\tstack[stack.length - 1] = value;\n\t\t\t},\n\n\t\t\tback() {\n\t\t\t\tif (stack.length > 1) {\n\t\t\t\t\tstack.previous = stack.pop();\n\t\t\t\t\tctx.meta.goingBack = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\tpush(value: Save) {\n\t\t\t\tstack.push(value);\n\t\t\t},\n\t\t\tclear() {\n\t\t\t\tstack.previous = undefined;\n\n\t\t\t\tstack.length = 0;\n\t\t\t\tstack.length = 1;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn useStack;\n}\n\nconst mapSet = <T, K>(set: Set<T>, fn: (value: T, index: number, array: T[]) => K): K[] => {\n\treturn [...set].map(fn);\n}\n\nconst isImageAsset = (asset: unknown): asset is string => {\n\treturn isString(asset) && isCSSImage(asset)\n}\n\nconst getUrlFileExtension = (address: string) => {\n\ttry {\n\t\tconst { pathname } = new URL(address, location.href);\n\n\t\t/**\n\t\t * By using pathname we remove search params from URL, but some things are still preserved\n\t\t *\n\t\t * Imagine pathname like `image.png!private:1230`\n\t\t * Yes, very unlikely to happen, but it is possible\n\t\t */\n\t\treturn pathname.split('.').at(-1)!.split('!')[0].split(':')[0];\n\t} catch (error) {\n\t\tif (DEV) {\n\t\t\tconsole.error(new Error(`Could not construct URL \"${address}\".`, { cause: error }))\n\t\t}\n\n\t\treturn ''\n\t}\n}\n\nconst fetchContentType = async (request: typeof fetch, url: string) => {\n\ttry {\n\t\tconst response = await request(url, {\n\t\t\tmethod: 'HEAD'\n\t\t});\n\n\t\treturn response.headers.get('Content-Type') || '';\n\t} catch (error) {\n\t\tif (DEV) {\n\t\t\tconsole.error(new Error(`Failed to fetch file at \"${url}\"`, { cause: error }))\n\t\t}\n\n\t\treturn '';\n\t}\n}\n\nconst getResourseType = memoize(\n\tasync (request: typeof fetch, url: string) => {\n\t\t/**\n\t\t * If url is not http we should not check\n\t\t *\n\t\t * startsWith('http') || startsWith('/') || startsWith('.') || startsWith('data')\n\t\t */\n\t\tif (!isCSSImage(url)) {\n\t\t\treturn 'other'\n\t\t}\n\n\t\tconst extension = getUrlFileExtension(url);\n\n\t\tif (HOWLER_SUPPORTED_FILE_FORMATS.has(extension as any)) {\n\t\t\treturn 'audio'\n\t\t}\n\n\t\tif (SUPPORTED_IMAGE_FILE_FORMATS.has(extension as any)) {\n\t\t\treturn 'image'\n\t\t}\n\n\t\t/**\n\t\t * If checks above didn't worked we will fetch content type\n\t\t * This might not work because of CORS\n\t\t */\n\t\tconst contentType = await fetchContentType(request, url);\n\n\t\tif (contentType.includes('audio')) {\n\t\t\treturn 'audio'\n\t\t}\n\n\t\tif (contentType.includes('image')) {\n\t\t\treturn 'image'\n\t\t}\n\n\t\treturn 'other'\n\t},\n\t{\n\t\tisPromise: true\n\t}\n);\n\n/**\n * Capitalizes the string\n * @param str String without emojis or complex graphemes\n */\nconst capitalize = (str: string) => {\n\treturn str[0].toUpperCase() + str.slice(1);\n};\n\nconst getIntlLanguageDisplayName = memoize((lang: Lang) => {\n\t/**\n\t * When using Intl fails we just return language key.\n\t */\n\ttry {\n\t\tconst intl = new Intl.DisplayNames([lang], {\n\t\t\ttype: 'language',\n\t\t});\n\n\t\treturn intl.of(lang) || lang;\n\t} catch {\n\t\treturn lang;\n\t}\n})\n\nconst createReferFunction = (story: Story) => {\n\tconst refer = (path: Path) => {\n\t\tlet current: any = story;\n\t\tlet precurrent: any = story;\n\n\t\tconst blocks: any[] = [];\n\n\t\tfor (const [type, val] of path) {\n\t\t\tif (type === 'jump') {\n\t\t\t\tprecurrent = story;\n\t\t\t\tcurrent = current[val];\n\t\t\t} else if (type === null) {\n\t\t\t\tprecurrent = current;\n\t\t\t\tcurrent = current[val];\n\t\t\t} else if (type === 'choice') {\n\t\t\t\tblocks.push(precurrent);\n\t\t\t\tcurrent = current[(val as number) + 1][1];\n\t\t\t} else if (type === 'condition') {\n\t\t\t\tblocks.push(precurrent);\n\t\t\t\tcurrent = current[2][val];\n\t\t\t} else if (type === 'block') {\n\t\t\t\tblocks.push(precurrent);\n\t\t\t\tcurrent = story[val];\n\t\t\t} else if (type === 'block:exit' || type === 'choice:exit' || type === 'condition:exit') {\n\t\t\t\tcurrent = blocks.pop();\n\t\t\t}\n\t\t}\n\n\t\treturn current as Exclude<ValidAction, ValidAction[]>;\n\t};\n\n\treturn refer;\n}\n\ntype ReferFunction = ReturnType<typeof createReferFunction>;\n\ntype ExitPathConfig = {\n\tpath: Path;\n\trefer: ReferFunction;\n\n\tonExitImpossible?: () => void;\n}\n\nconst exitPath = ({ path, refer, onExitImpossible }: ExitPathConfig) => {\n\tconst last = path.at(-1);\n\tconst ignore: ('choice:exit' | 'condition:exit' | 'block:exit')[] = [];\n\n\tlet wasExitImpossible = false;\n\n\t/**\n\t * - should be an array\n\t * - first element is action name\n\t */\n\tif (!isAction(refer(path))) {\n\t\tif (last && isNull(last[0]) && isNumber(last[1])) {\n\t\t\tlast[1]--;\n\t\t} else {\n\t\t\tpath.pop();\n\t\t}\n\t}\n\n\tif (isExitImpossible(path)) {\n\t\tconst referred = refer(path);\n\n\t\tif (isAction(referred) && isSkippedDuringRestore(referred[0])) {\n\t\t\tonExitImpossible?.();\n\t\t}\n\n\t\twasExitImpossible = true;\n\n\t\treturn {\n\t\t\texitImpossible: wasExitImpossible\n\t\t}\n\t}\n\n\tfor (let i = path.length - 1; i > 0; i--) {\n\t\tconst [name] = path[i];\n\n\t\t/**\n\t\t * Remember already exited paths\n\t\t */\n\t\tif (isBlockExitStatement(name)) {\n\t\t\tignore.push(name);\n\t\t}\n\n\t\t/**\n\t\t * Ignore everything that we do not need there\n\t\t */\n\t\tif (!isBlockStatement(name)) continue;\n\n\t\t/**\n\t\t * When we found an already exited path we remove it from the list\n\t\t */\n\t\tif (ignore.at(-1)?.startsWith(name)) {\n\t\t\tignore.pop();\n\t\t\tcontinue;\n\t\t}\n\n\t\t/**\n\t\t * Exit from the path\n\t\t */\n\t\tpath.push([`${name}:exit`]);\n\n\t\tconst prev = findLastPathItemBeforeItemOfType(path.slice(0, i + 1), name);\n\n\t\t/**\n\t\t * When possible also go to the next action (or exit from one layer above)\n\t\t */\n\t\tif (prev) path.push([null, prev[1] + 1]);\n\n\t\t/**\n\t\t * If we added an `[null, int]` but it points not to action, then\n\t\t *\n\t\t * - remove that item\n\t\t * - close another block\n\t\t */\n\t\tif (!isAction(refer(path))) {\n\t\t\tpath.pop();\n\t\t\tcontinue;\n\t\t}\n\n\t\tbreak;\n\t}\n\n\treturn {\n\t\texitImpossible: wasExitImpossible\n\t}\n}\n\nconst nextPath = (path: Path) => {\n\t/**\n\t * Last path element\n\t */\n\tconst last = path.at(-1);\n\n\tif (last && (isNull(last[0]) || last[0] === 'jump') && isNumber(last[1])) {\n\t\tlast[1]++;\n\t} else {\n\t\tpath.push([null, 0]);\n\t}\n\n\treturn path;\n}\n\n/**\n * Is custom and requires user action or skipped during restoring\n */\nconst isBlockingAction = (action: Exclude<ValidAction, ValidAction[]>) => {\n\treturn isUserRequiredAction(action) || (isSkippedDuringRestore(action[0]) && action[0] !== 'vibrate')\n}\n\ntype CollectActionsBeforeBlockingActionOptions = {\n\tpath: Path;\n\trefer: ReferFunction;\n}\n\nconst collectActionsBeforeBlockingAction = ({ path, refer }: CollectActionsBeforeBlockingActionOptions) => {\n\tconst collection: Exclude<ValidAction, ValidAction[]>[] = []\n\n\tlet action = refer(path);\n\n\twhile (true) {\n\t\tif (action == undefined) {\n\t\t\tconst { exitImpossible } = exitPath({\n\t\t\t\tpath,\n\t\t\t\trefer,\n\t\t\t})\n\n\t\t\tif (exitImpossible) {\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tif (!action) {\n\t\t\tbreak;\n\t\t}\n\n\t\tif (isBlockingAction(action)) {\n\t\t\tconst [name, ...props] = action;\n\n\t\t\tif (name === 'choice') {\n\t\t\t\tconst choiceProps = props as unknown as GetActionParameters<'Choice'>;\n\n\t\t\t\tfor (let i = 0; i < choiceProps.length; i++) {\n\t\t\t\t\tconst branchContent = choiceProps[i];\n\n\t\t\t\t\t/**\n\t\t\t\t\t * This is a title\n\t\t\t\t\t */\n\t\t\t\t\tif (!Array.isArray(branchContent)) continue;\n\n\t\t\t\t\tconst virtualPath = klona(path)\n\n\t\t\t\t\tvirtualPath.push(['choice', i], [null, 0])\n\n\t\t\t\t\tconst innerActions = collectActionsBeforeBlockingAction({\n\t\t\t\t\t\tpath: virtualPath,\n\t\t\t\t\t\trefer\n\t\t\t\t\t});\n\n\t\t\t\t\tcollection.push(...innerActions);\n\t\t\t\t}\n\t\t\t} else if (name === 'condition') {\n\t\t\t\tconst conditionProps = props as unknown as GetActionParameters<'Condition'>;\n\t\t\t\tconst conditions = Object.keys(conditionProps[1]);\n\n\t\t\t\tfor (const condition of conditions) {\n\t\t\t\t\tconst virtualPath = klona(path)\n\n\t\t\t\t\tvirtualPath.push(['condition', condition], [null, 0])\n\n\t\t\t\t\tconst innerActions = collectActionsBeforeBlockingAction({\n\t\t\t\t\t\tpath: virtualPath,\n\t\t\t\t\t\trefer\n\t\t\t\t\t});\n\n\t\t\t\t\tcollection.push(...innerActions);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\t\t}\n\n\t\tcollection.push(action)\n\n\t\t/**\n\t\t * These special actions requires path change\n\t\t */\n\t\tif (action[0] === 'jump') {\n\t\t\tpath = [['jump', action[1]], [null, 0]]\n\t\t} else if (action[0] == 'block') {\n\t\t\tpath.push(['block', action[1]], [null, 0])\n\t\t} else {\n\t\t\tnextPath(path);\n\t\t}\n\n\t\taction = refer(path);\n\t}\n\n\treturn collection;\n}\n\nconst unwrapAsset = (asset: string | NovelyAsset) => {\n\treturn isAsset(asset) ? asset.source : asset;\n}\n\nconst handleAudioAsset = (asset: string | NovelyAsset) => {\n\tif (DEV && isAsset(asset) && asset.type !== 'audio') {\n\t\tthrow new Error('Attempt to use non-audio asset in audio action', { cause: asset });\n\t}\n\n\treturn unwrapAsset(asset);\n}\n\nconst handleImageAsset = (asset: string | NovelyAsset) => {\n\tif (DEV && isAsset(asset) && asset.type !== 'image') {\n\t\tthrow new Error('Attempt to use non-image asset in action that requires image assets', { cause: asset });\n\t}\n\n\treturn unwrapAsset(asset);\n}\n\nconst getCharactersData = <Characters extends Record<string, Character<Lang>>>(characters: Characters) => {\n\tconst entries = Object.entries(characters);\n\tconst mapped = entries.map(([key, value]) => [key, { name: value.name, emotions: Object.keys(value.emotions) }]);\n\n\treturn Object.fromEntries(mapped) as CharactersData<Characters>;\n}\n\nconst toArray = <T>(target: T | T[]) => {\n\treturn Array.isArray(target) ? target : [target]\n}\n\nexport {\n\tmatchAction,\n\tisNumber,\n\tisNull,\n\tisString,\n\tisPromise,\n\tisEmpty,\n\tisCSSImage,\n\tstr,\n\tisUserRequiredAction,\n\tgetLanguage,\n\tthrottle,\n\tisFunction,\n\tfindLastIndex,\n\tfindLast,\n\tcreateControlledPromise,\n\tfindLastPathItemBeforeItemOfType,\n\tisBlockStatement,\n\tisBlockExitStatement,\n\tisSkippedDuringRestore,\n\tnoop,\n\tisAction,\n\tisAudioAction,\n\tflattenStory,\n\tonce,\n\tisExitImpossible,\n\tgetOppositeAction,\n\tgetActionsFromPath,\n\tcreateQueueProcessor,\n\tgetStack,\n\tcreateUseStackFunction,\n\tmapSet,\n\tisImageAsset,\n\tgetUrlFileExtension,\n\tgetResourseType,\n\tcapitalize,\n\tgetIntlLanguageDisplayName,\n\tcreateReferFunction,\n\texitPath,\n\tcollectActionsBeforeBlockingAction,\n\tnextPath,\n\tisBlockingAction,\n\thandleAudioAsset,\n\thandleImageAsset,\n\tgetCharactersData,\n\ttoArray\n};\n\nexport type { MatchActionOptions, ControlledPromise, MatchActionMapComplete }\n","var has = Object.prototype.hasOwnProperty;\n\nexport function dequal(foo, bar) {\n\tvar ctor, len;\n\tif (foo === bar) return true;\n\n\tif (foo && bar && (ctor=foo.constructor) === bar.constructor) {\n\t\tif (ctor === Date) return foo.getTime() === bar.getTime();\n\t\tif (ctor === RegExp) return foo.toString() === bar.toString();\n\n\t\tif (ctor === Array) {\n\t\t\tif ((len=foo.length) === bar.length) {\n\t\t\t\twhile (len-- && dequal(foo[len], bar[len]));\n\t\t\t}\n\t\t\treturn len === -1;\n\t\t}\n\n\t\tif (!ctor || typeof foo === 'object') {\n\t\t\tlen = 0;\n\t\t\tfor (ctor in foo) {\n\t\t\t\tif (has.call(foo, ctor) && ++len && !has.call(bar, ctor)) return false;\n\t\t\t\tif (!(ctor in bar) || !dequal(foo[ctor], bar[ctor])) return false;\n\t\t\t}\n\t\t\treturn Object.keys(bar).length === len;\n\t\t}\n\t}\n\n\treturn foo !== foo && bar !== bar;\n}\n","type Stored<T> = {\n\tsubscribe: (cb: (value: T) => void) => () => void;\n\tupdate: (fn: (prev: T) => T) => void;\n\tset: (val: T) => void;\n\tget: () => T;\n};\n\nconst store = <T>(current: T, subscribers = new Set<(value: T) => void>()): Stored<T> => {\n\tconst subscribe = (cb: (value: T) => void) => {\n\t\tsubscribers.add(cb), cb(current);\n\n\t\treturn () => {\n\t\t\tsubscribers.delete(cb);\n\t\t};\n\t};\n\n\tconst push = (value: T) => {\n\t\tfor (const cb of subscribers) cb(value);\n\t};\n\n\tconst update = (fn: (prev: T) => T) => {\n\t\tpush((current = fn(current)));\n\t};\n\n\tconst set = (val: T) => {\n\t\tupdate(() => val);\n\t}\n\n\tconst get = () => {\n\t\treturn current;\n\t};\n\n\treturn { subscribe, update, set, get } as const;\n};\n\nexport { store };\nexport type { Stored };\n","const { isArray } = Array;\nconst { hasOwnProperty, propertyIsEnumerable, getOwnPropertySymbols } = Object;\n\nconst propertyIsOnObject = <T extends Record<PropertyKey, unknown>, K extends PropertyKey>(\n\tobject: T,\n\tproperty: K,\n): object is T & { [Key in K]: unknown } => {\n\ttry {\n\t\treturn property in object;\n\t} catch {\n\t\treturn false;\n\t}\n};\n\nconst propertyIsUnsafe = (target: Record<PropertyKey, unknown>, key: PropertyKey) => {\n\treturn (\n\t\tpropertyIsOnObject(target, key) && // Properties are safe to merge if they don't exist in the target yet,\n\t\t!(\n\t\t\thasOwnProperty.call(target, key) && // unsafe if they exist up the prototype chain,\n\t\t\tpropertyIsEnumerable.call(target, key)\n\t\t)\n\t); // and also unsafe if they're nonenumerable.\n};\n\nconst getEnumerableOwnPropertySymbols = (target: Record<PropertyKey, unknown>) => {\n\tif (!getOwnPropertySymbols) return [];\n\n\treturn getOwnPropertySymbols(target).filter((symbol) => propertyIsEnumerable.call(target, symbol));\n};\n\nconst keys = <T extends Record<PropertyKey, unknown>>(target: T): (keyof T)[] => {\n\treturn [...Object.keys(target), ...getEnumerableOwnPropertySymbols(target)];\n};\n\nconst isMergeableObject = (value: unknown): value is Record<PropertyKey, unknown> => {\n\treturn (\n\t\t!!value &&\n\t\ttypeof value === 'object' &&\n\t\t!['RegExp', 'Date'].includes(Object.prototype.toString.call(value).slice(8, -1))\n\t);\n};\n\nexport { isArray, propertyIsOnObject, propertyIsUnsafe, getEnumerableOwnPropertySymbols, isMergeableObject, keys };\n","import { isArray, propertyIsOnObject, propertyIsUnsafe, isMergeableObject, keys } from './utils';\n\nconst empty = <T extends Record<PropertyKey, unknown> | unknown[]>(value: T): T => {\n\treturn (isArray(value) ? [] : {}) as T;\n};\n\nconst clone = <T>(value: T): T => {\n\treturn isMergeableObject(value) ? deepmerge(empty(value), value) : value;\n};\n\nconst mergeArray = <T>(target: T[], source: T[]) => {\n\tconst destination = target.slice();\n\n\tsource.forEach((item, index) => {\n\t\tif (typeof destination[index] === 'undefined') {\n\t\t\tdestination[index] = clone(item);\n\t\t} else if (isMergeableObject(item)) {\n\t\t\tdestination[index] = deepmerge(target[index] as any, item as any);\n\t\t} else if (target.indexOf(item) === -1) {\n\t\t\tdestination.push(item);\n\t\t}\n\t});\n\n\treturn destination;\n};\n\nconst mergeObject = <T extends Record<PropertyKey, unknown>>(target: T, source: T): T => {\n\tconst destination: Record<PropertyKey, any> = {};\n\n\tfor (const key of keys(target)) {\n\t\tdestination[key] = clone(target[key]);\n\t}\n\n\tfor (const key of keys(source)) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && isMergeableObject(source[key])) {\n\t\t\tdestination[key] = deepmerge(target[key] as any, source[key] as any);\n\t\t} else {\n\t\t\tdestination[key] = clone(source[key]);\n\t\t}\n\t}\n\n\treturn destination as unknown as T;\n};\n\nconst deepmerge = <T extends Record<PropertyKey, unknown> | unknown[]>(target: T, source: T): T => {\n\tif (isArray(target) && isArray(source)) {\n\t\tconst merged = mergeArray(target, source);\n\n\t\treturn merged as unknown as T;\n\t} else if (!isArray(target) && !isArray(source)) {\n\t\tconst merged = mergeObject(target, source);\n\n\t\treturn merged as unknown as T;\n\t} else {\n\t\treturn clone(source);\n\t}\n};\n\nexport { deepmerge };\n","import type { Data, State } from \"./types\";\n\ntype PluralType = Intl.LDMLPluralRule;\ntype Pluralization = Partial<Record<PluralType, string>>;\ntype AllowedContent = string | ((state: State | Data) => string | string[]) | string[] | (string | ((state: State | Data) => string | string[]))[];\ntype TranslationActions = Partial<Record<string, (str: string) => string>>;\n\nconst RGX = /{{(.*?)}}/g;\n\nconst split = (input: string, delimeters: string[]) => {\n\tconst output: (string | undefined)[] = [];\n\n\tfor (const delimeter of delimeters) {\n\t\tif (!input) break;\n\n\t\tconst [start, end] = input.split(delimeter, 2);\n\n\t\toutput.push(start);\n\t\tinput = end;\n\t}\n\n\toutput.push(input);\n\n\treturn output;\n};\n\n/**\n * Turns any allowed content into string\n * @param c Content\n */\nconst flattenAllowedContent = (c: AllowedContent, state: State | Data): string => {\n\tif (Array.isArray(c)) {\n\t\treturn c.map((item) => flattenAllowedContent(item, state)).join('<br>');\n\t}\n\n\tif (typeof c === 'function') {\n\t\treturn flattenAllowedContent(c(state), state);\n\t}\n\n\treturn c;\n};\n\nconst replace = (\n\tinput: string,\n\tdata: Record<string, unknown>,\n\tpluralization?: Record<string, Pluralization>,\n\tactions?: TranslationActions,\n\tpr?: Intl.PluralRules,\n) => {\n\treturn input.replaceAll(RGX, (x: any, key: string, y: any) => {\n\t\tx = 0;\n\t\ty = data;\n\n\t\tconst [pathstr, plural, action] = split(key.trim(), ['@', '%']);\n\n\t\tif (!pathstr) {\n\t\t\treturn '';\n\t\t}\n\n\t\tconst path = pathstr.split('.');\n\n\t\twhile (y && x < path.length) y = y[path[x++]];\n\n\t\tif (plural && pluralization && y && pr) {\n\t\t\ty = pluralization[plural][pr.select(y)];\n\t\t}\n\n\t\tconst actionHandler = (actions && action) ? actions[action] : void 0;\n\n\t\tif (actionHandler) y = actionHandler(y);\n\n\t\treturn y == null ? '' : y;\n\t});\n};\n\nexport { flattenAllowedContent, replace };\nexport type { AllowedContent, PluralType, Pluralization, TranslationActions };\n","import type { CustomHandler, CustomHandlerGetResult, CustomHandlerFunctionGetFn } from './action'\nimport type { Context, CustomActionHandle } from './renderer';\nimport type { Lang, State, StateFunction } from './types';\nimport { CUSTOM_ACTION_MAP } from './shared'\nimport { noop } from './utils';\n\ntype CustomActionHolder = {\n  /**\n   * Node in which custom action is rendered\n   */\n  node: null | HTMLDivElement;\n  /**\n   * Custom Handler function itself\n   */\n  fn: CustomHandler;\n  /**\n   * Local Data\n   */\n  localData: any;\n  /**\n   * Cleanup function. Provided by custom action.\n   */\n  cleanup: () => void;\n}\n\ntype HandleCustomActionOptions = CustomActionHandle & {\n  /**\n   * State Function\n   */\n  state: StateFunction<State>\n  /**\n   * Current Game Language\n   */\n  lang: Lang\n}\n\nconst createCustomActionNode = (id: string) => {\n  const div = document.createElement('div');\n\n  div.setAttribute('data-id', id);\n\n  return div;\n}\n\nconst getCustomActionHolder = (ctx: Context, fn: CustomHandler) => {\n  const cached = CUSTOM_ACTION_MAP.get(ctx.id + fn.key);\n\n  if (cached) {\n    return cached;\n  }\n\n  const holder = {\n    cleanup: noop,\n    node: null,\n    fn: fn,\n    localData: {}\n  } satisfies CustomActionHolder;\n\n  CUSTOM_ACTION_MAP.set(ctx.id + fn.key, holder);\n\n  return holder;\n}\n\nconst handleCustomAction = (ctx: Context, fn: CustomHandler, { lang, state, setMountElement, setClear, remove: renderersRemove }: HandleCustomActionOptions) => {\n  const holder = getCustomActionHolder(ctx, fn);\n\n  const flags = {\n    ...ctx.meta\n  };\n\n  const getDomNodes = (insert = true): CustomHandlerGetResult<boolean> => {\n    if (holder.node || !insert) {\n      return {\n        element: holder.node,\n        root: ctx.root\n      }\n    }\n\n    holder.node = insert ? createCustomActionNode(fn.key) : null;\n\n    setMountElement(holder.node);\n\n    return {\n      element: holder.node,\n      root: ctx.root\n    }\n  };\n\n  const clear = (func: typeof noop) => {\n    /**\n     * We wrap original cleanup to achieve these goals:\n     *\n     * - when cleaned up function will not be called again\n     * - when cleaned up renderer will get updated element\n     */\n    setClear(holder.cleanup = () => {\n      func();\n\n      holder.node = null;\n      holder.cleanup = noop;\n\n      setMountElement(null);\n      setClear(noop);\n    });\n  }\n\n  const data = (updatedData?: any) => {\n    if (updatedData) {\n      return holder.localData = updatedData;\n    }\n\n    return holder.localData;\n  }\n\n  const remove = () => {\n    holder.cleanup();\n    renderersRemove();\n  }\n\n  return fn({\n    flags,\n\n    lang,\n\n    state,\n    data,\n\n    clear,\n    remove,\n\n    rendererContext: ctx,\n\n    getDomNodes: getDomNodes as CustomHandlerFunctionGetFn\n  });\n}\n\nexport { getCustomActionHolder, handleCustomAction }\nexport type { CustomActionHolder, HandleCustomActionOptions }\n","import type { StorageData } from './types';\n\ninterface LocalStorageStorageSettings {\n\tkey: string;\n}\n\ninterface Storage {\n\tget: () => Promise<StorageData>;\n\tset: (data: StorageData) => Promise<void>;\n}\n\nconst localStorageStorage = (options: LocalStorageStorageSettings): Storage => {\n\treturn {\n\t\tasync get() {\n\t\t\tconst fallback = { saves: [], data: {}, meta: [] };\n\n\t\t\ttry {\n\t\t\t\tconst value = localStorage.getItem(options.key);\n\n\t\t\t\treturn value ? JSON.parse(value) : fallback;\n\t\t\t} catch {\n\t\t\t\treturn fallback;\n\t\t\t}\n\t\t},\n\t\tasync set(data) {\n\t\t\ttry {\n\t\t\t\tlocalStorage.setItem(options.key, JSON.stringify(data));\n\t\t\t} catch {}\n\t\t},\n\t};\n};\n\nexport type { Storage };\nexport { localStorageStorage };\n","import { noop } from \"./utils\";\n\ntype SetupBrowserVisibilityChangeListenersOptions = {\n  onChange: () => void;\n}\n\n/**\n * Browser-only function.\n *\n * Tries to save data when page is switched OR is going to be unloaded\n */\nconst setupBrowserVisibilityChangeListeners = ({ onChange }: SetupBrowserVisibilityChangeListenersOptions) => {\n  if (typeof document === 'undefined') return noop;\n\n\tconst onVisibilityChange = () => {\n\t\tif (document.visibilityState === 'hidden') {\n\t\t\tonChange();\n\t\t}\n\t}\n\n\taddEventListener('visibilitychange', onVisibilityChange);\n\taddEventListener('beforeunload', onChange);\n\n  return () => {\n    removeEventListener('visibilitychange', onVisibilityChange);\n    removeEventListener('beforeunload', onChange);\n  }\n}\n\nexport { setupBrowserVisibilityChangeListeners }\nexport type { SetupBrowserVisibilityChangeListenersOptions }\n","/*\nHow it works:\n`this.#head` is an instance of `Node` which keeps track of its current value and nests another instance of `Node` that keeps the value that comes after it. When a value is provided to `.enqueue()`, the code needs to iterate through `this.#head`, going deeper and deeper to find the last value. However, iterating through every single item is slow. This problem is solved by saving a reference to the last value as `this.#tail` so that it can reference it to add a new value.\n*/\n\nclass Node {\n\tvalue;\n\tnext;\n\n\tconstructor(value) {\n\t\tthis.value = value;\n\t}\n}\n\nexport default class Queue {\n\t#head;\n\t#tail;\n\t#size;\n\n\tconstructor() {\n\t\tthis.clear();\n\t}\n\n\tenqueue(value) {\n\t\tconst node = new Node(value);\n\n\t\tif (this.#head) {\n\t\t\tthis.#tail.next = node;\n\t\t\tthis.#tail = node;\n\t\t} else {\n\t\t\tthis.#head = node;\n\t\t\tthis.#tail = node;\n\t\t}\n\n\t\tthis.#size++;\n\t}\n\n\tdequeue() {\n\t\tconst current = this.#head;\n\t\tif (!current) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#head = this.#head.next;\n\t\tthis.#size--;\n\t\treturn current.value;\n\t}\n\n\tpeek() {\n\t\tif (!this.#head) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.#head.value;\n\n\t\t// TODO: Node.js 18.\n\t\t// return this.#head?.value;\n\t}\n\n\tclear() {\n\t\tthis.#head = undefined;\n\t\tthis.#tail = undefined;\n\t\tthis.#size = 0;\n\t}\n\n\tget size() {\n\t\treturn this.#size;\n\t}\n\n\t* [Symbol.iterator]() {\n\t\tlet current = this.#head;\n\n\t\twhile (current) {\n\t\t\tyield current.value;\n\t\t\tcurrent = current.next;\n\t\t}\n\t}\n}\n","import Queue from 'yocto-queue';\n\nexport default function pLimit(concurrency) {\n\tvalidateConcurrency(concurrency);\n\n\tconst queue = new Queue();\n\tlet activeCount = 0;\n\n\tconst resumeNext = () => {\n\t\tif (activeCount < concurrency && queue.size > 0) {\n\t\t\tqueue.dequeue()();\n\t\t\t// Since `pendingCount` has been decreased by one, increase `activeCount` by one.\n\t\t\tactiveCount++;\n\t\t}\n\t};\n\n\tconst next = () => {\n\t\tactiveCount--;\n\n\t\tresumeNext();\n\t};\n\n\tconst run = async (function_, resolve, arguments_) => {\n\t\tconst result = (async () => function_(...arguments_))();\n\n\t\tresolve(result);\n\n\t\ttry {\n\t\t\tawait result;\n\t\t} catch {}\n\n\t\tnext();\n\t};\n\n\tconst enqueue = (function_, resolve, arguments_) => {\n\t\t// Queue `internalResolve` instead of the `run` function\n\t\t// to preserve asynchronous context.\n\t\tnew Promise(internalResolve => {\n\t\t\tqueue.enqueue(internalResolve);\n\t\t}).then(\n\t\t\trun.bind(undefined, function_, resolve, arguments_),\n\t\t);\n\n\t\t(async () => {\n\t\t\t// This function needs to wait until the next microtask before comparing\n\t\t\t// `activeCount` to `concurrency`, because `activeCount` is updated asynchronously\n\t\t\t// after the `internalResolve` function is dequeued and called. The comparison in the if-statement\n\t\t\t// needs to happen asynchronously as well to get an up-to-date value for `activeCount`.\n\t\t\tawait Promise.resolve();\n\n\t\t\tif (activeCount < concurrency) {\n\t\t\t\tresumeNext();\n\t\t\t}\n\t\t})();\n\t};\n\n\tconst generator = (function_, ...arguments_) => new Promise(resolve => {\n\t\tenqueue(function_, resolve, arguments_);\n\t});\n\n\tObject.defineProperties(generator, {\n\t\tactiveCount: {\n\t\t\tget: () => activeCount,\n\t\t},\n\t\tpendingCount: {\n\t\t\tget: () => queue.size,\n\t\t},\n\t\tclearQueue: {\n\t\t\tvalue() {\n\t\t\t\tqueue.clear();\n\t\t\t},\n\t\t},\n\t\tconcurrency: {\n\t\t\tget: () => concurrency,\n\n\t\t\tset(newConcurrency) {\n\t\t\t\tvalidateConcurrency(newConcurrency);\n\t\t\t\tconcurrency = newConcurrency;\n\n\t\t\t\tqueueMicrotask(() => {\n\t\t\t\t\t// eslint-disable-next-line no-unmodified-loop-condition\n\t\t\t\t\twhile (activeCount < concurrency && queue.size > 0) {\n\t\t\t\t\t\tresumeNext();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t});\n\n\treturn generator;\n}\n\nfunction validateConcurrency(concurrency) {\n\tif (!((Number.isInteger(concurrency) || concurrency === Number.POSITIVE_INFINITY) && concurrency > 0)) {\n\t\tthrow new TypeError('Expected `concurrency` to be a number from 1 and up');\n\t}\n}\n","import type { CustomHandler, DefaultActionProxy } from './action';\nimport type { Character } from './character';\nimport { STACK_MAP, PRELOADED_ASSETS, ASSETS_TO_PRELOAD } from './shared';\nimport { getResourseType, mapSet, isImageAsset, isString, isAudioAction, handleImageAsset, toArray, handleAudioAsset } from './utils'\n\n/**\n * Adds asset to `ASSETS_TO_PRELOAD` firstly checking if is was already preloaded\n */\nconst enqueueAssetForPreloading = (asset: string) => {\n  if (!PRELOADED_ASSETS.has(asset)) {\n    ASSETS_TO_PRELOAD.add(asset)\n  }\n}\n\ntype HandleAssetsPreloadingOptions = {\n  request: typeof fetch;\n\n  limiter: (fn: () => void | PromiseLike<void>) => Promise<void>;\n\n  preloadAudioBlocking: (source: string) => Promise<void>;\n  preloadImageBlocking: (source: string) => Promise<void>;\n}\n\n/**\n * Preloads assets\n */\nconst handleAssetsPreloading = async ({ request, limiter, preloadAudioBlocking, preloadImageBlocking }: HandleAssetsPreloadingOptions) => {\n  const list = mapSet(ASSETS_TO_PRELOAD, (asset) => {\n    return limiter(async () => {\n      const type = await getResourseType(request, asset);\n\n      switch (type) {\n        case 'audio': {\n          await preloadAudioBlocking(asset);\n          break;\n        }\n\n        case 'image': {\n          await preloadImageBlocking(asset);\n          break;\n        }\n      }\n\n      ASSETS_TO_PRELOAD.delete(asset);\n      PRELOADED_ASSETS.add(asset);\n    })\n  });\n\n  /**\n   * `allSettled` is used because even if error happens game should run\n   *\n   * Ideally, there could be a notification for player, maybe developer could be also notified\n   * But I don't think it's really needed\n   */\n  await Promise.allSettled(list);\n\n  ASSETS_TO_PRELOAD.clear();\n}\n\ntype HuntAssetsOptions = {\n  /**\n   * Characters object from user config\n   */\n  characters: Record<string, Character>;\n  /**\n   * Action name\n   */\n  action: keyof DefaultActionProxy;\n  /**\n   * Action props\n   */\n  props: Parameters<DefaultActionProxy[keyof DefaultActionProxy]>;\n  /**\n   * Function to handle found asset\n   */\n  handle: (asset: string) => void;\n}\n\nconst huntAssets = ({ characters, action, props, handle }: HuntAssetsOptions) => {\n  if (action === 'showBackground') {\n    /**\n     * There are two types of showBackground currently\n     *\n     * Parameter is a `string`\n     * Parameter is a `Record<'CSS Media', string>`\n     */\n    if (isString(props[0])) {\n      handle(handleAudioAsset(props[0]));\n    }\n\n    // todo: asset\n    if (props[0] && typeof props[0] === 'object') {\n      for (const value of Object.values(props[0])) {\n        if (isImageAsset(value)) {\n          handle(value)\n        }\n      }\n    }\n\n    return;\n  }\n\n  /**\n   * Here \"stop\" action also matches condition, but because `ASSETS_TO_PRELOAD` is a Set, there is no problem\n   */\n  if (isAudioAction(action) && isString(props[0])) {\n    handle(handleAudioAsset(props[0]))\n    return;\n  }\n\n  /**\n   * Load characters\n   */\n  if (action === 'showCharacter' && isString(props[0]) && isString(props[1])) {\n    const images = toArray(characters[props[0]].emotions[props[1]]);\n\n    for (const asset of images) {\n      handle(handleImageAsset(asset));\n    }\n\n    return;\n  }\n\n  /**\n   * Custom action assets\n   */\n  if (action === 'custom' && (props[0] as CustomHandler).assets && (props[0] as CustomHandler).assets!.length > 0) {\n    for (const asset of (props[0] as CustomHandler).assets!) {\n      handle(asset);\n    }\n\n    return;\n  }\n}\n\nexport { enqueueAssetForPreloading, handleAssetsPreloading, huntAssets }\n","import type { Character } from './character';\nimport type {\n\tActionProxy,\n\tStory,\n\tValidAction,\n\tTextContent,\n\tCustomHandler,\n} from './action';\nimport type {\n\tSave,\n\tState,\n\tData,\n\tStorageData,\n\tCoreData,\n\tNovelyInit,\n\tStateFunction,\n\tLang,\n\tTypeEssentials\n} from './types';\nimport type { Stored } from './store';\nimport type { Context, RendererInitPreviewReturn } from './renderer';\nimport type { BaseTranslationStrings } from './translations';\nimport type { ControlledPromise, MatchActionOptions } from './utils';\nimport {\n\tmatchAction,\n\tisEmpty,\n\tgetLanguage as defaultGetLanguage,\n\tthrottle,\n\tisFunction,\n\tcreateControlledPromise,\n\tisAction,\n\tnoop,\n\tflattenStory,\n\tgetActionsFromPath,\n\tcreateUseStackFunction,\n\tcreateQueueProcessor,\n\tisAudioAction,\n\tisString,\n\tgetResourseType,\n\tcapitalize,\n\tgetIntlLanguageDisplayName,\n\tcreateReferFunction,\n\texitPath,\n\tnextPath,\n\tisPromise,\n\tisBlockingAction,\n\tcollectActionsBeforeBlockingAction,\n\thandleAudioAsset,\n\tgetCharactersData,\n\thandleImageAsset,\n\ttoArray\n} from './utils';\nimport { dequal } from 'dequal/lite';\nimport { store } from './store';\nimport { deepmerge } from '@novely/deepmerge';\nimport { klona } from 'klona/json';\nimport { EMPTY_SET, DEFAULT_TYPEWRITER_SPEED, MAIN_CONTEXT_KEY } from './constants';\nimport { replace as replaceTranslation, flattenAllowedContent } from './translation';\nimport { handleCustomAction, getCustomActionHolder } from './custom-action'\nimport { localStorageStorage } from './storage';\nimport { setupBrowserVisibilityChangeListeners } from './browser';\nimport pLimit from 'p-limit';\n\nimport { DEV } from 'esm-env';\nimport { STACK_MAP, PRELOADED_ASSETS, ASSETS_TO_PRELOAD } from './shared';\nimport { enqueueAssetForPreloading, handleAssetsPreloading, huntAssets } from './preloading';\nimport { isAsset } from './asset';\n\nconst novely = <\n\t$Language extends string,\n\t$Characters extends Record<string, Character<$Language>>,\n\t$State extends State,\n\t$Data extends Data,\n\t$Actions extends Record<string, (...args: any[]) => ValidAction>\n>({\n\tcharacters,\n\tcharacterAssetSizes = {},\n\tdefaultEmotions = {},\n\tstorage = localStorageStorage({ key: 'novely-game-storage' }),\n\tstorageDelay = Promise.resolve(),\n\trenderer: createRenderer,\n\tinitialScreen = 'mainmenu',\n\ttranslation,\n\tstate: defaultState = {} as $State,\n\tdata: defaultData = {} as $Data,\n\tautosaves = true,\n\tmigrations = [],\n\tthrottleTimeout = 799,\n\tgetLanguage = defaultGetLanguage,\n\toverrideLanguage = false,\n\taskBeforeExit = true,\n\tpreloadAssets = 'lazy',\n\tparallelAssetsDownloadLimit = 15,\n\tfetch: request = fetch,\n\tsaveOnUnload = true,\n\tstartKey = 'start'\n}: NovelyInit<$Language, $Characters, $State, $Data, $Actions>) => {\n\t// Local type declaration to not repeat code\n\t/**\n\t * All action functions\n\t */\n\ttype Actions = $Actions & ActionProxy<$Characters, $Language, $State>;\n\n\tconst languages = Object.keys(translation) as $Language[];\n\n\tconst limitScript = pLimit(1);\n\tconst limitAssetsDownload = pLimit(parallelAssetsDownloadLimit);\n\n\tconst story: Story = {};\n\n\tconst times = new Set<number>();\n\n\tconst dataLoaded = createControlledPromise();\n\n\tlet initialScreenWasShown = false;\n\tlet destroyed = false;\n\n\t/**\n\t * Saves timestamps created in this session\n\t */\n\tconst intime = (value: number) => {\n\t\treturn times.add(value), value;\n\t};\n\n\tconst scriptBase = async (part: Story) => {\n\t\t/**\n\t\t * In case script was called after destroy\n\t\t */\n\t\tif (destroyed) return;\n\n\t\tObject.assign(story, flattenStory(part));\n\n\t\tlet loadingIsShown = false;\n\n\t\t/**\n\t\t * This is the first `script` call, likely data did not loaded yet\n\t\t */\n\t\tif (!initialScreenWasShown) {\n\t\t\trenderer.ui.showLoading();\n\t\t\tloadingIsShown = true;\n\t\t}\n\n\t\tif (preloadAssets === 'blocking' && ASSETS_TO_PRELOAD.size > 0) {\n\t\t\t/**\n\t\t\t * Likely updating this will not break anything, but just to be sure nothing breaks\n\t\t\t * We want to avoid flashes, and who knows how some renderer will use it\n\t\t\t */\n\t\t\tif (!loadingIsShown) {\n\t\t\t\trenderer.ui.showLoading();\n\t\t\t}\n\n\t\t\tawait handleAssetsPreloading({\n\t\t\t\t...renderer.misc,\n\t\t\t\tlimiter: limitAssetsDownload,\n\t\t\t\trequest,\n\t\t\t});\n\t\t}\n\n\t\tawait dataLoaded.promise;\n\n\t\trenderer.ui.hideLoading()\n\n\t\tif (!initialScreenWasShown) {\n\t\t\tinitialScreenWasShown = true;\n\n\t\t\tif (initialScreen === 'game') {\n\t\t\t\trestore(undefined);\n\t\t\t} else {\n\t\t\t\trenderer.ui.showScreen(initialScreen);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Setup your story here\n\t *\n\t * Call more than once to merge different story parts\n\t *\n\t * @example\n\t *\n\t * ```js\n\t * engine.script({\n\t *  start: [action.jump('another-part')]\n\t * })\n\t *\n\t * engine.script({\n\t *  'another-part': []\n\t * })\n\t * ```\n\t */\n\tconst script = (part: Story) => {\n\t\treturn limitScript(() => scriptBase(part));\n\t}\n\n\tconst action = new Proxy({} as Actions, {\n\t\tget<Action extends keyof Actions & string>(_: unknown, action: Action) {\n\t\t\tif (action in renderer.actions) {\n\t\t\t\treturn renderer.actions[action];\n\t\t\t}\n\n\t\t\treturn (...props: Parameters<Actions[Action]>) => {\n\t\t\t\tif (preloadAssets === 'blocking') {\n\t\t\t\t\t// @ts-expect-error\n\t\t\t\t\thuntAssets({ characters, action, props, handle: enqueueAssetForPreloading })\n\t\t\t\t}\n\n\t\t\t\treturn [action, ...props] as ValidAction;\n\t\t\t};\n\t\t},\n\t});\n\n\tconst getDefaultSave = (state = {}) => {\n\t\treturn [\n\t\t\t[\n\t\t\t\t['jump', startKey],\n\t\t\t\t[null, 0],\n\t\t\t],\n\t\t\tstate,\n\t\t\t[intime(Date.now()), 'auto'],\n\t\t] as Save;\n\t};\n\n\t/**\n\t * Calls `getLanguage`, passes needed arguments\n\t * @returns language\n\t */\n\tconst getLanguageWithoutParameters = () => {\n\t\tconst language = getLanguage(languages, defaultGetLanguage);\n\n\t\t/**\n\t\t * This is valid language\n\t\t */\n\t\tif (languages.includes(language as $Language)) {\n\t\t\treturn language as $Language;\n\t\t}\n\n\t\tif (DEV) {\n\t\t\tthrow new Error(`Attempt to use unsupported language \"${language}\". Supported languages: ${languages.join(', ')}.`)\n\t\t}\n\n\t\tthrow 0;\n\t};\n\n\t/**\n\t * 1) Novely rendered using the `initialData`, but you can't start new game or `load` an empty one - this is scary, imagine losing your progress\n\t * 2) Actual stored data is loaded, language and etc is changed\n\t */\n\tconst initialData: StorageData<$Language, $Data> = {\n\t\tsaves: [],\n\t\tdata: klona(defaultData),\n\t\tmeta: [getLanguageWithoutParameters(), DEFAULT_TYPEWRITER_SPEED, 1, 1, 1],\n\t};\n\n\tconst storageData = store(initialData);\n\tconst coreData = store<CoreData>({\n\t\tdataLoaded: false\n\t});\n\n\tconst onDataLoadedPromise = ({ cancelled }: Awaited<ControlledPromise<void>>) => {\n\t\t/**\n\t\t * Promise cancelled? Re-subscribe\n\t\t */\n\t\tif (cancelled) {\n\t\t\tdataLoaded.promise.then(onDataLoadedPromise);\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * When promise is resolved data is marked loaded\n\t\t */\n\t\tcoreData.update((data) => {\n\t\t\tdata.dataLoaded = true;\n\n\t\t\treturn data;\n\t\t})\n\t};\n\n\tdataLoaded.promise.then(onDataLoadedPromise);\n\n\tconst onStorageDataChange = (value: StorageData) => {\n\t\tif (coreData.get().dataLoaded) storage.set(value);\n\t};\n\n\tconst throttledOnStorageDataChange = throttle(onStorageDataChange, throttleTimeout);\n\tconst throttledEmergencyOnStorageDataChange = throttle(() => {\n\t\tif (saveOnUnload === true || saveOnUnload === 'prod' && !DEV) {\n\t\t\tonStorageDataChange(storageData.get());\n\t\t}\n\t}, 10);\n\n\tstorageData.subscribe(throttledOnStorageDataChange);\n\n\tconst getStoredData = async () => {\n\t\tlet stored = await storage.get();\n\n\t\tfor (const migration of migrations) {\n\t\t\tstored = migration(stored) as StorageData;\n\n\t\t\tif (DEV && !stored) {\n\t\t\t\tthrow new Error('Migrations should return a value.')\n\t\t\t}\n\t\t}\n\n\t\tif (overrideLanguage || !stored.meta[0]) {\n\t\t\tstored.meta[0] = getLanguageWithoutParameters();\n\t\t}\n\n\t\t/**\n\t\t * Default `localStorageStorage` returns empty array\n\t\t */\n\t\tstored.meta[1] ||= DEFAULT_TYPEWRITER_SPEED;\n\n\t\t/**\n\t\t * Sound Volumes\n\t\t */\n\t\tstored.meta[2] ??= 1;\n\t\tstored.meta[3] ??= 1;\n\t\tstored.meta[4] ??= 1;\n\n\t\t/**\n\t\t * When data is empty replace it with `defaultData`\n\t\t * It also might be empty (default to empty)\n\t\t */\n\t\tif (isEmpty(stored.data)) {\n\t\t\tstored.data = defaultData as Data;\n\t\t}\n\n\t\t/**\n\t\t * Now the next store updates will entail saving via storage.set\n\t\t */\n\t\tdataLoaded.resolve();\n\n\t\tstorageData.set(stored as StorageData<$Language, $Data>);\n\t};\n\n\t/**\n\t * By default this is resolved immediately, but also can be delayed.\n\t * I.e. storage has not loaded yet\n\t */\n\tstorageDelay.then(getStoredData);\n\n\tconst initial = getDefaultSave(klona(defaultState));\n\n\tconst unsubscribeFromBrowserVisibilityChange = setupBrowserVisibilityChangeListeners({\n\t\tonChange: throttledEmergencyOnStorageDataChange\n\t})\n\n\tconst save = (type: Save[2][1]) => {\n\t\tif (!coreData.get().dataLoaded) return;\n\n\t\t/**\n\t\t * When autosaves diabled just return\n\t\t */\n\t\tif (!autosaves && type === 'auto') return;\n\n\t\t/**\n\t\t * Saves only possible in main context, so there is no reason for context to be used here\n\t\t */\n\t\tconst stack = useStack(MAIN_CONTEXT_KEY);\n\t\tconst current = klona(stack.value);\n\n\t\tstorageData.update((prev) => {\n\t\t\tconst replace = () => {\n\t\t\t\tprev.saves[prev.saves.length - 1] = current;\n\n\t\t\t\treturn prev;\n\t\t\t}\n\n\t\t\tconst add = () => {\n\t\t\t\tprev.saves.push(current);\n\n\t\t\t\treturn prev;\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Get latest\n\t\t\t */\n\t\t\tconst last = prev.saves.at(-1);\n\n\t\t\t/**\n\t\t\t * We cannot compare anything here, thus just reutrn\n\t\t\t */\n\t\t\tif (!last) return add();\n\n\t\t\t/**\n\t\t\t * Update type and time information\n\t\t\t */\n\t\t\tcurrent[2][0] = intime(Date.now());\n\t\t\tcurrent[2][1] = type;\n\n\t\t\tconst isIdentical = (dequal(last[0], current[0]) && dequal(last[1], current[1]));\n\t\t\tconst isLastMadeInCurrentSession = times.has(last[2][0]);\n\n\t\t\t/**\n\t\t\t * Even in override is false, we will replace auto save with maual, because they are the same thing basically\n\t\t\t */\n\t\t\tif (isLastMadeInCurrentSession && last[2][1] === 'auto' && type === 'manual') {\n\t\t\t\treturn replace();\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Player has made a manual save, novely decided to make an auto save\n\t\t\t * But it is identical to previously created manual save so completely not wanted\n\t\t\t */\n\t\t\tif (last[2][1] === 'manual' && type === 'auto' && isIdentical) {\n\t\t\t\treturn prev;\n\t\t\t}\n\n\t\t\tif (isLastMadeInCurrentSession && last[2][1] === 'auto' && type === 'auto') {\n\t\t\t\treturn replace();\n\t\t\t}\n\n\t\t\treturn add();\n\t\t});\n\t};\n\n\tconst newGame = () => {\n\t\tif (!coreData.get().dataLoaded) return;\n\n\t\tconst save = getDefaultSave(klona(defaultState));\n\n\t\t/**\n\t\t * Initial save is automatic, and should be ignored when autosaves is turned off\n\t\t */\n\t\tif (autosaves) {\n\t\t\tstorageData.update((prev) => {\n\t\t\t\treturn prev.saves.push(save), prev;\n\t\t\t});\n\t\t}\n\n\t\tconst context = renderer.getContext(MAIN_CONTEXT_KEY);\n\t\tconst stack = useStack(context);\n\n\t\tstack.value = save;\n\t\tcontext.meta.restoring = context.meta.goingBack = false;\n\n\t\trenderer.ui.showScreen('game');\n\n\t\trender(context);\n\t};\n\n\t/**\n\t * Set's the save and restores onto it\n\t */\n\tconst set = (save: Save, ctx?: Context) => {\n\t\tconst stack = useStack(ctx || MAIN_CONTEXT_KEY);\n\n\t\tstack.value = save;\n\n\t\treturn restore(save);\n\t};\n\n\tlet interacted = 0;\n\n\t/**\n\t * Restore save or if none is passed then look for latest save, if there is no saves will create a new save\n\t */\n\tconst restore = async (save: Save | undefined) => {\n\t\tif (isEmpty(story)) {\n\t\t\tif (DEV) {\n\t\t\t\tthrow new Error('Story is empty. You should call an `enine.script` function [https://novely.pages.dev/guide/story.html]')\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!coreData.get().dataLoaded) return;\n\n\t\tlet latest = save || storageData.get().saves.at(-1);\n\n\t\t/**\n\t\t * When there is no save, make a new save\n\t\t */\n\t\tif (!latest) {\n\t\t\tlatest = klona(initial)\n\n\t\t\tstorageData.update((prev) => {\n\t\t\t\t/**\n\t\t\t\t * `latest` will be not undefined because this callback called immediately and variable is not changed\n\t\t\t\t */\n\t\t\t\tprev.saves.push(latest!);\n\n\t\t\t\treturn prev\n\t\t\t})\n\t\t}\n\n\t\tconst context = renderer.getContext(MAIN_CONTEXT_KEY);\n\t\tconst stack = useStack(context);\n\n\t\tcontext.meta.restoring = true;\n\n\t\tconst previous = stack.previous;\n\n\t\tconst [path] = stack.value = latest;\n\n\t\trenderer.ui.showScreen('game');\n\n\t\tconst { queue, skip, skipPreserve } = getActionsFromPath(story, path, false);\n\t\tconst { run, keep: { keep, characters, audio } } = createQueueProcessor(queue, {\n\t\t\tskip,\n\t\t\tskipPreserve\n\t\t});\n\n\t\tif (previous) {\n\t\t\tconst { queue: prevQueue } = getActionsFromPath(story, previous[0], false);\n\n\t\t\tfor (let i = prevQueue.length - 1; i > queue.length - 1; i--) {\n\t\t\t\tconst element = prevQueue[i];\n\n\t\t\t\t/**\n\t\t\t\t * Just in case 🤷\n\t\t\t\t */\n\t\t\t\tif (!isAction(element)) {\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\n\t\t\t\tconst [action, fn] = element;\n\n\t\t\t\t/**\n\t\t\t\t * Imagine array of actions like\n\t\t\t\t *\n\t\t\t\t * [\n\t\t\t\t *  ['dialog', ...props]\n\t\t\t\t *  ['showBackground', ...props]\n\t\t\t\t *  ['custom', function]\n\t\t\t\t * ]\n\t\t\t\t *\n\t\t\t\t * When player goes back array changes to\n\t\t\t\t *\n\t\t\t\t * [\n\t\t\t\t *  ['dialog', ...props]\n\t\t\t\t * ]\n\t\t\t\t *\n\t\t\t\t * We catch these custom actions that are gone and\n\t\t\t\t * call their clear methods so there is no side effects\n\t\t\t\t * from future in the past\n\t\t\t\t */\n\t\t\t\tif (action === 'custom') {\n\t\t\t\t\tgetCustomActionHolder(context, fn).cleanup();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (context.meta.goingBack) {\n\t\t\t/**\n\t\t\t * Context is cleared at exit, so it is dirty only when goingBack\n\t\t\t */\n\t\t\tmatch('clear', [keep, characters, audio], {\n\t\t\t\tctx: context,\n\t\t\t\tdata: latest[1]\n\t\t\t});\n\t\t}\n\n\t\tconst lastQueueItem = queue.at(-1)\n\t\tconst lastQueueItemRequiresUserAction = lastQueueItem && isBlockingAction(lastQueueItem)\n\n\t\tawait run((item) => {\n\t\t\tif (!latest) return;\n\n\t\t\t/**\n\t\t\t * Skip because last item will be ran again by `render(context)` call\n\t\t\t */\n\t\t\tif (lastQueueItem === item && lastQueueItemRequiresUserAction) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst [action, ...props] = item;\n\n\t\t\treturn match(action, props, {\n\t\t\t\tctx: context,\n\t\t\t\tdata: latest[1]\n\t\t\t});\n\t\t});\n\n\t\tif (!context.meta.goingBack) {\n\t\t\t/**\n\t\t\t * When not goingBack setting restoring to false is required to go forward\n\t\t\t * Because when restoring action do not call the resolve function which goes to next action but are controlled\n\t\t\t */\n\t\t\tcontext.meta.restoring = false;\n\t\t}\n\n\t\trender(context);\n\n\t\tcontext.meta.restoring = context.meta.goingBack = false;\n\t};\n\n\tconst refer = createReferFunction(story);\n\n\t/**\n\t * @param force Force exit\n\t */\n\tconst exit = (force = false, saving = true) => {\n\t\t/**\n\t\t * Exit only possible in main context\n\t\t */\n\t\tconst ctx = renderer.getContext(MAIN_CONTEXT_KEY);\n\n\t\tconst stack = useStack(ctx);\n\t\tconst current = stack.value;\n\n\t\tconst isSaved = () => {\n\t\t\tconst { saves } = storageData.get();\n\t\t\tconst [currentPath, currentData] = stack.value;\n\n\t\t\treturn saves.some(([path, data, [date, type]]) => type === 'manual' && times.has(date) && dequal(path, currentPath) && dequal(data, currentData))\n\t\t}\n\n\t\tif (interacted > 1 && !force && askBeforeExit && !isSaved()) {\n\t\t\trenderer.ui.showExitPrompt();\n\t\t\treturn;\n\t\t}\n\n\t\t/**\n\t\t * Imagine list of actions like\n\t\t *\n\t\t * [\n\t\t *  ['input', ...args]\n\t\t *  ['dialog', ...args]\n\t\t * ]\n\t\t *\n\t\t * When you have done with input, you will go to the dialog\n\t\t * And at that moment you exit the game\n\t\t *\n\t\t * What happens? Input was \"enmemoried\", but dialog not. So when you will open saves, you'll see input action.\n\t\t * We cannot \"enmemory\" dialog when it's just started, because goingBack is going to last enmemoried item, which will be that dialog, so impossible to go back.\n\t\t *\n\t\t * What we do is enmemory on exit.\n\t\t */\n\t\tif (interacted > 0 && saving) {\n\t\t\tsave('auto');\n\t\t}\n\n\t\tstack.clear();\n\t\tctx.clear(EMPTY_SET, EMPTY_SET, { music: EMPTY_SET, sounds: EMPTY_SET }, noop);\n\t\trenderer.ui.showScreen('mainmenu');\n\t\tctx.audio.destroy();\n\n\t\tconst [time, type] = current[2];\n\n\t\t/**\n\t\t * This is auto save and belongs to the current session\n\t\t * Player did not interacted or did it once, so this is probably not-needed save\n\t\t */\n\t\tif (type === 'auto' && interacted <= 1 && times.has(time)) {\n\t\t\tstorageData.update((prev) => {\n\t\t\t\tprev.saves = prev.saves.filter((save) => save !== current);\n\n\t\t\t\treturn prev;\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Reset interactive value\n\t\t */\n\t\tinteractivity(false);\n\t\t/**\n\t\t * Reset session times\n\t\t */\n\t\ttimes.clear();\n\t};\n\n\tconst back = async () => {\n\t\t/**\n\t\t * Back also happens in main context only\n\t\t */\n\t\tconst stack = useStack(MAIN_CONTEXT_KEY);\n\n\t\tconst valueBeforeBack = stack.value;\n\n\t\tstack.back();\n\n\t\t/**\n\t\t * There was only one item in the stack so there is no `stack.previous`, also `ctx.meta.goingBack` did not changed\n\t\t */\n\t\tif (dequal(valueBeforeBack, stack.value) && !stack.previous) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait restore(stack.value);\n\t};\n\n\tconst t = (key: BaseTranslationStrings, lang: string | $Language) => {\n\t\treturn translation[lang as $Language].internal[key];\n\t};\n\n\t/**\n\t * Execute save in context named `name`\n\t * @param save Save\n\t * @param name Context name\n\t */\n\tconst preview = async (save: Save, name: string): Promise<RendererInitPreviewReturn> => {\n\t\tif (isEmpty(story)) {\n\t\t\treturn Promise.resolve({\n\t\t\t\tassets: [],\n\t\t\t})\n\t\t}\n\n\t\tconst [path, data] = save;\n\n\t\tconst { queue } = getActionsFromPath(story, path, true);\n\t\tconst ctx = renderer.getContext(name);\n\n\t\t/**\n\t\t * Enter restoring mode in action\n\t\t */\n\t\tctx.meta.restoring = true;\n\t\tctx.meta.preview = true;\n\n\t\tconst processor = createQueueProcessor(queue, {\n\t\t\tskip: EMPTY_SET,\n\t\t});\n\n\t\tuseStack(ctx).push(klona(save));\n\n\t\tconst assets: string[] = [];\n\n\t\tawait processor.run(([action, ...props]) => {\n\t\t\tif (isAudioAction(action)) return;\n\t\t\tif (action === 'vibrate') return;\n\t\t\tif (action === 'end') return;\n\n\t\t\t// @ts-expect-error\n\t\t\thuntAssets({ characters, action, props, handle: assets.push.bind(assets) })\n\n\t\t\treturn match(action, props, {\n\t\t\t\tctx,\n\t\t\t\tdata,\n\t\t\t});\n\t\t});\n\n\t\treturn {\n\t\t\tassets,\n\t\t}\n\t}\n\n\tconst removeContext = (name: string) => {\n\t\tSTACK_MAP.delete(name);\n\t}\n\n\tconst getStateAtCtx = (context: string | Context) => {\n\t\treturn useStack(context).value[1];\n\t}\n\n\tconst getStateFunction = (context: string | Context) => {\n\t\tconst stack = useStack(context);\n\n\t\tconst state = ((value) => {\n\t\t\tconst _state = getStateAtCtx(context);\n\n\t\t\tif (!value) {\n\t\t\t\treturn _state;\n\t\t\t}\n\n\t\t\tconst prev = _state;\n\t\t\tconst val = isFunction(value) ? value(prev) : deepmerge(prev, value);\n\n\t\t\tstack.value[1] = val;\n\n\t\t\treturn undefined;\n\t\t}) as StateFunction<State>;\n\n\t\treturn state;\n\t}\n\n\tconst getLanguageDisplayName = (lang: Lang) => {\n\t\tconst language = translation[lang as $Language];\n\n\t\tif (DEV && !language) {\n\t\t\tthrow new Error(`Attempt to use unsupported language \"${language}\". Supported languages: ${languages.join(', ')}.`)\n\t\t}\n\n\t\treturn capitalize(language.nameOverride || getIntlLanguageDisplayName(lang));\n\t}\n\n\tconst clearCustomAction = (ctx: Context, fn: CustomHandler) => {\n\t\tgetCustomActionHolder(ctx, fn).cleanup();\n\t}\n\n\tconst getResourseTypeForRenderer = (url: string) => {\n\t\treturn getResourseType(request, url);\n\t}\n\n\tconst getCharacterColor = (c: keyof $Characters) => {\n\t\treturn c in characters ? characters[c].color : '#000000'\n\t}\n\n\tconst getCharacterAssets = (character: string, emotion: string) => {\n\t\treturn toArray(characters[character].emotions[emotion]).map(handleImageAsset);\n\t}\n\n\tconst renderer = createRenderer({\n\t\tmainContextKey: MAIN_CONTEXT_KEY,\n\n\t\tcharacters: getCharactersData(characters),\n\t\tcharacterAssetSizes,\n\t\tset,\n\t\trestore,\n\t\tsave,\n\t\tnewGame,\n\t\texit,\n\t\tback,\n\t\tt,\n\t\tpreview,\n\t\tremoveContext,\n\t\tgetStateFunction,\n\t\tclearCustomAction,\n\t\tlanguages,\n\t\tstorageData: storageData as unknown as Stored<StorageData<string, Data>>,\n\t\tcoreData,\n\n\t\tgetLanguageDisplayName,\n\t\tgetCharacterColor,\n\t\tgetCharacterAssets,\n\n\t\tgetResourseType: getResourseTypeForRenderer\n\t});\n\n\tconst useStack = createUseStackFunction(renderer);\n\n\t/**\n\t * Initiate\n\t */\n\tuseStack(MAIN_CONTEXT_KEY).push(initial);\n\n\tconst UIInstance = renderer.ui.start();\n\n\tconst enmemory = (ctx: Context) => {\n\t\tif (ctx.meta.restoring) return;\n\n\t\tconst stack = useStack(ctx);\n\n\t\tconst current = klona(stack.value);\n\n\t\tcurrent[2][1] = 'auto';\n\n\t\tstack.push(current);\n\n\t\tsave('auto');\n\t};\n\n\tconst next = (ctx: Context) => {\n\t\tconst stack = useStack(ctx);\n\t\tconst path = stack.value[0];\n\n\t\tnextPath(path);\n\t};\n\n\tconst matchActionOptions: MatchActionOptions = {\n\t\tgetContext: renderer.getContext,\n\t\tpush(ctx) {\n\t\t\tif (ctx.meta.restoring) return;\n\n\t\t\tnext(ctx);\n\t\t\trender(ctx);\n\t\t},\n\t\tforward(ctx) {\n\t\t\tif (!ctx.meta.preview) enmemory(ctx);\n\n\t\t\tmatchActionOptions.push(ctx);\n\n\t\t\tif (!ctx.meta.preview) interactivity(true);\n\t\t},\n\t\tonBeforeActionCall({ action, props, ctx }) {\n\t\t\tif (preloadAssets !== 'automatic') return;\n\t\t\tif (ctx.meta.preview || ctx.meta.restoring) return;\n\t\t\tif (!isBlockingAction([action, ...props] as unknown as Exclude<ValidAction, ValidAction[]>)) return;\n\n\t\t\ttry {\n\t\t\t\tconst collection = collectActionsBeforeBlockingAction({\n\t\t\t\t\tpath: nextPath(klona(useStack(ctx).value[0])),\n\t\t\t\t\trefer\n\t\t\t\t})\n\n\t\t\t\tfor (const [action, ...props] of collection) {\n\t\t\t\t\t// @ts-expect-error\n\t\t\t\t\thuntAssets({ characters, action, props, handle: enqueueAssetForPreloading })\n\t\t\t\t}\n\n\t\t\t\thandleAssetsPreloading({\n\t\t\t\t\t...renderer.misc,\n\t\t\t\t\trequest,\n\t\t\t\t\tlimiter: limitAssetsDownload,\n\t\t\t\t})\n\t\t\t} catch (cause) {\n\t\t\t\tconsole.error(cause);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst match = matchAction(matchActionOptions, {\n\t\twait({ ctx, push }, [time]) {\n\t\t\tif (ctx.meta.restoring) return;\n\n\t\t\tsetTimeout(push, isFunction(time) ? time(getStateAtCtx(ctx)) : time);\n\t\t},\n\t\tshowBackground({ ctx, push }, [background]) {\n\t\t\tif (isString(background) || isAsset(background)) {\n\t\t\t\tctx.background({\n\t\t\t\t\t'all': handleImageAsset(background)\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tctx.background(Object.fromEntries(Object.entries(background).map(([media, asset]) => [media, handleImageAsset(asset as string)])))\n\t\t\t}\n\n\t\t\tpush();\n\t\t},\n\t\tplayMusic({ ctx, push }, [source]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'music').play(true)\n\t\t\tpush();\n\t\t},\n\t\tpauseMusic({ ctx, push }, [source]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'music').pause()\n\t\t\tpush();\n\t\t},\n\t\tstopMusic({ ctx, push }, [source]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'music').stop()\n\t\t\tpush();\n\t\t},\n\t\tplaySound({ ctx, push }, [source, loop]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'sound').play(loop || false)\n\t\t\tpush();\n\t\t},\n\t\tpauseSound({ ctx, push }, [source]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'sound').pause()\n\t\t\tpush();\n\t\t},\n\t\tstopSound({ ctx, push }, [source]) {\n\t\t\tctx.audio.music(handleAudioAsset(source), 'sound').stop()\n\t\t\tpush();\n\t\t},\n\t\tvoice({ ctx, push }, [source]) {\n\t\t\tconst [lang] = storageData.get().meta;\n\n\t\t\tconst audioSource = isString(source) ? source : isAsset(source) ? source : source[lang];\n\n\t\t\t/**\n\t\t\t * We allow ignoring voice because it is okay to not have voiceover for certain languages\n\t\t\t */\n\t\t\tif (!audioSource) {\n\t\t\t\tpush();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tctx.audio.voice(handleAudioAsset(audioSource));\n\t\t\tpush();\n\t\t},\n\t\tstopVoice({ ctx, push }) {\n\t\t\tctx.audio.voiceStop();\n\t\t\tpush();\n\t\t},\n\t\tshowCharacter({ ctx, push }, [character, emotion, className, style]) {\n\t\t\temotion ??= defaultEmotions[character];\n\n\t\t\tif (DEV && !emotion) {\n\t\t\t\tthrow new Error(`Attemp to show character \"${character}\" without emotion provided.`)\n\t\t\t}\n\n\t\t\tif (!emotion) return;\n\n\t\t\tif (DEV && !characters[character].emotions[emotion]) {\n\t\t\t\tthrow new Error(`Attempt to show character \"${character}\" with unknown emotion \"${emotion}\"`)\n\t\t\t}\n\n\t\t\tconst handle = ctx.character(character);\n\n\t\t\thandle.append(className, style, ctx.meta.restoring);\n\t\t\thandle.emotion(emotion, true);\n\n\t\t\tpush();\n\t\t},\n\t\thideCharacter({ ctx, push }, [character, className, style, duration]) {\n\t\t\tctx.character(character).remove(className, style, duration, ctx.meta.restoring).then(push)\n\t\t},\n\t\tdialog({ ctx, data, forward }, [character, content, emotion]) {\n\t\t\t/**\n\t\t\t * Person name\n\t\t\t */\n\t\t\tconst name = (() => {\n\t\t\t\tconst c = character;\n\t\t\t\tconst cs = characters;\n\t\t\t\tconst [lang] = storageData.get().meta;\n\n\t\t\t\tif (c && c in cs) {\n\t\t\t\t\tconst block = cs[c].name;\n\n\t\t\t\t\tif (typeof block === 'string') {\n\t\t\t\t\t\treturn block;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (lang in block) {\n\t\t\t\t\t\treturn block[lang as $Language];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn c || '';\n\t\t\t})();\n\n\t\t\tctx.clearBlockingActions('dialog');\n\n\t\t\tctx.dialog(\n\t\t\t\ttemplateReplace(content, data),\n\t\t\t\ttemplateReplace(name, data),\n\t\t\t\tcharacter,\n\t\t\t\temotion,\n\t\t\t\tforward\n\t\t\t);\n\t\t},\n\t\tsay({ ctx, data }, [character, content]) {\n\t\t\tif (DEV && !characters[character]) {\n\t\t\t\tthrow new Error(`Attempt to call Say action with unknown character \"${character}\"`);\n\t\t\t}\n\n\t\t\tmatch('dialog', [character, content], {\n\t\t\t\tctx,\n\t\t\t\tdata\n\t\t\t});\n\t\t},\n\t\tfunction({ ctx, push }, [fn]) {\n\t\t\tconst { restoring, goingBack, preview } = ctx.meta;\n\n\t\t\tconst result = fn({\n\t\t\t\tlang: storageData.get().meta[0],\n\t\t\t\tgoingBack,\n\t\t\t\trestoring,\n\t\t\t\tpreview,\n\t\t\t\tstate: getStateFunction(ctx)\n\t\t\t});\n\n\t\t\tif (!ctx.meta.restoring) {\n\t\t\t\tresult ? result.then(push) : push();\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tchoice({ ctx, data }, [question, ...choices]) {\n\t\t\tconst isWithoutQuestion = Array.isArray(question);\n\n\t\t\tif (isWithoutQuestion) {\n\t\t\t\t/**\n\t\t\t\t * Первый элемент может быть как строкой, так и элементов выбора\n\t\t\t\t */\n\t\t\t\tchoices.unshift(question as unknown as [TextContent<$Language, State>, ValidAction[], () => boolean]);\n\t\t\t\t/**\n\t\t\t\t * Значит, текст не требуется\n\t\t\t\t */\n\t\t\t\tquestion = '';\n\t\t\t}\n\n\t\t\tconst transformedChoices = choices.map(([content, action, visible]) => {\n\t\t\t\tconst shown = !visible || visible({\n\t\t\t\t\tlang: storageData.get().meta[0],\n\t\t\t\t\tstate: getStateAtCtx(ctx)\n\t\t\t\t});\n\n\t\t\t\tif (DEV && action.length === 0 && !shown) {\n\t\t\t\t\tconsole.warn(`Choice children should not be empty, either add content there or make item not selectable`)\n\t\t\t\t}\n\n\t\t\t\treturn [templateReplace(content, data),  shown] as [string, boolean];\n\t\t\t});\n\n\t\t\tif (DEV && transformedChoices.length === 0) {\n\t\t\t\tthrow new Error(`Running choice without variants to choose from, look at how to use Choice action properly [https://novely.pages.dev/guide/actions/choice#usage]`)\n\t\t\t}\n\n\t\t\tctx.clearBlockingActions('choice');\n\n\t\t\tctx.choices(templateReplace(question, data), transformedChoices, (selected) => {\n\t\t\t\tif (!ctx.meta.preview) {\n\t\t\t\t\tenmemory(ctx);\n\t\t\t\t}\n\n\t\t\t\tconst stack = useStack(ctx);\n\n\t\t\t\t/**\n\t\t\t\t * If there is a question, then `index` should be shifted by `1`\n\t\t\t\t */\n\t\t\t\tconst offset = isWithoutQuestion ? 0 : 1;\n\n\t\t\t\tif (DEV && !transformedChoices[selected]) {\n\t\t\t\t\tthrow new Error('Choice children is empty, either add content there or make item not selectable')\n\t\t\t\t}\n\n\t\t\t\t// todo: calculate offset dynamically\n\t\t\t\t// maybe even use object\n\t\t\t\t// action.choice({\n\t\t\t\t//   label: { ru: 'фцв', en: 'awd' },\n\t\t\t\t//   choices: [\n\t\t\t\t//     { label: 'Something', children: [], active: (state) => state.something > 15 }\n\t\t\t  //   ]\n\t\t\t  // })\n\n\t\t\t\tstack.value[0].push(['choice', selected + offset], [null, 0]);\n\t\t\t\trender(ctx);\n\t\t\t\tinteractivity(true);\n\t\t\t});\n\t\t},\n\t\tjump({ ctx, data }, [scene]) {\n\t\t\tif (DEV && !story[scene]) {\n\t\t\t\tthrow new Error(`Attempt to jump to unknown scene \"${scene}\"`)\n\t\t\t}\n\n\t\t\tif (DEV && story[scene].length === 0) {\n\t\t\t\tthrow new Error(`Attempt to jump to empty scene \"${scene}\"`)\n\t\t\t}\n\n\t\t\tconst stack = useStack(ctx);\n\n\t\t\t/**\n\t\t\t * `-1` index is used here because `clear` will run `next` that will increase index to `0`\n\t\t\t */\n\t\t\tstack.value[0] = [\n\t\t\t\t['jump', scene],\n\t\t\t\t[null, -1],\n\t\t\t];\n\n\t\t\tmatch('clear', [], {\n\t\t\t\tctx,\n\t\t\t\tdata,\n\t\t\t});\n\t\t},\n\t\tclear({ ctx, push }, [keep, characters, audio]) {\n\t\t\t/**\n\t\t\t * Remove vibration\n\t\t\t */\n\t\t\tctx.vibrate(0);\n\n\t\t\t/**\n\t\t\t * Call the actual `clear`\n\t\t\t */\n\t\t\tctx.clear(\n\t\t\t\tkeep || EMPTY_SET,\n\t\t\t\tcharacters || EMPTY_SET,\n\t\t\t\taudio || { music: EMPTY_SET, sounds: EMPTY_SET },\n\t\t\t\tpush\n\t\t\t);\n\t\t},\n\t\tcondition({ ctx }, [condition, variants]) {\n\t\t\tif (DEV && Object.values(variants).length === 0) {\n\t\t\t\tthrow new Error(`Attempt to use Condition action with empty variants object`)\n\t\t\t}\n\n\t\t\tif (!ctx.meta.restoring) {\n\t\t\t\tconst val = String(condition(getStateAtCtx(ctx)));\n\n\t\t\t\tif (DEV && !variants[val]) {\n\t\t\t\t\tthrow new Error(`Attempt to go to unknown variant \"${val}\"`)\n\t\t\t\t}\n\n\t\t\t\tif (DEV && variants[val].length === 0) {\n\t\t\t\t\tthrow new Error(`Attempt to go to empty variant \"${val}\"`)\n\t\t\t\t}\n\n\t\t\t\tconst stack = useStack(MAIN_CONTEXT_KEY);\n\n\t\t\t\tstack.value[0].push(['condition', val], [null, 0]);\n\n\t\t\t\trender(ctx);\n\t\t\t}\n\t\t},\n\t\tend({ ctx }) {\n\t\t\tif (ctx.meta.preview) return;\n\n\t\t\texit(true, false);\n\t\t},\n\t\tinput({ ctx, data, forward }, [question, onInput, setup]) {\n\t\t\tctx.clearBlockingActions('input');\n\n\t\t\tctx.input(\n\t\t\t\ttemplateReplace(question, data),\n\t\t\t\tonInput,\n\t\t\t\tsetup || noop,\n\t\t\t\tforward\n\t\t\t);\n\t\t},\n\t\tcustom({ ctx, push }, [fn]) {\n\t\t\tif (fn.requireUserAction) {\n\t\t\t\tctx.clearBlockingActions(undefined)\n\t\t\t}\n\n\t\t\tconst state = getStateFunction(ctx);\n\t\t\tconst lang = storageData.get().meta[0]\n\n\t\t\tconst result = handleCustomAction(ctx, fn, {\n\t\t\t\t...ctx.custom(fn),\n\t\t\t\tstate,\n\t\t\t\tlang,\n\t\t\t})\n\n\t\t\tconst next = () => {\n\t\t\t\tif (fn.requireUserAction && !ctx.meta.preview) {\n\t\t\t\t\tenmemory(ctx);\n\t\t\t\t\tinteractivity(true);\n\t\t\t\t}\n\n\t\t\t\tpush();\n\t\t\t}\n\n\t\t\tif (!ctx.meta.restoring) {\n\t\t\t\tif (isPromise(result)) {\n\t\t\t\t\tresult.then(next)\n\t\t\t\t} else {\n\t\t\t\t\tnext()\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t},\n\t\tvibrate({ ctx, push }, pattern) {\n\t\t\tctx.vibrate(pattern);\n\t\t\tpush();\n\t\t},\n\t\tnext({ push }) {\n\t\t\tpush();\n\t\t},\n\t\tanimateCharacter({ ctx, push }, [character, className]) {\n\t\t\tconst classes = className.split(' ');\n\n\t\t\tif (DEV && classes.length === 0) {\n\t\t\t\tthrow new Error('Attempt to use AnimateCharacter without classes. Classes should be provided [https://novely.pages.dev/guide/actions/animateCharacter.html]')\n\t\t\t}\n\n\t\t\tif (ctx.meta.preview) return;\n\n\t\t\tctx.character(character).animate(classes);\n\n\t\t\tpush();\n\t\t},\n\t\ttext({ ctx, data, forward }, text) {\n\t\t\tconst string = text.map((content) => templateReplace(content, data)).join(' ');\n\n\t\t\tif (DEV && string.length === 0) {\n\t\t\t\tthrow new Error(`Action Text was called with empty string or array`)\n\t\t\t}\n\n\t\t\tctx.clearBlockingActions('text');\n\n\t\t\tctx.text(string, forward);\n\t\t},\n\t\texit({ ctx, data }) {\n\t\t\tif (ctx.meta.restoring) return;\n\n\t\t\tconst { exitImpossible } = exitPath({\n\t\t\t\tpath: useStack(ctx).value[0],\n\t\t\t\trefer: refer,\n\t\t\t\tonExitImpossible: () => {\n\t\t\t\t\tmatch('end', [], {\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\tdata,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (exitImpossible) {\n\t\t\t\tctx.clearBlockingActions(undefined);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trender(ctx);\n\t\t},\n\t\tpreload({ ctx, push }, [source]) {\n\t\t\tif (DEV && preloadAssets !== 'lazy') {\n\t\t\t\tconsole.error(`You do not need a preload action becase \"preloadAssets\" strategy was set to \"${preloadAssets}\"`)\n\t\t\t}\n\n\t\t\tif (!ctx.meta.goingBack && !ctx.meta.restoring && !PRELOADED_ASSETS.has(source)) {\n\t\t\t\t/**\n\t\t\t\t * Add to preloaded before it was loaded to prevent save image downloading multiple times\n\t\t\t\t */\n\t\t\t\tPRELOADED_ASSETS.add(renderer.misc.preloadImage(source));\n\t\t\t}\n\n\t\t\tpush();\n\t\t},\n\t\tblock({ ctx }, [scene]) {\n\t\t\tif (DEV && !story[scene]) {\n\t\t\t\tthrow new Error(`Attempt to call Block action with unknown scene \"${scene}\"`)\n\t\t\t}\n\n\t\t\tif (DEV && story[scene].length === 0) {\n\t\t\t\tthrow new Error(`Attempt to call Block action with empty scene \"${scene}\"`)\n\t\t\t}\n\n\t\t\tif (!ctx.meta.restoring) {\n\t\t\t\tconst stack = useStack(ctx);\n\n\t\t\t\tstack.value[0].push(['block', scene], [null, 0]);\n\n\t\t\t\trender(ctx);\n\t\t\t}\n\t\t},\n\t});\n\n\tconst render = (ctx: Context) => {\n\t\tconst stack = useStack(ctx);\n\t\tconst referred = refer(stack.value[0]);\n\n\t\tif (isAction(referred)) {\n\t\t\tconst [action, ...props] = referred;\n\n\t\t\tmatch(action, props, {\n\t\t\t\tctx,\n\t\t\t\tdata: stack.value[1]\n\t\t\t});\n\t\t} else if (Object.values(story).some((branch) => branch === referred)) {\n\t\t\t/**\n\t\t\t * Developer might not write the end action on their own, so we will catch situation when there are no other options than end the game.\n\t\t\t *\n\t\t\t * There are three options right now.\n\t\t\t * - We've got to the action — gonna render it\n\t\t\t * - We've got `undefined`. This means we are tried to go forward, but story array ended already, so we are gonna run exit\n\t\t\t * - We've got branch of story object. This means we exitied from where it's possible to exit and now we can only end the game\n\t\t\t */\n\t\t\tmatch('end', [], {\n\t\t\t\tctx,\n\t\t\t\tdata: stack.value[1]\n\t\t\t})\n\t\t} else {\n\t\t\tmatch('exit', [], {\n\t\t\t\tctx,\n\t\t\t\tdata: stack.value[1]\n\t\t\t});\n\t\t}\n\t};\n\n\tconst interactivity = (value = false) => {\n\t\tinteracted = value ? interacted + 1 : 0;\n\t};\n\n\t/**\n\t * Basically replaces content inside of {{braces}}.\n\t */\n\tconst templateReplace = (content: TextContent<$Language, Data>, values?: Data) => {\n\t\tconst { data, meta: [lang] } = storageData.get();\n\n\t\t// Object to take values from\n\t\tconst obj = values || data;\n\n\t\t// String\n\t\tconst str = flattenAllowedContent(\n\t\t\t!isFunction(content) && !isString(content) ? content[lang] : content,\n\t\t\tobj\n\t\t);\n\n\t\tconst t = translation[lang];\n\t\tconst pluralRules = (t.plural || t.actions) && new Intl.PluralRules(t.tag || lang);\n\n\t\treturn replaceTranslation(\n\t\t\tstr,\n\t\t\tobj,\n\t\t\tt.plural,\n\t\t\tt.actions,\n\t\t\tpluralRules\n\t\t);\n\t};\n\n\tconst data = ((value) => {\n\t\tconst _data = storageData.get().data;\n\n\t\tif (!value) return _data;\n\n\t\tconst val = isFunction(value) ? value(_data) : deepmerge(_data, value as $Data);\n\n\t\tstorageData.update((prev) => {\n\t\t\tprev.data = val;\n\n\t\t\treturn prev;\n\t\t})\n\n\t\treturn undefined;\n\t}) as StateFunction<$Data>;\n\n\tconst typeEssentials: TypeEssentials<$Language, $State, $Data, $Characters> = {\n\t\tl: null,\n\t\ts: null,\n\t\td: null,\n\t\tc: null\n\t}\n\n\tconst getCurrentStorageData = () => {\n\t\treturn coreData.get().dataLoaded ? klona(storageData.get()) : null;\n\t}\n\n\tconst setStorageData = (data: StorageData<$Language, $Data>) => {\n\t\tif (destroyed) {\n\t\t\tif (DEV) {\n\t\t\t\tthrow new Error(`function \\`setStorageData\\` was called after novely instance was destroyed. Data is not updater nor synced after destroy.`)\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tstorageData.set(data);\n\t}\n\n\treturn {\n\t\t/**\n\t\t * Function to set game script\n\t\t *\n\t\t * @example\n\t\t * ```ts\n\t\t * engine.script({\n\t\t *   start: [\n\t\t *     action.function(() => {})\n\t\t *   ]\n\t\t * })\n\t\t * ```\n\t\t */\n\t\tscript,\n\t\t/**\n\t\t * Get actions\n\t\t *\n\t\t * @example\n\t\t * ```ts\n\t\t * engine.script({\n\t\t *   start: [\n\t\t *     action.function(() => {})\n\t\t *   ]\n\t\t * })\n\t\t * ```\n\t\t */\n\t\taction,\n\t\t/**\n\t\t * @deprecated Will be removed BUT replaced with state passed into actions as a parameter\n\t\t */\n\t\tstate: getStateFunction(MAIN_CONTEXT_KEY),\n\t\t/**\n\t\t * Store data between games\n\t\t *\n\t\t * @example\n\t\t * ```ts\n\t\t * engine.script({\n\t\t *   start: [\n\t\t *     action.function(() => {\n\t\t *       // Paid content should be purchased only once\n\t\t *       // So it will be available in any save\n\t\t *       data({ paid_content_purchased: true })\n\t\t *     })\n\t\t *   ]\n\t\t * })\n\t\t * ```\n\t\t */\n\t\tdata,\n\t\t/**\n\t\t * Used in combination with type utilities\n\t\t *\n\t\t * @example\n\t\t * ```ts\n\t\t * import type { ConditionParams, StateFunction } from '@novely/core';\n     *\n\t\t * const conditionCheck = (state: StateFunction<ConditionParams<typeof engine.typeEssintials>>) => {\n\t\t *   return state.age >= 18;\n\t\t * }\n\t\t * ```\n\t\t */\n\t\ttypeEssentials,\n\t\t/**\n\t\t * Replaces content inside {{braces}} with using global data\n\t\t * @example\n\t\t * ```ts\n\t\t * data({ name: 'Alexei' })\n\t\t *\n\t\t * templateReplace('{{name}} is our hero')\n\t\t * templateReplace({\n\t\t *  en: (data) => 'Hello, ' + data.name\n\t\t * })\n\t\t * ```\n\t\t */\n\t\ttemplateReplace(content: TextContent<$Language, $Data>) {\n\t\t\treturn templateReplace(content as TextContent<$Language, Data>)\n\t\t},\n\t\t/**\n\t\t * Cancel data loading, hide UI, ignore page change events\n\t\t * Data updates still will work in case Novely already was loaded\n\t\t */\n\t\tdestroy() {\n\t\t\tdataLoaded.cancel();\n\n\t\t\tUIInstance.unmount();\n\n\t\t\tunsubscribeFromBrowserVisibilityChange();\n\n\t\t\tdestroyed = true;\n\t\t},\n\t\t/**\n\t\t * Funtion to get current storage data\n\t\t *\n\t\t * @example\n\t\t * ```ts\n\t\t * const currentStorageData = engine.getCurrentStorageData();\n\t\t * ```\n\t\t */\n\t\tgetCurrentStorageData,\n\t\t/**\n\t\t * Function to set storage data. Using this function is not recommended.\n\t\t *\n\t\t * @deprecated\n\t\t * @example\n\t\t * ```ts\n\t\t * const currentStorageData = engine.getCurrentStorageData();\n\t\t *\n\t\t * if (currentStorageData) {\n\t\t *   // update music volume\n\t\t *   currentStorageData.meta[2] = 1;\n\t\t *\n\t\t *   setStorageData(currentStorageData)\n\t\t * }\n\t\t * ```\n\t\t */\n\t\tsetStorageData\n\t};\n};\n\nexport { novely };\n","import type { ValidAction } from \"./action\";\nimport type { Assign } from \"./types\";\n\n/**\n * Extens core action with custom actions\n * @param base Actions object you will extend, `engine.action`\n * @param extension Actions object you will extend with\n * @example\n * ```ts\n * const action = extendAction(engine.action, {\n *   particles: (options: Parameters<typeof particles>[0]) => {\n *     return ['custom', particles(options)]\n *   }\n * })\n * ```\n */\nconst extendAction = <Part0 extends Record<string, (...args: any[]) => ValidAction> , Part1 extends Record<string, (...args: any[]) => ValidAction>>(base: Part0, extension: Part1): Readonly<Assign<Part0, Part1>> => {\n  return new Proxy({} as Readonly<Assign<Part0, Part1>>, {\n    get(_, key, receiver) {\n      return Reflect.get(key in extension ? extension : base, key, receiver)\n    },\n  })\n}\n\nexport { extendAction }\n","const RU = {\n\tNewGame: 'Новая игра',\n\tHomeScreen: 'Главный экран',\n\tToTheGame: 'К игре',\n\tLanguage: 'Язык',\n\tNoSaves: 'Сохранений нет',\n\tLoadSave: 'Загрузить',\n\tSaves: 'Сохранения',\n\tSettings: 'Настройки',\n\tSumbit: 'Подтвердить',\n\tGoBack: 'Назад',\n\tDoSave: 'Сохранение',\n\tAuto: 'Авто',\n\tStop: 'Стоп',\n\tExit: 'Выход',\n\tAutomatic: 'Автоматическое',\n\tManual: 'Ручное',\n\tRemove: 'Удалить',\n\tLoadASaveFrom: 'Загрузить сохранение от',\n\tDeleteASaveFrom: 'Удалить сохранение от',\n\tTextSpeed: 'Скорость текста',\n\tTextSpeedSlow: 'Медленная',\n\tTextSpeedMedium: 'Средняя',\n\tTextSpeedFast: 'Быстрая',\n\tTextSpeedAuto: 'Автоматическая',\n\tCompleteText: 'Завершить текст',\n\tGoForward: 'Перейти вперёд',\n\tExitDialogWarning: 'Вы уверены, что хотите выйти? Прогресс будет сохранён.',\n\tExitDialogExit: 'Выйти',\n\tExitDialogBack: 'Вернуться в игру',\n\tOpenMenu: 'Открыть меню',\n\tCloseMenu: 'Закрыть меню',\n\tMusicVolume: 'Громкость музыки',\n\tSoundVolume: 'Громкость звуков',\n\tVoiceVolume: 'Громкость речи'\n};\n\ntype BaseTranslationStrings = keyof typeof RU;\n\nconst EN: Record<BaseTranslationStrings, string> = {\n\tNewGame: 'New Game',\n\tHomeScreen: 'Home Screen',\n\tToTheGame: 'To the Game',\n\tLanguage: 'Language',\n\tNoSaves: 'No saves',\n\tLoadSave: 'Load',\n\tSaves: 'Saves',\n\tSettings: 'Settings',\n\tSumbit: 'Submit',\n\tGoBack: 'Go back',\n\tDoSave: 'Save',\n\tAuto: 'Auto',\n\tStop: 'Stop',\n\tExit: 'Exit',\n\tAutomatic: 'Automatic',\n\tManual: 'Manual',\n\tRemove: 'Remove',\n\tLoadASaveFrom: 'Load a save from',\n\tDeleteASaveFrom: 'Delete a save from',\n\tTextSpeed: 'Text Speed',\n\tTextSpeedSlow: 'Slow',\n\tTextSpeedMedium: 'Medium',\n\tTextSpeedFast: 'Fast',\n\tTextSpeedAuto: 'Auto',\n\tCompleteText: 'Complete text',\n\tGoForward: 'Go forward',\n\tExitDialogWarning: 'Are you sure you want to exit? Progress will be saved.',\n\tExitDialogExit: 'Exit',\n\tExitDialogBack: 'Return to game',\n\tOpenMenu: 'Open menu',\n\tCloseMenu: 'Close menu',\n\tMusicVolume: 'Music volume',\n\tSoundVolume: 'Sound volume',\n\tVoiceVolume: 'Voice volume'\n};\n\n/**\n * Translated automatically\n */\nconst KK: Record<BaseTranslationStrings, string> = {\n\tNewGame: 'Жаңа ойын',\n\tHomeScreen: 'Негізгі экран',\n\tToTheGame: 'Ойынға',\n\tLanguage: 'Тіл',\n\tNoSaves: 'Сақтау жоқ',\n\tLoadSave: 'Жүктеу',\n\tSaves: 'Сақтау',\n\tSettings: 'Параметрлер',\n\tSumbit: 'Растау',\n\tGoBack: 'Артқа',\n\tDoSave: 'Сақтау',\n\tAuto: 'Авто',\n\tStop: 'Тоқта',\n\tExit: 'Шығу',\n\tAutomatic: 'Автоматты',\n\tManual: 'Қолмен',\n\tRemove: 'Жою',\n\tLoadASaveFrom: 'Сақтауды жүктеу',\n\tDeleteASaveFrom: 'Сақтауды жою',\n\tTextSpeed: 'Мәтін Жылдамдығы',\n\tTextSpeedSlow: 'Баяу',\n\tTextSpeedMedium: 'Орташа',\n\tTextSpeedFast: 'Жылдам',\n\tTextSpeedAuto: 'Автоматты',\n\tCompleteText: 'Мәтінді аяқтау',\n\tGoForward: 'Алға жылжу',\n\tExitDialogWarning: 'Сіз шыққыңыз келетініне сенімдісіз бе? Прогресс сақталады',\n\tExitDialogExit: 'Шығу',\n\tExitDialogBack: 'Ойынға оралу',\n\tOpenMenu: 'Мәзірді ашыңыз',\n\tCloseMenu: 'Мәзірді жабу',\n\tMusicVolume: 'Музыканың көлемі',\n\tSoundVolume: 'Дыбыстардың көлемі',\n\tVoiceVolume: 'Сөйлеу көлемі'\n};\n\n/**\n * Translated automatically\n */\nconst JP: Record<BaseTranslationStrings, string> = {\n\tNewGame: '「新しいゲーム」',\n\tHomeScreen: 'ホーム画面',\n\tToTheGame: '「ゲームに戻る」',\n\tLanguage: '言語',\n\tNoSaves: 'ノーセーブ',\n\tLoadSave: 'ダウンロード',\n\tSaves: '保存',\n\tSettings: '設定',\n\tSumbit: '確認',\n\tGoBack: '「戻る」',\n\tDoSave: '保存',\n\tAuto: 'オート',\n\tStop: '止まれ',\n\tExit: '出口',\n\tAutomatic: '自動',\n\tManual: 'マニュアル',\n\tRemove: '削除',\n\tLoadASaveFrom: 'ロードセーブから',\n\tDeleteASaveFrom: 'から保存を削除',\n\tTextSpeed: 'テキストスピード',\n\tTextSpeedSlow: '「遅い」',\n\tTextSpeedMedium: 'ミディアム',\n\tTextSpeedFast: '「速い」',\n\tTextSpeedAuto: '自動',\n\tCompleteText: 'テキストを完成させる',\n\tGoForward: '先に行く',\n\tExitDialogWarning: '本当に終了しますか？進行状況は保存されます',\n\tExitDialogExit: '終了',\n\tExitDialogBack: 'ゲームに戻る',\n\tOpenMenu: 'メニューを開く',\n\tCloseMenu: 'メニューを閉じる',\n\tMusicVolume: '音楽のボリューム',\n\tSoundVolume: '音量',\n\tVoiceVolume: 'スピーチの量'\n};\n\nexport { RU, EN, KK, JP };\nexport type { BaseTranslationStrings };\n"],"mappings":"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","names":["Cache","keys","isPromise","str","supportsMap","supportsMap","str","audio","next","item","asset","str","asset","getLanguage","action","data","replace","save","characters","audio","type","props","asset","preview","next","str","t"]}