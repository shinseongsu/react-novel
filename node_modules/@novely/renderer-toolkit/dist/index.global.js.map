{"version":3,"sources":["../src/index.ts","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/task/index.js","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/clean-stores/index.js","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/atom/index.js","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/lifecycle/index.js","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/computed/index.js","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/deep-map/path.js","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/deep-map/index.js","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/keep-mount/index.js","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/listen-keys/index.js","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/map/index.js","../../../node_modules/.pnpm/nanostores@0.11.2/node_modules/nanostores/map-creator/index.js","../../../node_modules/.pnpm/dequal@2.0.3/node_modules/dequal/dist/index.mjs","../src/atoms/memo.ts","../src/atoms/deep-atom.ts","../src/state/context-state.ts","../src/state/renderer-state.ts","../src/utils/noop.ts","../src/utils/findLast.ts","../src/utils/escape-html.ts","../src/renderer/start.ts","../../../node_modules/.pnpm/yocto-queue@1.1.1/node_modules/yocto-queue/index.js","../../../node_modules/.pnpm/p-limit@6.1.0/node_modules/p-limit/index.js","../../../node_modules/.pnpm/simple-web-audio@0.7.0_postcss@8.4.32/node_modules/simple-web-audio/src/wait_for_interaction.ts","../../../node_modules/.pnpm/simple-web-audio@0.7.0_postcss@8.4.32/node_modules/simple-web-audio/src/browser-events.ts","../../../node_modules/.pnpm/simple-web-audio@0.7.0_postcss@8.4.32/node_modules/simple-web-audio/src/queue.ts","../../../node_modules/.pnpm/simple-web-audio@0.7.0_postcss@8.4.32/node_modules/simple-web-audio/src/memo.ts","../../../node_modules/.pnpm/simple-web-audio@0.7.0_postcss@8.4.32/node_modules/simple-web-audio/src/audio.ts","../src/audio/audio.ts","../src/shared/create-shared.ts","../src/context/create-get-context.ts","../src/root/root-setter.ts","../src/context/vibrate.ts","../src/context/background.ts","../src/context/actions.ts"],"sourcesContent":["export * from 'nanostores'\nexport type * from 'nanostores'\n\nexport { memo } from './atoms/memo'\n\nexport { deepAtom } from './atoms/deep-atom'\nexport type { DeepAtom } from './atoms/deep-atom'\n\nexport { createContextStateRoot } from './state/context-state'\nexport type { ContextStateStore, ContextState, ContextStateCharacter, ContextStateCustomHandler } from './state/context-state'\n\nexport { createRendererState } from './state/renderer-state'\nexport type { RendererState, RendererStateStore } from './state/renderer-state'\n\nexport { noop } from './utils'\n\nexport { createStartFunction } from './renderer/start'\nexport type { StartFunctionMountFn, StartFunctionUnMountFn } from './renderer/start'\n\nexport { createAudio, createAudioMisc } from './audio/audio'\nexport type { AudioStore } from './audio/types'\n\nexport { createShared } from './shared/create-shared'\n\nexport { createGetContext } from './context/create-get-context'\n\nexport { createRootSetter } from './root/root-setter'\n\nexport {\n  handleBackgroundAction,\n  handleDialogAction,\n  handleChoiceAction,\n  handleClearAction,\n  handleCustomAction,\n  handleTextAction,\n  handleInputAction,\n  handleVibrateAction,\n  handleClearBlockingActions\n} from './context/actions'\n","let tasks = 0\nlet resolves = []\n\nexport function startTask() {\n  tasks += 1\n  return () => {\n    tasks -= 1\n    if (tasks === 0) {\n      let prevResolves = resolves\n      resolves = []\n      for (let i of prevResolves) i()\n    }\n  }\n}\n\nexport function task(cb) {\n  let endTask = startTask()\n  let promise = cb().finally(endTask)\n  promise.t = true\n  return promise\n}\n\nexport function allTasks() {\n  if (tasks === 0) {\n    return Promise.resolve()\n  } else {\n    return new Promise(resolve => {\n      resolves.push(resolve)\n    })\n  }\n}\n\nexport function cleanTasks() {\n  tasks = 0\n}\n","import { cleanTasks } from '../task/index.js'\n\nexport let clean = Symbol('clean')\n\nexport let cleanStores = (...stores) => {\n  if (process.env.NODE_ENV === 'production') {\n    throw new Error(\n      'cleanStores() can be used only during development or tests'\n    )\n  }\n  cleanTasks()\n  for (let $store of stores) {\n    if ($store) {\n      if ($store.mocked) delete $store.mocked\n      if ($store[clean]) $store[clean]()\n    }\n  }\n}\n","import { clean } from '../clean-stores/index.js'\n\nlet listenerQueue = []\nlet lqIndex = 0\nconst QUEUE_ITEMS_PER_LISTENER = 4\nexport let epoch = 0\n\nexport let atom = (initialValue) => {\n  let listeners = []\n  let $atom = {\n    get() {\n      if (!$atom.lc) {\n        $atom.listen(() => {})()\n      }\n      return $atom.value\n    },\n    lc: 0,\n    listen(listener) {\n      $atom.lc = listeners.push(listener)\n\n      return () => {\n        for (let i = lqIndex + QUEUE_ITEMS_PER_LISTENER; i < listenerQueue.length;) {\n          if (listenerQueue[i] === listener) {\n            listenerQueue.splice(i, QUEUE_ITEMS_PER_LISTENER)\n          } else {\n            i += QUEUE_ITEMS_PER_LISTENER\n          }\n        }\n\n        let index = listeners.indexOf(listener)\n        if (~index) {\n          listeners.splice(index, 1)\n          if (!--$atom.lc) $atom.off()\n        }\n      }\n    },\n    notify(oldValue, changedKey) {\n      epoch++\n      let runListenerQueue = !listenerQueue.length\n      for (let listener of listeners) {\n        listenerQueue.push(\n          listener,\n          $atom.value,\n          oldValue,\n          changedKey\n        )\n      }\n\n      if (runListenerQueue) {\n        for (lqIndex = 0; lqIndex < listenerQueue.length; lqIndex += QUEUE_ITEMS_PER_LISTENER) {\n            listenerQueue[lqIndex](\n              listenerQueue[lqIndex + 1],\n              listenerQueue[lqIndex + 2],\n              listenerQueue[lqIndex + 3]\n            )\n        }\n        listenerQueue.length = 0\n      }\n    },\n    /* It will be called on last listener unsubscribing.\n       We will redefine it in onMount and onStop. */\n    off() {},\n    set(newValue) {\n      let oldValue = $atom.value\n      if (oldValue !== newValue) {\n        $atom.value = newValue\n        $atom.notify(oldValue)\n      }\n    },\n    subscribe(listener) {\n      let unbind = $atom.listen(listener)\n      listener($atom.value)\n      return unbind\n    },\n    value: initialValue\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    $atom[clean] = () => {\n      listeners = []\n      $atom.lc = 0\n      $atom.off()\n    }\n  }\n\n  return $atom\n}\n","import { clean } from '../clean-stores/index.js'\n\nconst START = 0\nconst STOP = 1\nconst SET = 2\nconst NOTIFY = 3\nconst MOUNT = 5\nconst UNMOUNT = 6\nconst REVERT_MUTATION = 10\n\nexport let on = (object, listener, eventKey, mutateStore) => {\n  object.events = object.events || {}\n  if (!object.events[eventKey + REVERT_MUTATION]) {\n    object.events[eventKey + REVERT_MUTATION] = mutateStore(eventProps => {\n      // eslint-disable-next-line no-sequences\n      object.events[eventKey].reduceRight((event, l) => (l(event), event), {\n        shared: {},\n        ...eventProps\n      })\n    })\n  }\n  object.events[eventKey] = object.events[eventKey] || []\n  object.events[eventKey].push(listener)\n  return () => {\n    let currentListeners = object.events[eventKey]\n    let index = currentListeners.indexOf(listener)\n    currentListeners.splice(index, 1)\n    if (!currentListeners.length) {\n      delete object.events[eventKey]\n      object.events[eventKey + REVERT_MUTATION]()\n      delete object.events[eventKey + REVERT_MUTATION]\n    }\n  }\n}\n\nexport let onStart = ($store, listener) =>\n  on($store, listener, START, runListeners => {\n    let originListen = $store.listen\n    $store.listen = arg => {\n      if (!$store.lc && !$store.starting) {\n        $store.starting = true\n        runListeners()\n        delete $store.starting\n      }\n      return originListen(arg)\n    }\n    return () => {\n      $store.listen = originListen\n    }\n  })\n\nexport let onStop = ($store, listener) =>\n  on($store, listener, STOP, runListeners => {\n    let originOff = $store.off\n    $store.off = () => {\n      runListeners()\n      originOff()\n    }\n    return () => {\n      $store.off = originOff\n    }\n  })\n\nexport let onSet = ($store, listener) =>\n  on($store, listener, SET, runListeners => {\n    let originSet = $store.set\n    let originSetKey = $store.setKey\n    if ($store.setKey) {\n      $store.setKey = (changed, changedValue) => {\n        let isAborted\n        let abort = () => {\n          isAborted = true\n        }\n\n        runListeners({\n          abort,\n          changed,\n          newValue: { ...$store.value, [changed]: changedValue }\n        })\n        if (!isAborted) return originSetKey(changed, changedValue)\n      }\n    }\n    $store.set = newValue => {\n      let isAborted\n      let abort = () => {\n        isAborted = true\n      }\n\n      runListeners({ abort, newValue })\n      if (!isAborted) return originSet(newValue)\n    }\n    return () => {\n      $store.set = originSet\n      $store.setKey = originSetKey\n    }\n  })\n\nexport let onNotify = ($store, listener) =>\n  on($store, listener, NOTIFY, runListeners => {\n    let originNotify = $store.notify\n    $store.notify = (oldValue, changed) => {\n      let isAborted\n      let abort = () => {\n        isAborted = true\n      }\n\n      runListeners({ abort, changed, oldValue })\n      if (!isAborted) return originNotify(oldValue, changed)\n    }\n    return () => {\n      $store.notify = originNotify\n    }\n  })\n\nexport let STORE_UNMOUNT_DELAY = 1000\n\nexport let onMount = ($store, initialize) => {\n  let listener = payload => {\n    let destroy = initialize(payload)\n    if (destroy) $store.events[UNMOUNT].push(destroy)\n  }\n  return on($store, listener, MOUNT, runListeners => {\n    let originListen = $store.listen\n    $store.listen = (...args) => {\n      if (!$store.lc && !$store.active) {\n        $store.active = true\n        runListeners()\n      }\n      return originListen(...args)\n    }\n\n    let originOff = $store.off\n    $store.events[UNMOUNT] = []\n    $store.off = () => {\n      originOff()\n      setTimeout(() => {\n        if ($store.active && !$store.lc) {\n          $store.active = false\n          for (let destroy of $store.events[UNMOUNT]) destroy()\n          $store.events[UNMOUNT] = []\n        }\n      }, STORE_UNMOUNT_DELAY)\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      let originClean = $store[clean]\n      $store[clean] = () => {\n        for (let destroy of $store.events[UNMOUNT]) destroy()\n        $store.events[UNMOUNT] = []\n        $store.active = false\n        originClean()\n      }\n    }\n\n    return () => {\n      $store.listen = originListen\n      $store.off = originOff\n    }\n  })\n}\n","import { atom, epoch } from '../atom/index.js'\nimport { onMount } from '../lifecycle/index.js'\n\nlet computedStore = (stores, cb, batched) => {\n  if (!Array.isArray(stores)) stores = [stores]\n\n  let previousArgs\n  let currentEpoch\n  let set = () => {\n    if (currentEpoch === epoch) return\n    currentEpoch = epoch\n    let args = stores.map($store => $store.get())\n    if (!previousArgs || args.some((arg, i) => arg !== previousArgs[i])) {\n      previousArgs = args\n      let value = cb(...args)\n      if (value && value.then && value.t) {\n        value.then(asyncValue => {\n          if (previousArgs === args) {\n            // Prevent a stale set\n            $computed.set(asyncValue)\n          }\n        })\n      } else {\n        $computed.set(value)\n        currentEpoch = epoch\n      }\n    }\n  }\n  let $computed = atom(undefined)\n  let get = $computed.get\n  $computed.get = () => {\n    set()\n    return get()\n  }\n\n  let timer\n  let run = batched\n    ? () => {\n        clearTimeout(timer)\n        timer = setTimeout(set)\n      }\n    : set\n\n  onMount($computed, () => {\n    let unbinds = stores.map($store => $store.listen(run))\n    set()\n    return () => {\n      for (let unbind of unbinds) unbind()\n    }\n  })\n\n  return $computed\n}\n\nexport let computed = (stores, fn) => computedStore(stores, fn)\nexport let batched = (stores, fn) => computedStore(stores, fn, true)\n","export function getPath(obj, path) {\n  let allKeys = getAllKeysFromPath(path)\n  let res = obj\n  for (let key of allKeys) {\n    if (res === undefined) {\n      break\n    }\n    res = res[key]\n  }\n  return res\n}\n\nexport function setPath(obj, path, value) {\n  return setByKey(obj != null ? obj : {}, getAllKeysFromPath(path), value)\n}\n\nexport function setByKey(obj, splittedKeys, value) {\n  let key = splittedKeys[0]\n  let copy = Array.isArray(obj) ? [...obj] : { ...obj }\n  if (splittedKeys.length === 1) {\n    if (value === undefined) {\n      if (Array.isArray(copy)) {\n        copy.splice(key, 1)\n      } else {\n        delete copy[key]\n      }\n    } else {\n      copy[key] = value\n    }\n    return copy\n  }\n  ensureKey(copy, key, splittedKeys[1])\n  copy[key] = setByKey(copy[key], splittedKeys.slice(1), value)\n  return copy\n}\n\nconst ARRAY_INDEX = /(.*)\\[(\\d+)\\]/\n\nfunction getAllKeysFromPath(path) {\n  return path.split('.').flatMap(key => getKeyAndIndicesFromKey(key))\n}\n\nfunction getKeyAndIndicesFromKey(key) {\n  if (ARRAY_INDEX.test(key)) {\n    let [, keyPart, index] = key.match(ARRAY_INDEX)\n    return [...getKeyAndIndicesFromKey(keyPart), index]\n  }\n  return [key]\n}\n\nconst IS_NUMBER = /^\\d+$/\nfunction ensureKey(obj, key, nextKey) {\n  if (key in obj) {\n    return\n  }\n\n  let isNum = IS_NUMBER.test(nextKey)\n\n  if (isNum) {\n    obj[key] = Array(parseInt(nextKey, 10) + 1)\n  } else {\n    obj[key] = {}\n  }\n}\n","import { atom } from '../atom/index.js'\nimport { getPath, setPath } from './path.js'\n\nexport { getPath, setByKey, setPath } from './path.js'\n\nexport function deepMap(initial = {}) {\n  let $deepMap = atom(initial)\n  $deepMap.setKey = (key, value) => {\n    if (getPath($deepMap.value, key) !== value) {\n      let oldValue = $deepMap.value\n      $deepMap.value = setPath($deepMap.value, key, value)\n      $deepMap.notify(oldValue, key)\n    }\n  }\n  return $deepMap\n}\n","export let keepMount = $store => {\n  $store.listen(() => {})\n}\n","export function listenKeys($store, keys, listener) {\n  let keysSet = new Set([...keys, undefined])\n  return $store.listen((value, oldValue, changed) => {\n    if (keysSet.has(changed)) {\n      listener(value, oldValue, changed)\n    }\n  })\n}\n\nexport function subscribeKeys($store, keys, listener) {\n  let unbind = listenKeys($store, keys, listener)\n  listener($store.value)\n  return unbind\n}\n","import { atom } from '../atom/index.js'\n\nexport let map = (initial = {}) => {\n  let $map = atom(initial)\n\n  $map.setKey = function (key, value) {\n    let oldMap = $map.value\n    if (typeof value === 'undefined' && key in $map.value) {\n      $map.value = { ...$map.value }\n      delete $map.value[key]\n      $map.notify(oldMap, key)\n    } else if ($map.value[key] !== value) {\n      $map.value = {\n        ...$map.value,\n        [key]: value\n      }\n      $map.notify(oldMap, key)\n    }\n  }\n\n  return $map\n}\n","import { clean } from '../clean-stores/index.js'\nimport { onMount } from '../lifecycle/index.js'\nimport { map } from '../map/index.js'\n\nexport function mapCreator(init) {\n  let Creator = (id, ...args) => {\n    if (!Creator.cache[id]) {\n      Creator.cache[id] = Creator.build(id, ...args)\n    }\n    return Creator.cache[id]\n  }\n\n  Creator.build = (id, ...args) => {\n    let store = map({ id })\n    onMount(store, () => {\n      let destroy\n      if (init) destroy = init(store, id, ...args)\n      return () => {\n        delete Creator.cache[id]\n        if (destroy) destroy()\n      }\n    })\n    return store\n  }\n\n  Creator.cache = {}\n\n  if (process.env.NODE_ENV !== 'production') {\n    Creator[clean] = () => {\n      for (let id in Creator.cache) {\n        Creator.cache[id][clean]()\n      }\n      Creator.cache = {}\n    }\n  }\n\n  return Creator\n}\n","var has = Object.prototype.hasOwnProperty;\n\nfunction find(iter, tar, key) {\n\tfor (key of iter.keys()) {\n\t\tif (dequal(key, tar)) return key;\n\t}\n}\n\nexport function dequal(foo, bar) {\n\tvar ctor, len, tmp;\n\tif (foo === bar) return true;\n\n\tif (foo && bar && (ctor=foo.constructor) === bar.constructor) {\n\t\tif (ctor === Date) return foo.getTime() === bar.getTime();\n\t\tif (ctor === RegExp) return foo.toString() === bar.toString();\n\n\t\tif (ctor === Array) {\n\t\t\tif ((len=foo.length) === bar.length) {\n\t\t\t\twhile (len-- && dequal(foo[len], bar[len]));\n\t\t\t}\n\t\t\treturn len === -1;\n\t\t}\n\n\t\tif (ctor === Set) {\n\t\t\tif (foo.size !== bar.size) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tfor (len of foo) {\n\t\t\t\ttmp = len;\n\t\t\t\tif (tmp && typeof tmp === 'object') {\n\t\t\t\t\ttmp = find(bar, tmp);\n\t\t\t\t\tif (!tmp) return false;\n\t\t\t\t}\n\t\t\t\tif (!bar.has(tmp)) return false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (ctor === Map) {\n\t\t\tif (foo.size !== bar.size) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tfor (len of foo) {\n\t\t\t\ttmp = len[0];\n\t\t\t\tif (tmp && typeof tmp === 'object') {\n\t\t\t\t\ttmp = find(bar, tmp);\n\t\t\t\t\tif (!tmp) return false;\n\t\t\t\t}\n\t\t\t\tif (!dequal(len[1], bar.get(tmp))) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (ctor === ArrayBuffer) {\n\t\t\tfoo = new Uint8Array(foo);\n\t\t\tbar = new Uint8Array(bar);\n\t\t} else if (ctor === DataView) {\n\t\t\tif ((len=foo.byteLength) === bar.byteLength) {\n\t\t\t\twhile (len-- && foo.getInt8(len) === bar.getInt8(len));\n\t\t\t}\n\t\t\treturn len === -1;\n\t\t}\n\n\t\tif (ArrayBuffer.isView(foo)) {\n\t\t\tif ((len=foo.byteLength) === bar.byteLength) {\n\t\t\t\twhile (len-- && foo[len] === bar[len]);\n\t\t\t}\n\t\t\treturn len === -1;\n\t\t}\n\n\t\tif (!ctor || typeof foo === 'object') {\n\t\t\tlen = 0;\n\t\t\tfor (ctor in foo) {\n\t\t\t\tif (has.call(foo, ctor) && ++len && !has.call(bar, ctor)) return false;\n\t\t\t\tif (!(ctor in bar) || !dequal(foo[ctor], bar[ctor])) return false;\n\t\t\t}\n\t\t\treturn Object.keys(bar).length === len;\n\t\t}\n\t}\n\n\treturn foo !== foo && bar !== bar;\n}\n","import type { Atom, ReadableAtom } from 'nanostores';\nimport { onMount, atom } from 'nanostores';\nimport { dequal } from 'dequal'\n\nconst memo = <T, K>(input: Atom<T>, cb: (value: T) => K) => {\n  const $memoized = atom<K>(cb(input.get()));\n\n  const unsubscribe = input.subscribe((value) => {\n    const comparable = cb(value);\n\n    if (!dequal($memoized.get(), comparable)) {\n      // @ts-ignore\n      $memoized.set(typeof comparable === 'object' ? { ...comparable } : Array.isArray(comparable) ? [...comparable] : comparable)\n    }\n  })\n\n  onMount($memoized, () => {\n    return unsubscribe;\n  })\n\n  return $memoized as ReadableAtom<K>;\n}\n\nexport { memo }\n","import type { BaseDeepMap, DeepMapStore } from 'nanostores'\nimport { deepMap, setByKey } from 'nanostores'\n\ntype AnyFunction = (...args: any[]) => any;\n\n/**\n * @deprecated\n * @todo remove it\n */\ntype NoInfer<T> = [T][T extends any ? 0 : never];\n\ntype GetPath<$AtomValue extends object, $MutateValue> = (object: $AtomValue) => $MutateValue;\ntype Setter<T> = T extends AnyFunction ? () => T : (T | ((prev: T) => T))\n\ntype DeepAtom<T extends BaseDeepMap> = DeepMapStore<T> & {\n  mutate: <$MutateValue>(getPath: ((object: T) => $MutateValue), setter: Setter<NoInfer<$MutateValue>>) => NoInfer<$MutateValue>;\n}\n\nconst usePath = <$AtomValue extends BaseDeepMap, $MutateValue>(atomValue: $AtomValue, getPath: GetPath<$AtomValue, $MutateValue>) => {\n  const targets = new Set();\n  const path: PropertyKey[] = [];\n\n  let current;\n\n  const proxyHandler: ProxyHandler<any> = {\n    get(target, prop, receiver) {\n      if (targets.has(target)) {\n        /**\n         * Same property was accessed twice\n         */\n        throw new ReferenceError(`Attempted to access property on the same target multiple times.`)\n      }\n\n      const value = Reflect.get(target, prop, receiver);\n\n      targets.add(target);\n      path.push(prop);\n\n      current = value;\n\n      if (value === undefined) {\n        return new Proxy({}, proxyHandler);\n      }\n\n      if (value && typeof value === 'object') {\n        return new Proxy(value, proxyHandler);\n      }\n\n      return value;\n    },\n  }\n\n  getPath(new Proxy(atomValue, proxyHandler));\n\n  if (path.length === 0) {\n    throw new Error('No valid path extracted from the provided getPath function.')\n  }\n\n  return {\n    path,\n    value: current as $MutateValue\n  }\n}\n\n/**\n * Creates a `deepMap` extended with `mutate` method\n *\n * @example\n * ```ts\n * const $user = deepAtom({ age: 16 });\n *\n * $user.mutate((s) => s.age, (age) => age + 1);\n * ```\n */\nconst deepAtom = <$AtomValue extends BaseDeepMap>(init: $AtomValue): DeepAtom<$AtomValue> => {\n  const $atom = deepMap(init) as unknown as DeepAtom<$AtomValue>;\n\n  $atom.mutate = (getPath, setter) => {\n    const { path, value } = usePath($atom.get(), getPath);\n\n    const newValue = typeof setter === 'function' ? setter(value) : setter;\n\n    if (newValue === value) {\n      return newValue;\n    }\n\n    const oldValue = $atom.value;\n\n    // @ts-expect-error Value is actually is not read-only\n    $atom.value = setByKey($atom.value, path, newValue)\n    // @ts-expect-error Type for path is dynamic\n    $atom.notify(oldValue, path.join('.'))\n\n    return newValue;\n  }\n\n  return $atom;\n}\n\nexport { deepAtom }\nexport type { DeepAtom }\n","import type { CustomHandler, CustomHandlerGetResult } from '@novely/core';\nimport type { BaseDeepMap } from 'nanostores';\nimport type { DeepAtom } from '../atoms/deep-atom';\nimport { onMount, cleanStores } from 'nanostores';\nimport { deepAtom } from '../atoms/deep-atom';\n\ntype Disposable = {\n  /**\n   * Function that is called after action is completed and game should move forward\n   *\n   * @example\n   * ```ts\n   * function handleTextActionClick() {\n   *   const { resolve } = contextState.get().text;\n   *\n   *   // as user clicked on text we will hide text by updating this store\n   *   contextState.setKey('text', { content: '' });\n   *\n   *   // now proceed to go to next action\n   *   resolve()\n   * }\n   * ```\n   */\n  resolve?: () => void;\n}\n\ntype WithActionVisibility = {\n  /**\n   * Used to check if something should be rendered\n   */\n  visible: boolean;\n}\n\ntype Labelled = {\n  /**\n   * Label for the action.\n   *\n   * In example for Input action it might be \"Enter youʼ age\", and for Choice action it might be \"Select youʼr next move\"\n   */\n  label: string;\n}\n\ntype ContextStateBackground = {\n  /**\n   * In-game background image\n   */\n  background: string;\n  /**\n   * Function that is NOT provided by core. You can set it yourself.\n   */\n  clear?: () => void;\n}\n\ntype ContextStateCharacter = WithActionVisibility & {\n  /**\n   * Basically `element.style`\n   */\n  style: string | undefined;\n  /**\n   * Character removal can be delayed so it could be removed with animation.\n   *\n   * Storing timeout id is needed to cancel it if in example ShowCharacter was called before time for removal came to the end to prevent character unexpectedly be removed\n   */\n  hideTimeoutId?: ReturnType<typeof setTimeout>;\n}\n\ntype ContextStateCharacters = {\n  [key: string]: ContextStateCharacter | undefined;\n}\n\ntype ContextStateCustomHandler = {\n  /**\n   * Node in which custom action is rendered\n   */\n  node: null | HTMLDivElement;\n  /**\n   * Custom Handler function itself\n   */\n  fn: CustomHandler;\n  /**\n   * Clear Function. Removes the action.\n   */\n  clear: () => void;\n}\n\ntype ContextStateCustomHandlers = {\n  [key: string]: ContextStateCustomHandler | undefined\n}\n\ntype ContextStateText = Disposable & {\n  /**\n   * Text to be rendered\n   */\n  content: string;\n}\n\ntype ContextStateDialog = Disposable & WithActionVisibility & {\n  /**\n   * Character lyrics\n   */\n  content: string;\n  /**\n   * Character lyrics. It might be also empty\n   */\n  name: string;\n  /**\n   * Miniature character rendered along with text\n   */\n  miniature: {\n    /**\n     * Character\n     */\n    character?: string;\n    /**\n     * Character's emotion\n     */\n    emotion?: string;\n  }\n}\n\ntype ContextStateInput = Disposable & WithActionVisibility & Labelled & {\n  /**\n   * Input Element. Input action very dependent on DOM so this is needed\n   */\n  element: null | HTMLInputElement;\n  /**\n   * When input validation failed this error message should be shown near input element.\n   * When error is present, going to next action should be restricted.\n   */\n  error: string;\n  /**\n   * Function that should be called before input action should be removed\n   */\n  cleanup?: () => void;\n}\n\ntype ContextStateChoice = WithActionVisibility & Labelled & {\n  /**\n   * It is an array of choices.\n   *\n   * First item of choice is a choice text and second one is active it or not.\n   * When choice is not action it should be impossible to select that choice.\n   */\n  choices: [string, boolean][];\n  /**\n   * Function that is called after choice was made and game should move forward\n   * @param selected index\n   * @example\n   * ```ts\n   * function handleChoiceActionSelection() {\n   *   const index = document.querySelector('select.choice').selectedIndex;\n   *\n   *   const { resolve } = contextState.get().choice;\n   *\n   *   // pass index\n   *   resolve(index);\n   *\n   *   contextState.setKey('choice', { choices: [] });\n   * }\n   * ```\n   */\n  resolve?: (selected: number) => void;\n}\n\ntype ContextStateMeta = {\n  /**\n   * Is it currently in restoring phase\n   */\n  restoring: boolean\n  /**\n   * Is it in preview mode\n   *\n   * In this mode game should be un-playable\n   */\n  preview: boolean\n  /**\n   * Is Novely in goingBack state\n   */\n  goingBack: boolean\n}\n\n/**\n * State which is related to game contexts and contains data about it\n */\ntype ContextState = {\n  /**\n   * ShowBackground action.\n   */\n  background: ContextStateBackground;\n  /**\n   * Character information.\n   */\n  characters: ContextStateCharacters;\n  /**\n   * Text action. Basically shown over other action\n   */\n  text: ContextStateText;\n  /**\n   * Dialog action.\n   */\n  dialog: ContextStateDialog;\n  /**\n   * Input action.\n   */\n  input: ContextStateInput;\n  /**\n   * Choice action.\n   */\n  choice: ContextStateChoice;\n  /**\n  * Meta information about current context\n  */\n  meta: ContextStateMeta;\n  /**\n   * Custom Action store\n   */\n  custom: ContextStateCustomHandlers;\n}\n\nconst defaultEmpty = {} satisfies BaseDeepMap;\n\ntype ContextStateStore<Extension extends BaseDeepMap = typeof defaultEmpty> = ContextState & Extension\n\nconst getDefaultContextState = (): ContextState => {\n  return {\n    background: {\n      background: '#000',\n    },\n    characters: {},\n    choice: {\n      label: '',\n      visible: false,\n      choices: [],\n    },\n    dialog: {\n      content: '',\n      name: '',\n      visible: false,\n      miniature: {},\n    },\n    input: {\n      element: null,\n      label: '',\n      error: '',\n      visible: false\n    },\n    text: {\n      content: ''\n    },\n    custom: {},\n    meta: {\n      restoring: false,\n      goingBack: false,\n      preview: false\n    }\n  }\n}\n\n/**\n * Creates typed context state root\n *\n * @example\n * ```ts\n * const { useContextState, removeContextState } = createContextStateRoot<{ additionalContextProp: number }>(() => {\n *   return {\n *     additionalContextProp: 123\n *   }\n * });\n *\n * // when you want to create or get context state\n * useContextState('id here')\n *\n * // when context state should be removed\n * removeContextState('id here')\n * ```\n */\nconst createContextStateRoot = <Extension extends BaseDeepMap = typeof defaultEmpty>(getExtension: () => Extension = () => ({}) as Extension) => {\n  const CACHE = new Map<string, DeepAtom<ContextStateStore<Extension>>>();\n\n  const make = () => {\n    const contextState = deepAtom<ContextStateStore<Extension>>({\n      ...getDefaultContextState(),\n      ...getExtension()\n    } as ContextStateStore<Extension>);\n\n    return contextState;\n  }\n\n  const remove = (id: string) => {\n    const contextState = CACHE.get(id);\n\n    if (contextState) {\n      cleanStores(contextState)\n    }\n\n    CACHE.delete(id);\n  }\n\n  const use = (id: string) => {\n    const cached = CACHE.get(id);\n\n    if (cached) {\n      return cached;\n    }\n\n    const contextState = make();\n\n    CACHE.set(id, contextState);\n\n    onMount(contextState, () => {\n      return () => {\n        CACHE.delete(id);\n      }\n    })\n\n    return contextState;\n  }\n\n  return {\n    useContextState: use,\n    removeContextState: remove\n  }\n}\n\nexport { createContextStateRoot }\nexport type {\n  ContextStateStore,\n  ContextState,\n  ContextStateCharacter,\n  ContextStateCustomHandler\n}\n","import type { NovelyScreen } from '@novely/core';\nimport type { BaseDeepMap } from 'nanostores';\nimport { deepAtom } from '../atoms/deep-atom';\n\n/**\n * State which is related to whole renderer\n */\ntype RendererState = {\n  /**\n   * Current screen that should be rendered\n   */\n  screen: NovelyScreen;\n  /**\n   * Is loading shown. Unlike screen 'loading', it does not change screen and shown above all layers\n   */\n  loadingShown: boolean;\n  /**\n   * Is exit prompt should be shown\n   */\n  exitPromptShown: boolean;\n}\n\nconst defaultEmpty = {} satisfies BaseDeepMap;\n\ntype RendererStateStore<Extension extends BaseDeepMap = typeof defaultEmpty> = RendererState & Extension;\n\n/**\n * Helper to make renderer state with default recommended values\n * @param extension Additional object to be merged with default values\n * @returns Store\n * @example\n * ```ts\n * createRenderer(() => {\n *   const rendererState = createRendererState();\n *\n *   return {\n *     ui: {\n *       showScreen(name) {\n *         rendererState.setKey('screen', name)\n *       },\n *       getScreen() {\n *         return rendererState.get().screen;\n *       }\n *     }\n *   }\n * })\n * ```\n */\nconst createRendererState = <Extension extends BaseDeepMap = typeof defaultEmpty>(extension = defaultEmpty as Extension) => {\n  const rendererState = deepAtom<RendererStateStore<Extension>>({\n    screen: 'mainmenu',\n    loadingShown: false,\n    exitPromptShown: false,\n    ...extension\n  } as RendererStateStore<Extension>)\n\n  return rendererState;\n}\n\nexport { createRendererState }\nexport type { RendererState, RendererStateStore }\n","const noop = () => {};\n\nexport { noop }\n","const findLastIndex = <T>(array: T[], fn: (this: T[], item: T, index: number, array: T[]) => boolean) => {\n\tfor (let i = array.length - 1; i >= 0; i--) {\n\t\tif (fn.call(array, array[i], i, array)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\n\treturn -1;\n};\n\n/**\n * Using this because `Array.prototype.findLast` has not enough support\n * @see https://caniuse.com/?search=findLast\n */\nconst findLast = <T>(array: T[], fn: (this: T[], item: T, index: number, array: T[]) => boolean) => {\n\treturn array[findLastIndex(array, fn)];\n}\n\nexport { findLastIndex, findLast }\n","const escaped: Record<string, string> = {\n\t'\"': '&quot;',\n\t\"'\": '&#39;',\n\t'&': '&amp;',\n\t'<': '&lt;',\n\t'>': '&gt;',\n};\n\nconst escapeHTML = (str: string) => {\n\treturn String(str).replace(/[\"'&<>]/g, (match) => escaped[match]);\n};\n\nexport { escapeHTML }\n","import { noop } from \"../utils\";\n\n/**\n * Unmounts app\n *\n * @example\n * ```ts\n * import { createRoot } from 'react-dom/client';\n *\n * const root = createRoot(document.body);\n *\n * root.render(<App />);\n *\n * // this is we want\n * root.unmount();\n * ```\n */\ntype StartFunctionUnMountFn = () => void;\n\n/**\n * Mounts app, returns unmount function\n *\n * @example\n * ```ts\n * import { createRoot } from 'react-dom/client';\n *\n * const root = createRoot(document.body);\n *\n * function start() {\n *   root.render(<App />);\n *\n *   return () => {\n *     root.unmount();\n *   }\n * }\n * ```\n */\ntype StartFunctionMountFn = () => StartFunctionUnMountFn;\n\n/**\n * @example\n * ```ts\n * import { createRoot } from 'react-dom/client';\n *\n * const root = createRoot(document.body);\n *\n * createStartFunction(() => {\n *   root.render(<App />);\n *\n *   return () => {\n *     root.unmount();\n *   }\n * })\n * ```\n */\nconst createStartFunction = (fn: StartFunctionMountFn) => {\n  let unmount: StartFunctionUnMountFn = noop;\n\n  return () => {\n    unmount();\n    unmount = fn();\n\n    return {\n      unmount: () => {\n        unmount();\n        unmount = noop;\n      }\n    }\n  }\n}\n\nexport { createStartFunction }\nexport type { StartFunctionMountFn, StartFunctionUnMountFn }\n","/*\nHow it works:\n`this.#head` is an instance of `Node` which keeps track of its current value and nests another instance of `Node` that keeps the value that comes after it. When a value is provided to `.enqueue()`, the code needs to iterate through `this.#head`, going deeper and deeper to find the last value. However, iterating through every single item is slow. This problem is solved by saving a reference to the last value as `this.#tail` so that it can reference it to add a new value.\n*/\n\nclass Node {\n\tvalue;\n\tnext;\n\n\tconstructor(value) {\n\t\tthis.value = value;\n\t}\n}\n\nexport default class Queue {\n\t#head;\n\t#tail;\n\t#size;\n\n\tconstructor() {\n\t\tthis.clear();\n\t}\n\n\tenqueue(value) {\n\t\tconst node = new Node(value);\n\n\t\tif (this.#head) {\n\t\t\tthis.#tail.next = node;\n\t\t\tthis.#tail = node;\n\t\t} else {\n\t\t\tthis.#head = node;\n\t\t\tthis.#tail = node;\n\t\t}\n\n\t\tthis.#size++;\n\t}\n\n\tdequeue() {\n\t\tconst current = this.#head;\n\t\tif (!current) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#head = this.#head.next;\n\t\tthis.#size--;\n\t\treturn current.value;\n\t}\n\n\tpeek() {\n\t\tif (!this.#head) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.#head.value;\n\n\t\t// TODO: Node.js 18.\n\t\t// return this.#head?.value;\n\t}\n\n\tclear() {\n\t\tthis.#head = undefined;\n\t\tthis.#tail = undefined;\n\t\tthis.#size = 0;\n\t}\n\n\tget size() {\n\t\treturn this.#size;\n\t}\n\n\t* [Symbol.iterator]() {\n\t\tlet current = this.#head;\n\n\t\twhile (current) {\n\t\t\tyield current.value;\n\t\t\tcurrent = current.next;\n\t\t}\n\t}\n}\n","import Queue from 'yocto-queue';\n\nexport default function pLimit(concurrency) {\n\tvalidateConcurrency(concurrency);\n\n\tconst queue = new Queue();\n\tlet activeCount = 0;\n\n\tconst resumeNext = () => {\n\t\tif (activeCount < concurrency && queue.size > 0) {\n\t\t\tqueue.dequeue()();\n\t\t\t// Since `pendingCount` has been decreased by one, increase `activeCount` by one.\n\t\t\tactiveCount++;\n\t\t}\n\t};\n\n\tconst next = () => {\n\t\tactiveCount--;\n\n\t\tresumeNext();\n\t};\n\n\tconst run = async (function_, resolve, arguments_) => {\n\t\tconst result = (async () => function_(...arguments_))();\n\n\t\tresolve(result);\n\n\t\ttry {\n\t\t\tawait result;\n\t\t} catch {}\n\n\t\tnext();\n\t};\n\n\tconst enqueue = (function_, resolve, arguments_) => {\n\t\t// Queue `internalResolve` instead of the `run` function\n\t\t// to preserve asynchronous context.\n\t\tnew Promise(internalResolve => {\n\t\t\tqueue.enqueue(internalResolve);\n\t\t}).then(\n\t\t\trun.bind(undefined, function_, resolve, arguments_),\n\t\t);\n\n\t\t(async () => {\n\t\t\t// This function needs to wait until the next microtask before comparing\n\t\t\t// `activeCount` to `concurrency`, because `activeCount` is updated asynchronously\n\t\t\t// after the `internalResolve` function is dequeued and called. The comparison in the if-statement\n\t\t\t// needs to happen asynchronously as well to get an up-to-date value for `activeCount`.\n\t\t\tawait Promise.resolve();\n\n\t\t\tif (activeCount < concurrency) {\n\t\t\t\tresumeNext();\n\t\t\t}\n\t\t})();\n\t};\n\n\tconst generator = (function_, ...arguments_) => new Promise(resolve => {\n\t\tenqueue(function_, resolve, arguments_);\n\t});\n\n\tObject.defineProperties(generator, {\n\t\tactiveCount: {\n\t\t\tget: () => activeCount,\n\t\t},\n\t\tpendingCount: {\n\t\t\tget: () => queue.size,\n\t\t},\n\t\tclearQueue: {\n\t\t\tvalue() {\n\t\t\t\tqueue.clear();\n\t\t\t},\n\t\t},\n\t\tconcurrency: {\n\t\t\tget: () => concurrency,\n\n\t\t\tset(newConcurrency) {\n\t\t\t\tvalidateConcurrency(newConcurrency);\n\t\t\t\tconcurrency = newConcurrency;\n\n\t\t\t\tqueueMicrotask(() => {\n\t\t\t\t\t// eslint-disable-next-line no-unmodified-loop-condition\n\t\t\t\t\twhile (activeCount < concurrency && queue.size > 0) {\n\t\t\t\t\t\tresumeNext();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t});\n\n\treturn generator;\n}\n\nfunction validateConcurrency(concurrency) {\n\tif (!((Number.isInteger(concurrency) || concurrency === Number.POSITIVE_INFINITY) && concurrency > 0)) {\n\t\tthrow new TypeError('Expected `concurrency` to be a number from 1 and up');\n\t}\n}\n","const waitForInteraction = (() => {\n  const { promise, resolve } = Promise.withResolvers<void>();\n\t\n\tconst onUserInteraction = () => {\n\t\tresolve();\n\t};\n\n\tdocument.addEventListener('touchstart', onUserInteraction, { once: true });\n\tdocument.addEventListener('touchend', onUserInteraction, { once: true });\n\tdocument.addEventListener('click', onUserInteraction, { once: true });\n\tdocument.addEventListener('keydown', onUserInteraction, { once: true });\n\n\treturn () => {\n    return promise;\n  };\n})();\n\nexport { waitForInteraction }","type EventHandler<T> = (this: Document, event: T) => void;\n\ntype BlurEventHandler = EventHandler<Event>;\ntype FocusEventHandler = EventHandler<FocusEvent>;\n\nconst BLUR_HANDLERS = new Set<BlurEventHandler>();\nconst FOCUS_HANDLERS = new Set<FocusEventHandler>();\n\ntype EventListeners = {\n  focus: FocusEventHandler;\n  blur: BlurEventHandler;\n}\n\nconst registerEventListeners = (listeners: EventListeners) => {\n  BLUR_HANDLERS.add(listeners.blur);\n  FOCUS_HANDLERS.add(listeners.focus);\n\n  return () => {\n    BLUR_HANDLERS.delete(listeners.blur);\n    FOCUS_HANDLERS.delete(listeners.focus);\n  }\n}\n\naddEventListener('focus', function (event) {\n  for (const handler of FOCUS_HANDLERS) {\n    try {\n      handler.call(this.document, event);\n    } catch {}\n  }\n});\n\naddEventListener('blur', function (event) {\n  for (const handler of BLUR_HANDLERS) {\n    try {\n      handler.call(this.document, event);\n    } catch {}\n  }\n});\n\nexport { registerEventListeners, BLUR_HANDLERS as _BLUR_HANDLERS, FOCUS_HANDLERS as _FOCUS_HANDLERS }\nexport type { EventHandler, BlurEventHandler, FocusEventHandler, EventListeners }","import pLimit from 'p-limit';\n\ntype Thenable<T> = T | Promise<T>;\ntype Queue = (() => Thenable<void>)[]\n\nconst createQueue = (queue: Queue, stopped = false) => {\n  const limit = pLimit(1);\n\n  const run = async () => {\n    const items = queue.slice();\n\n    for await (const item of items) {\n      if (stopped) break;\n\n      try {\n        await item();\n      } catch (error) {\n        console.error(error);\n        \n        /**\n         * In case that exception is handled then stopped will be set manually in catch block\n         * But in other cases stop it here\n         */\n        stopped = true;\n      }\n    }\n\n    queue = queue.filter(item => !items.includes(item));\n    stopped = false;\n  };\n\n  return {\n    get queue() {\n      return queue;\n    },\n    set queue(value) {\n      queue = value;\n    },\n    stop() {\n      stopped = true;\n    },\n    execute: () => {\n      return limit(run);\n    }\n  }\n}\n\nexport { createQueue }\nexport type { Queue }","/**\n * Primitive memo key-based wrapper.\n * \n * This memoization function wraps an asynchronous function and caches its result\n * based on a unique key. If the function has already been called with the same\n * key, the cached result (a promise) will be returned instead of invoking the\n * function again.\n * \n * @warning\n * This cache implementation does not handle promise rejections. If the provided\n * function's promise is rejected, the rejection will be cached, and any subsequent\n * calls with the same key will return the same rejected promise.\n */\nconst createMemo = <T>() => {\n  const cache = new Map<string, Promise<T>>()\n\n  return (key: string, fn: () => Promise<T>) => {\n    return () => {\n      const preserved = cache.get(key);\n\n      if (preserved) {\n        return preserved;\n      }\n\n      const promise = fn();\n\n      cache.set(key, promise);\n\n      return promise;\n    }\n  }\n}\n\nexport { createMemo }","import type { AudioInstance } from \"./types\";\nimport { waitForInteraction } from \"./wait_for_interaction\";\nimport { registerEventListeners } from './browser-events';\nimport { createQueue } from './queue';\nimport { createMemo } from './memo';\n\nconst fetcherMemo = createMemo<ArrayBuffer>();\nconst decoderMemo = createMemo<AudioBuffer>();\n\ntype ExtendAudioGraphOptions = {\n  context: AudioContext;\n  node: GainNode;\n}\n\ntype AudioNodeLike = {\n  connect: ((destinationNode: AudioNode) => void);\n}\n\ntype ExtendAudioGraph = (options: ExtendAudioGraphOptions) => AudioNode | AudioNodeLike;\n\ntype AudioOptions = {\n  /**\n   * Source\n   */\n  src: string;\n  /**\n   * Loop\n   * @default false\n   */\n  loop?: boolean;\n  /**\n   * Volume\n   * @default 1\n   */\n  volume?: number;\n  /**\n   * Will pause playing on blur event, play on focus.\n   * @default false\n   */\n  pauseOnBlur?: boolean;\n  /**\n   * @default false\n   */\n  autoplay?: boolean;\n  /**\n   * Function to extend audio \"graph\"\n   */\n  extendAudioGraph?: ExtendAudioGraph;\n};\n\nconst createAudio = (options: AudioOptions) => {\n  let audioContext: AudioContext;\n  let gainNode: GainNode;\n  let bufferSource: AudioBufferSourceNode;\n  let arrayBuffer: ArrayBuffer;\n  let audioBuffer: AudioBuffer;\n\n  /**\n   * Values that pending it's queue to be set\n   */\n  let pendingVolume = options.volume || 1;\n  let pendingLoop = options.loop || false;\n\n  const createAudioContext = () => {\n    audioContext = new AudioContext()\n  }\n\n  const getGainNode = () => {\n    return gainNode;\n  }\n\n  const createGainNode = () => {\n    gainNode = audioContext.createGain();\n\n    const node = (options.extendAudioGraph || getGainNode)({\n      context: audioContext,\n      node: gainNode\n    });\n\n    node.connect(audioContext.destination);\n  }\n\n  const createBufferSource = () => {\n    bufferSource = audioContext.createBufferSource();\n  }\n\n  const interruptQueueThenDestroy = (cause: Error | unknown) => {\n    /**\n     * Firstly prevent next queue items from running because they depend on previous items\n     * Then destroy audio because there is no reason to try run it over and over again\n     */\n    queue.stop();\n    instance.destroy();\n\n    return new Error('', { cause });\n  }\n\n  const fetchArrayBuffer = fetcherMemo(options.src, async () => {\n    try {\n      return await fetch(options.src).then(response => response.arrayBuffer());\n    } catch (error) {\n      throw interruptQueueThenDestroy(error);\n    }\n  });\n\n  const setArrayBuffer = async () => {\n    arrayBuffer = await fetchArrayBuffer();\n  }\n\n  const decodeAudioData = decoderMemo(options.src, async () => {\n    try {\n      return await audioContext.decodeAudioData(arrayBuffer);\n    } catch (error) {\n      throw interruptQueueThenDestroy(error);\n    }\n  })\n\n  const setAudioData = async () => {\n    audioBuffer = await decodeAudioData();\n  }\n\n  const connectSources = () => {\n    if (bufferSource && bufferSource.buffer === null) {\n      bufferSource.buffer = audioBuffer;\n      bufferSource.connect(gainNode);\n    }\n  }\n\n  const setVolume = () => {\n    gainNode.gain.value = pendingVolume;\n  }\n\n  const setLoop = () => {\n    bufferSource.loop = pendingLoop;\n  }\n\n  const queue = createQueue([\n    waitForInteraction,\n    createAudioContext,\n    createGainNode,\n    setVolume,\n    createBufferSource,\n    setLoop,\n    fetchArrayBuffer,\n    setArrayBuffer,\n    decodeAudioData,\n    setAudioData,\n    connectSources,\n  ]);\n\n  /**\n   * Will resume when focus or not\n   */\n  let resume = false;\n\n  const unregister = registerEventListeners({\n    focus: () => {\n      if (!options.pauseOnBlur || !resume || state.destroyed) return;\n\n      resume = false;\n\n      queue.queue.push(playAudio);\n      queue.execute()\n    },\n    blur: () => {\n      if (!options.pauseOnBlur || !state.playing || state.destroyed) return;\n\n      resume = true;\n\n      queue.queue.push(pauseAudio);\n      queue.execute()\n    }\n  });\n\n  const state = {\n    started: false,\n    playing: false,\n    destroyed: false\n  };\n\n  const playAudio = async () => {\n    if (state.destroyed) return;\n\n    if (audioContext.state === \"suspended\") {\n      await audioContext.resume();\n\n      if (state.started) {\n        state.playing = true;\n      }\n    }\n\n    if (!state.started) {\n      bufferSource.start();\n\n      state.started = true;\n      state.playing = true;\n    }\n  }\n\n  const pauseAudio = async () => {\n    if (state.destroyed) return;\n    \n    if (audioContext.state === \"suspended\" && queue.queue.at(-1) === playAudio) {\n      queue.queue.pop();\n    }\n\n    if (audioContext.state === \"running\") {\n      await audioContext.suspend();\n\n      state.playing = false;\n    }\n  }\n\n  const disconnectAudio = async () => {\n    bufferSource && bufferSource.disconnect();\n\n    /**\n     * Reset `started` value\n     * That will make `source.start()` call when `play()` will be called\n     */\n    state.started = false;\n  }\n\n  const instance = {\n    async play() {\n      if (state.destroyed) return;\n      \n      queue.queue.push(playAudio);\n\n      return queue.execute();\n    },\n    async pause() {\n      if (state.destroyed) return;\n      \n      queue.queue.push(pauseAudio);\n\n      return queue.execute();\n    },\n    async reset() {\n      if (state.destroyed) return;\n\n      if (state.playing) {\n        queue.queue.push(pauseAudio)\n      }\n\n      queue.queue.push(\n        disconnectAudio,\n        createBufferSource,\n        setLoop,\n        connectSources\n      );\n\n      if (state.playing) {\n        queue.queue.push(playAudio)\n      }\n\n      return queue.execute();\n    },\n    async stop() {\n      if (state.destroyed) return;\n\n      queue.queue.push(\n        pauseAudio,\n        disconnectAudio,\n        createBufferSource,\n        setLoop,\n        connectSources\n      );\n\n      return queue.execute();\n    },\n    async destroy() {\n      if (state.destroyed) return;\n\n      unregister();\n\n      queue.queue = [\n        pauseAudio,\n        disconnectAudio\n      ];\n\n      await queue.execute();\n\n      state.destroyed = true;\n\n      // @ts-expect-error\n      audioContext = null;\n      // @ts-expect-error\n      gainNode = null;\n      // @ts-expect-error\n      bufferSource = null;\n      // @ts-expect-error\n      arrayBuffer = null;\n      // @ts-expect-error\n      audioBuffer = null;\n    },\n    async fetch() {\n      if (state.destroyed) return;\n\n      await fetchArrayBuffer();\n    },\n    get playing() {\n      return state.playing;\n    },\n    get destroyed() {\n      return state.destroyed;\n    },\n    get volume() {\n      return pendingVolume;\n    },\n    set volume(value) {\n      if (state.destroyed) return;\n\n      pendingVolume = value;\n      queue.queue.push(setVolume);\n      queue.execute()\n    },\n    get loop() {\n      return pendingLoop;\n    },\n    set loop(value) {\n      if (state.destroyed) return;\n     \n      pendingLoop = value;\n      queue.queue.push(setLoop);\n      queue.execute()\n    }\n  } satisfies AudioInstance;\n\n  if (options.autoplay) {\n    queue.queue.push(playAudio)\n    queue.execute()\n  }\n\n  return instance;\n};\n\nconst prefetchAudio = (src: string) => {\n  const fetcher = fetcherMemo(src, () => fetch(src).then(res => res.arrayBuffer()));\n\n  return fetcher();\n}\n\nexport { prefetchAudio, createAudio };\nexport type { AudioOptions }","import type { AudioStore } from './types';\nimport type { AudioHandle, Context, Stored, StorageData, Data, Renderer } from '@novely/core';\nimport { createAudio as createWebAudio, prefetchAudio } from 'simple-web-audio';\nimport { noop } from '../utils';\n\ntype AudioContext = Context['audio'];\ntype AudioMisc = Pick<Renderer['misc'], 'preloadAudioBlocking'>;\ntype StorageDataStore = Stored<StorageData<string, Data>>;\n\ntype KeepAudio = {\n  music: Set<string>;\n  sounds: Set<string>;\n}\n\nconst TYPE_META_MAP = {\n  'music': 2,\n  'sound': 3,\n  'voice': 4\n} as const;\n\n/**\n * Audio easy! This implementation uses `simple-web-audio` package under the hood.\n *\n * @example\n * ```ts\n * const audio = createAudio(options.storageData);\n * ```\n */\nconst createAudio = (storageData: StorageDataStore) => {\n  const store: AudioStore = {\n    music: {},\n    sound: {},\n    voices: {},\n  }\n\n  const getVolume = (type: 'music' | 'sound' | 'voice') => {\n    return storageData.get().meta[TYPE_META_MAP[type]];\n  }\n\n  const getAudio = (type: 'music' | 'sound' | 'voice', src: string) => {\n    const kind = type === 'voice' ? 'voices' : type;\n    const cached = store[kind][src];\n\n    if (cached) return cached;\n\n    const audio = createWebAudio({\n      src,\n      volume: getVolume(type),\n      pauseOnBlur: true\n    })\n\n    store[kind][src] = audio;\n\n    return audio;\n  }\n\n  let unsubscribe = noop;\n\n  const context: AudioContext = {\n    music(src, method) {\n      const resource = getAudio(method, src);\n\n      this.start();\n\n      return {\n        pause() {\n          resource.pause();\n        },\n        play(loop) {\n          resource.loop = loop;\n          resource.play();\n        },\n        stop() {\n          resource.stop();\n        },\n      } satisfies AudioHandle;\n    },\n    voice(source) {\n      this.start();\n      this.voiceStop();\n\n      const resource = store.voice = getAudio('voice', source);\n\n      resource.play();\n    },\n    voiceStop() {\n      if (!store.voice) return;\n\n      store.voice.stop();\n      store.voice = undefined;\n    },\n    start() {\n      if (unsubscribe !== noop) return;\n\n      /**\n       * Subscribe for volume changes in settings\n       */\n      unsubscribe = storageData.subscribe(() => {\n        for (const type of ['music', 'sound', 'voice'] as const) {\n          const volume = getVolume(type);\n\n          if (type === 'music' || type === 'sound') {\n            for (const audio of Object.values(store[type])) {\n              if (!audio) continue;\n\n              audio.volume = volume;\n            }\n          }\n\n          if (type === 'voice' && store.voice) {\n            store.voice.volume = volume;\n          }\n        }\n      });\n    },\n    clear() {\n      const musics = Object.values(store.music);\n      const sounds = Object.values(store.sound);\n\n      for (const music of [...musics, ...sounds]) {\n        // todo: при переходе в настройки для музыки не делать бы stop, а делать pause\n        music?.stop()\n      }\n\n      this.voiceStop();\n    },\n    destroy() {\n      unsubscribe();\n      this.clear();\n\n      unsubscribe = noop;\n    }\n  };\n\n  /**\n   * Used in clear action when audio should be cleared\n   * @param keepAudio Passed from Clear Action\n   */\n  const clear = (keepAudio: KeepAudio) => {\n    context.voiceStop();\n\n    const musics = Object.entries(store.music).filter(([name]) => !keepAudio.music.has(name)).map(([_, a]) => a);\n    const sounds = Object.entries(store.sound).filter(([name]) => !keepAudio.sounds.has(name)).map(([_, a]) => a);\n\n    for (const music of [...musics, ...sounds]) {\n      if (!music) continue;\n\n      music.stop()\n    }\n  }\n\n  return {\n    context,\n\n    clear,\n\n    getVolume,\n    getAudio\n  }\n}\n\nconst createAudioMisc = () => {\n  const misc: AudioMisc = {\n    preloadAudioBlocking: async (src) => {\n      await prefetchAudio(src);\n    }\n  };\n\n  return misc;\n}\n\nexport { createAudioMisc, createAudio }\n","/**\n * Creates a map of mutable objects\n *\n * todo: practical usage\n *\n * @example\n * ```ts\n * const { useShared, removeShared } = createShared<{ count: number }>(() => {\n *   return {\n *     count: 0\n *   }\n * })\n *\n * useShared('HELLO').count += 1\n * console.log(useShared('HELLO').count) // prints 1\n *\n * useShared('WORLD').count += 1\n * console.log(useShared('WORLD').count) // prints 1 too\n * ```\n */\nconst createShared = <T extends Record<PropertyKey, unknown>>(get: () => T) => {\n  const CACHE = new Map<string, T>();\n\n  const use = (id: string) => {\n    const cached = CACHE.get(id);\n\n    if (cached) {\n      return cached\n    }\n\n    const shared = get();\n\n    CACHE.set(id, shared);\n\n    return shared;\n  }\n\n  const remove = (id: string) => {\n    CACHE.delete(id);\n  }\n\n  return {\n    useShared: use,\n    removeShared: remove\n  }\n}\n\nexport { createShared }\n","import type { Context } from \"@novely/core\"\n\n/**\n * Creates utilities to manage context's in renderer\n * @example\n * ```ts\n * function renderer(options: RendererInit) {\n *   const { getContextCached, removeContext } = createGetContext();\n *\n *   return {\n *     getContext: getContextCached((key) => {\n *       // return Context\n *       return {}\n *     }),\n *     removeContext: (key) => {\n *       removeContext(key);\n *     }\n *   }\n * }\n * ```\n */\nconst createGetContext = () => {\n  const CACHE = new Map<string, Context>();\n\n  /**\n   * Creates context on call, but if context was already created, returns already created context\n   * @param createContext Function to create context\n   * @example\n   * ```ts\n   * function renderer(options: RendererInit) {\n   *   return {\n   *     getContext: getContextCached((key) => {\n   *       // return Context\n   *       return {}\n   *     }),\n   *     removeContext: (key) => {\n   *       removeContext(key);\n   *     }\n   *   }\n   * }\n   * ```\n   */\n  const getContextCached = (createContext: (key: string) => Context) => {\n    return (key: string) => {\n      const cached = CACHE.get(key);\n\n      if (cached) {\n        return cached;\n      }\n\n      const context = createContext(key);\n\n      CACHE.set(key, context)\n\n      return context;\n    }\n  }\n\n  /**\n   * Removed context\n   * @param key Context's key\n   * @example\n   * ```ts\n   * function renderer(options: RendererInit) {\n   *   return {\n   *     getContext: getContextCached((key) => {\n   *       // return Context\n   *       return {}\n   *     }),\n   *     removeContext: (key) => {\n   *       // remove context\n   *       removeContext(key);\n   *     }\n   *   }\n   * }\n   * ```\n   */\n  const removeContext = (key: string) => {\n    CACHE.delete(key)\n  }\n\n  return {\n    getContextCached,\n    removeContext\n  }\n}\n\nexport { createGetContext }\n","import type { Context } from \"@novely/core\"\n\n/**\n * Simply set root to the context\n * @param getContext Function that returns main context\n * @example\n * ```ts\n * const { root, setRoot } = createRootSetter(() => renderer.getContext(options.mainContextKey));\n *\n * const renderer = {\n *   getContext: getContextCached((key) => {\n *     return {\n *       root: root()\n *     }\n *   }),\n *   ui: {\n *     start: createStartFunction(() => {\n *       // this is just an example, use your library to get the node\n *       const element = document.createElement('div');\n *\n *       document.body.appendChild(element);\n *\n *       setRoot(element);\n *\n *       return () => {\n *         element.remove();\n *       }\n *     })\n *   }\n * }\n * ```\n */\nconst createRootSetter = (getContext: () => Context) => {\n  let element: HTMLElement;\n\n  return {\n    root() {\n      return element\n    },\n    setRoot(root: HTMLElement) {\n      element = root;\n\n      const context = getContext();\n\n      /**\n       * Update directly if root was not set already\n       */\n      if (!context.root) {\n        context.root = root;\n      }\n    }\n  }\n}\n\nexport { createRootSetter }\n","const vibrationPossible = /* @__PURE__ */ (() => {\n\tlet possible = false;\n\n\tconst onPointerDown = () => {\n\t\tpossible = true;\n\t};\n\n\tconst isPossible = () => {\n\t\treturn possible;\n\t};\n\n\tdocument.addEventListener('pointerdown', onPointerDown, { once: true });\n\n\treturn isPossible;\n})();\n\n/**\n * Vibrate for browser environment\n */\nconst vibrate = (pattern: VibratePattern) => {\n\tif (vibrationPossible() && 'vibrate' in navigator) {\n\t\ttry {\n\t\t\tnavigator.vibrate(pattern);\n\t\t} catch {}\n\t}\n}\n\nexport { vibrate }\n","import { findLast } from \"../utils\";\n\nconst useBackground = (backgrounds: Record<string, string>, set: (bg: string) => void) => {\n\tconst mediaQueries = Object.keys(backgrounds).map((media) => matchMedia(media));\n\tconst allMedia = mediaQueries.find(({ media }) => media === 'all');\n\n\tconst handle = () => {\n\t\tconst last = findLast(mediaQueries, ({ matches, media }) => matches && media !== 'all');\n\t\tconst bg = last\n\t\t\t? backgrounds[last.media]\n\t\t\t: allMedia\n\t\t\t\t? backgrounds['all']\n\t\t\t\t: '';\n\n\t\tset(bg);\n\t};\n\n\tfor (const mq of mediaQueries) {\n\t\tmq.onchange = handle;\n\t}\n\n\tlet disposed = false;\n\n\t/**\n\t * In case this will be immideately disposed `handle` call is put in Promise\n\t */\n\tPromise.resolve().then(() => {\n\t\tif (disposed) return;\n\n\t\thandle();\n\t})\n\n\treturn {\n\t\t/**\n\t\t * Remove all listeners\n\t\t */\n\t\tdispose() {\n\t\t\tfor (const mq of mediaQueries) {\n\t\t\t\tmq.onchange = null;\n\t\t\t}\n\n\t\t\tdisposed = true;\n\t\t}\n\t}\n}\n\nexport { useBackground }\n","import type {\n  BackgroundImage,\n  Context,\n  DefaultActionProxy,\n  RendererInit,\n  CustomHandler,\n  State,\n  ActionInputOnInputMeta,\n\tActionInputSetup,\n  CustomActionHandle\n} from '@novely/core'\nimport type { ContextState, ContextStateStore } from '../state/context-state'\nimport type { RendererStateStore } from '../state/renderer-state'\nimport type { DeepAtom } from '../atoms/deep-atom'\n\nimport { vibrate } from './vibrate'\nimport { useBackground } from './background'\nimport { escapeHTML, noop } from '../utils'\n\nconst allEmpty = (target: object | string | number | null | undefined) => {\n  if (typeof target === 'string') {\n    return target == '';\n  }\n\n  if (typeof target === 'number') {\n    return target == 0;\n  }\n\n  if (!target) {\n    return true;\n  }\n\n  if (Array.isArray(target) && target.length > 0) {\n    for (const inner of target) {\n      if (!allEmpty(inner)) {\n        return false;\n      }\n    }\n  }\n\n  for (const value of Object.values(target)) {\n    if (!allEmpty(value)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nconst handleBackgroundAction = ($contextState: DeepAtom<ContextStateStore<Record<PropertyKey, unknown>>>, background: Record<string, string>) => {\n  $contextState.get().background.clear?.();\n\n  const { dispose } = useBackground(background, (value) => {\n    $contextState.mutate((s) => s.background, (prev) => {\n      return {\n        ...prev,\n        background: value\n      }\n    });\n  });\n\n  $contextState.mutate((s) => s.background.clear!, () => dispose);\n}\n\nconst handleDialogAction = ($contextState: DeepAtom<ContextStateStore<Record<PropertyKey, unknown>>>, content: string, name: string, character: string | undefined, emotion: string | undefined, resolve: () => void) => {\n  $contextState.mutate(\n    (s) => s.dialog,\n    {\n      content,\n      name,\n      miniature: {\n        character,\n        emotion,\n      },\n      visible: true,\n      resolve,\n    }\n  );\n}\n\nconst handleChoiceAction = ($contextState: DeepAtom<ContextStateStore<Record<PropertyKey, unknown>>>, label: string, choices: [name: string, active: boolean][], resolve: (selected: number) => void) => {\n  $contextState.mutate(\n    (s) => s.choice,\n    { choices, label, resolve, visible: true }\n  );\n}\n\nconst handleClearAction = ($rendererState: DeepAtom<RendererStateStore<Record<PropertyKey, unknown>>>, $contextState: DeepAtom<ContextStateStore<Record<PropertyKey, unknown>>>, options: RendererInit<any, any>, context: Context, keep: Set<keyof DefaultActionProxy>, keepCharacters: Set<string>) => {\n  $rendererState.mutate((s) => s.exitPromptShown, false);\n\n  if (!keep.has('showBackground')) {\n    $contextState.mutate((s) => s.background.background, '#000');\n  }\n\n  if (!keep.has('choice')) {\n    $contextState.mutate(\n      (s) => s.choice,\n      {\n        choices: [],\n        visible: false,\n        label: '',\n      }\n    );\n  }\n\n  const inputCleanup = $contextState.get().input.cleanup;\n\n  if (inputCleanup) {\n    inputCleanup();\n  }\n\n  if (!keep.has('input')) {\n    $contextState.mutate(\n      (s) => s.input,\n      {\n        element: null,\n        label: '',\n        visible: false,\n        error: '',\n      }\n    );\n  }\n\n  if (!keep.has('dialog')) {\n    $contextState.mutate(\n      (s) => s.dialog,\n      {\n        visible: false,\n        content: '',\n        name: '',\n        miniature: {}\n      }\n    );\n  }\n\n  if (!keep.has('text')) {\n    $contextState.mutate((s) => s.text, { content: '' });\n  }\n\n  const { characters, custom } = $contextState.get() as ContextState;\n\n  for (const character of Object.keys(characters)) {\n    if (!keepCharacters.has(character)) {\n      $contextState.mutate(\n        (s) => s.characters[character],\n        {\n          style: undefined,\n          visible: false\n        }\n      );\n    }\n  }\n\n  for (const [id, obj] of Object.entries(custom)) {\n    if (!obj) continue;\n    if (context.meta.goingBack && obj.fn.skipClearOnGoingBack) continue;\n\n    options.clearCustomAction(context, obj.fn);\n    $contextState.mutate((s) => s.custom[id], undefined);\n  }\n}\n\n/**\n * You must return value returned by this function\n */\nconst handleCustomAction = ($contextState: DeepAtom<ContextStateStore<Record<PropertyKey, unknown>>>, fn: CustomHandler<string, State>): CustomActionHandle => {\n  if (!$contextState.get().custom[fn.key]) {\n    $contextState.mutate(\n      (s) => s.custom[fn.key],\n      {\n        fn,\n        node: null,\n        clear: noop,\n      }\n    )\n  }\n\n  return {\n    setMountElement(node) {\n      $contextState.mutate(\n        (s) => s.custom[fn.key]!,\n        (state) => {\n          return {\n            ...state,\n            node\n          }\n        }\n      )\n    },\n    setClear(clear) {\n      $contextState.mutate(\n        (s) => s.custom[fn.key]!,\n        (state) => {\n          return {\n            ...state,\n            clear\n          }\n        }\n      )\n    },\n    remove() {\n      $contextState.mutate((s) => s.custom[fn.key], undefined);\n    }\n  }\n}\n\nconst handleClearBlockingActions = ($contextState: DeepAtom<ContextStateStore<Record<PropertyKey, unknown>>>, preserve?: \"choice\" | \"dialog\" | \"input\" | \"text\" | undefined) => {\n  const current = $contextState.get()\n\n  if (preserve !== 'choice' && !allEmpty(current.choice)) {\n    $contextState.mutate(\n      (s) => s.choice,\n      {\n        choices: [],\n        visible: false,\n        label: '',\n      }\n    );\n  }\n\n  if (preserve !== 'input' && !allEmpty(current.input)) {\n    $contextState.mutate(\n      (s) => s.input,\n      {\n        element: null,\n        label: '',\n        visible: false,\n        error: '',\n      }\n    );\n  }\n\n  if (preserve !== 'text' && !allEmpty(current.text)) {\n    $contextState.mutate((s) => s.text, { content: '' });\n  }\n\n  if (preserve !== 'dialog' && !allEmpty(current.dialog)) {\n    $contextState.mutate(\n      (s) => s.dialog,\n      {\n        visible: false,\n        content: '',\n        name: '',\n        miniature: {}\n      }\n    );\n  }\n}\n\nconst handleTextAction = ($contextState: DeepAtom<ContextStateStore<Record<PropertyKey, unknown>>>, content: string, resolve: () => void) => {\n  $contextState.mutate((s) => s.text, { content, resolve });\n}\n\nconst handleInputAction = ($contextState: DeepAtom<ContextStateStore<Record<PropertyKey, unknown>>>, options: RendererInit<any, any>, context: Context, label: string, onInput: (opts: ActionInputOnInputMeta<string, State>) => void, setup: ActionInputSetup, resolve: () => void) => {\n  const error = (value: string) => {\n    $contextState.mutate((s) => s.input.error, value);\n  };\n\n  const onInputHandler = (event: InputEvent & { currentTarget: HTMLInputElement }) => {\n    let value: string | undefined;\n\n    onInput({\n      lang: options.storageData.get().meta[0],\n      input,\n      event,\n      error,\n      state: options.getStateFunction(context.id),\n      get value() {\n        if (value) return value;\n        return (value = escapeHTML(input.value));\n      },\n    });\n  };\n\n  const input = document.createElement('input');\n\n  input.setAttribute('type', 'text')\n  input.setAttribute('name', 'novely-input')\n  input.setAttribute('required', 'true')\n  input.setAttribute('autocomplete', 'off')\n\n  // @ts-expect-error Type is actually correct\n  !context.meta.preview && input.addEventListener('input', onInputHandler);\n\n  $contextState.mutate(\n    (s) => s.input,\n    {\n      element: input,\n      label,\n      error: '',\n      visible: true,\n      cleanup: setup(input) || noop,\n      resolve,\n    }\n  );\n\n  /**\n   * Initially run the fake input event to handle errors & etc\n   */\n  !context.meta.preview && input.dispatchEvent(new InputEvent('input', { bubbles: true }));\n}\n\n\nconst handleVibrateAction = vibrate;\n\nexport {\n  handleBackgroundAction,\n  handleDialogAction,\n  handleChoiceAction,\n  handleClearAction,\n  handleCustomAction,\n  handleClearBlockingActions,\n  handleTextAction,\n  handleInputAction,\n  handleVibrateAction\n}\n"],"mappings":"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","names":["createAudio","batched","getPath","createAudio"]}